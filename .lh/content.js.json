{
    "sourceFile": "content.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 17,
            "patches": [
                {
                    "date": 1750249274186,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1750258097619,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,9 +101,9 @@\n     }\r\n   }\r\n \r\n   // â˜…APIã‚­ãƒ¼ã‚’ã“ã“ã«è¨­å®šï¼ˆã”è‡ªèº«ã®YouTube Data APIã‚­ãƒ¼ã«å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼‰\r\n-  const YOUTUBE_API_KEY = 'AIzaSyCB9iLVqz1AsLrYk83tILnILa7n6OzfEkg;\r\n+  const YOUTUBE_API_KEY = 'AIzaSyCB9iLVqz1AsLrYk83tILnILa7n6OzfEkg';\r\n \r\n   // å‹•ç”»IDã‚’URLã‹ã‚‰å–å¾—\r\n   function getVideoId() {\r\n     const url = new URL(location.href);\r\n@@ -447,5 +447,20 @@\n     const existingComments = document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]');\r\n     existingComments.forEach(comment => comment.remove());\r\n     addLog(`æ—¢å­˜ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${existingComments.length}ä»¶ã‚’å‰Šé™¤`, 'progress');\r\n   }\r\n+\r\n+  // ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’ã™ã¹ã¦å–å¾—\r\n+  function getDisplayedCommentIds() {\r\n+    const nodes = document.querySelectorAll('ytd-comment-thread-renderer #comment #action-menu-button');\r\n+    const ids = new Set();\r\n+    nodes.forEach(node => {\r\n+      // ã‚³ãƒ¡ãƒ³ãƒˆã®permalinkã‹ã‚‰IDã‚’æŠ½å‡º\r\n+      const anchor = node.closest('ytd-comment-thread-renderer')?.querySelector('a[href*=\"lc=\"]');\r\n+      if (anchor) {\r\n+        const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n+        if (match) ids.add(match[1]);\r\n+      }\r\n+    });\r\n+    return ids;\r\n+  }\r\n })();\r\n"
                },
                {
                    "date": 1750258259668,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -166,8 +166,12 @@\n   }  async function onAnalyzeClick() {\r\n     // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã—ã¦è§£æé–‹å§‹\r\n     addLog('ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n     showResult('è§£æä¸­...', false);\r\n+\r\n+    // ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’æœ€æ–°å–å¾—\r\n+    displayedCommentIds = getDisplayedCommentIds();\r\n+    addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'info');\r\n     \r\n     addLog('å‹•ç”»IDã‚’å–å¾—ä¸­...', 'progress');\r\n     const videoId = getVideoId();\r\n     if (!videoId) {\r\n"
                },
                {
                    "date": 1750258504962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -107,29 +107,38 @@\n   // å‹•ç”»IDã‚’URLã‹ã‚‰å–å¾—\r\n   function getVideoId() {\r\n     const url = new URL(location.href);\r\n     return url.searchParams.get('v');\r\n-  }  // YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n+  }  // YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¨ä»¶å–å¾—ï¼ˆæœ€å¤§1000ä»¶ã¾ã§ï¼‰\r\n   async function fetchComments(videoId) {\r\n     if (!videoId) return { count: 0, comments: [] };\r\n-    const apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=100`;\r\n+    const maxTotal = 1000; // æœ€å¤§å–å¾—ä»¶æ•°ï¼ˆAPIåˆ¶é™ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®ï¼‰\r\n+    let comments = [];\r\n+    let pageToken = '';\r\n     try {\r\n-      const res = await fetch(apiUrl);\r\n-      const data = await res.json();\r\n-      if (data.error) {\r\n-        console.error('YouTube API Error:', data.error);\r\n-        return { count: 0, comments: [] };\r\n+      while (comments.length < maxTotal) {\r\n+        let apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=100`;\r\n+        if (pageToken) apiUrl += `&pageToken=${pageToken}`;\r\n+        const res = await fetch(apiUrl);\r\n+        const data = await res.json();\r\n+        if (data.error) {\r\n+          console.error('YouTube API Error:', data.error);\r\n+          break;\r\n+        }\r\n+        const newComments = data.items ? data.items.map(item => ({\r\n+          author: item.snippet.topLevelComment.snippet.authorDisplayName,\r\n+          authorProfileImageUrl: item.snippet.topLevelComment.snippet.authorProfileImageUrl,\r\n+          authorChannelUrl: item.snippet.topLevelComment.snippet.authorChannelUrl || '#',\r\n+          text: item.snippet.topLevelComment.snippet.textDisplay,\r\n+          publishedAt: item.snippet.topLevelComment.snippet.publishedAt,\r\n+          updatedAt: item.snippet.topLevelComment.snippet.updatedAt,\r\n+          likeCount: item.snippet.topLevelComment.snippet.likeCount || 0,\r\n+          id: item.snippet.topLevelComment.id\r\n+        })) : [];\r\n+        comments = comments.concat(newComments);\r\n+        if (!data.nextPageToken || comments.length >= maxTotal) break;\r\n+        pageToken = data.nextPageToken;\r\n       }\r\n-      const comments = data.items ? data.items.map(item => ({\r\n-        author: item.snippet.topLevelComment.snippet.authorDisplayName,\r\n-        authorProfileImageUrl: item.snippet.topLevelComment.snippet.authorProfileImageUrl,\r\n-        authorChannelUrl: item.snippet.topLevelComment.snippet.authorChannelUrl || '#',\r\n-        text: item.snippet.topLevelComment.snippet.textDisplay,\r\n-        publishedAt: item.snippet.topLevelComment.snippet.publishedAt,\r\n-        updatedAt: item.snippet.topLevelComment.snippet.updatedAt,\r\n-        likeCount: item.snippet.topLevelComment.snippet.likeCount || 0,\r\n-        id: item.snippet.topLevelComment.id\r\n-      })) : [];\r\n       return { count: comments.length, comments: comments };\r\n     } catch (e) {\r\n       console.error('API fetch error:', e);\r\n       return { count: 0, comments: [] };\r\n"
                },
                {
                    "date": 1750258917071,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,24 +1,40 @@\n-// YouTubeã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ä»˜è¿‘ã«ã€Œã‚³ãƒ¡ãƒ³ãƒˆã‚’è§£æã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã—ã€ã‚¯ãƒªãƒƒã‚¯æ™‚ã«è§£æãƒ»çµæœè¡¨ç¤º\r\n+// ==UserScript==\r\n+// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ«\r\n+// @namespace    https://github.com/yourname/\r\n+// @version      1.1.0\r\n+// @description  YouTubeã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§APIä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã¨ç”»é¢ä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¯”è¼ƒã—ã€æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ã‚’æ¤œå‡ºã—ã¦æœ€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã™ã€‚IDå–å¾—ã®ä¿¡é ¼æ€§ã‚‚å‘ä¸Šã€‚\r\n+// @author       YourName\r\n+// @match        https://www.youtube.com/watch*\r\n+// @grant        none\r\n+// ==/UserScript==\r\n+\r\n (function() {\r\n-  // ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã®è¦ªè¦ç´ ã‚’æ¢ã™ï¼ˆæ–°ä»•æ§˜: #additional-sectionå†…éƒ¨ï¼‰\r\n+  'use strict';\r\n+\r\n+  // è¨­å®šï¼šYouTube Data APIã‚­ãƒ¼\r\n+  const YOUTUBE_API_KEY = 'AIzaSyCB9iLVqz1AsLrYk83tILnILa7n6OzfEkg';\r\n+\r\n+  // æ—¢ã«è¡¨ç¤ºæ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’è¨˜éŒ²ã™ã‚‹ã‚»ãƒƒãƒˆ\r\n+  let displayedCommentIds = new Set();\r\n+\r\n+  // è§£æãƒœã‚¿ãƒ³æŒ¿å…¥ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’æ¢ã™\r\n   function findInsertTarget() {\r\n     const commentsHeader = document.querySelector('ytd-comments-header-renderer');\r\n     if (!commentsHeader) return null;\r\n     const additional = commentsHeader.querySelector('#additional-section');\r\n     return additional;\r\n   }\r\n \r\n+  // è§£æãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥\r\n   function insertAnalyzeButton() {\r\n-    // æ—¢ã«ãƒœã‚¿ãƒ³ãŒã‚ã‚‹å ´åˆã¯ä½•ã‚‚ã—ãªã„\r\n     if (document.getElementById('ytcmtck-analyze-btn')) return;\r\n-    \r\n     const additional = findInsertTarget();\r\n     if (!additional) {\r\n       console.log('ytcmtck: #additional-section not found, retrying...');\r\n       return;\r\n     }\r\n-      const btn = document.createElement('button');\r\n+    const btn = document.createElement('button');\r\n     btn.id = 'ytcmtck-analyze-btn';\r\n     btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ';\r\n     btn.style.marginLeft = '16px';\r\n     btn.style.marginTop = '2px';\r\n@@ -32,46 +48,15 @@\n     btn.style.height = '36px';\r\n     btn.style.display = 'flex';\r\n     btn.style.alignItems = 'top';\r\n     btn.style.transition = 'background-color 0.1s ease';\r\n-    \r\n-    // #additional-sectionå†…éƒ¨ã®æœ€å¾Œã«æŒ¿å…¥\r\n     additional.appendChild(btn);\r\n     btn.addEventListener('click', onAnalyzeClick);\r\n     console.log('ytcmtck: è§£æãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥ã—ã¾ã—ãŸ');\r\n   }\r\n \r\n-  // MutationObserverã§DOMå¤‰æ›´ã‚’ç›£è¦–\r\n-  function startObserver() {\r\n-    const observer = new MutationObserver((mutations) => {\r\n-      let shouldCheck = false;\r\n-      mutations.forEach((mutation) => {\r\n-        if (mutation.type === 'childList') {\r\n-          mutation.addedNodes.forEach((node) => {\r\n-            if (node.nodeType === 1) { // Element node\r\n-              if (node.matches && (\r\n-                node.matches('ytd-comments-header-renderer') ||\r\n-                node.querySelector && node.querySelector('ytd-comments-header-renderer')\r\n-              )) {\r\n-                shouldCheck = true;\r\n-              }\r\n-            }\r\n-          });\r\n-        }\r\n-      });\r\n-      \r\n-      if (shouldCheck) {\r\n-        setTimeout(insertAnalyzeButton, 500);\r\n-      }\r\n-    });\r\n-\r\n-    observer.observe(document.body, {\r\n-      childList: true,\r\n-      subtree: true\r\n-    });\r\n-    \r\n-    return observer;\r\n-  }  function showResult(message, isFinal) {\r\n+  // ã‚³ãƒ¡ãƒ³ãƒˆçµæœè¡¨ç¤º\r\n+  function showResult(message, isFinal) {\r\n     let result = document.getElementById('ytcmtck-analyze-result');\r\n     if (!result) {\r\n       result = document.createElement('div');\r\n       result.id = 'ytcmtck-analyze-result';\r\n@@ -90,9 +75,8 @@\n     result.textContent = message;\r\n     if (isFinal) {\r\n       result.style.background = '#e6ffe6';\r\n       result.style.fontWeight = '500';\r\n-      // 5ç§’å¾Œã«è‡ªå‹•ã§å‰Šé™¤\r\n       setTimeout(() => {\r\n         if (result && result.parentNode) {\r\n           result.remove();\r\n           addLog('è§£æçµæœè¡¨ç¤ºã‚’è‡ªå‹•ã§å‰Šé™¤ã—ã¾ã—ãŸ', 'info');\r\n@@ -100,19 +84,18 @@\n       }, 5000);\r\n     }\r\n   }\r\n \r\n-  // â˜…APIã‚­ãƒ¼ã‚’ã“ã“ã«è¨­å®šï¼ˆã”è‡ªèº«ã®YouTube Data APIã‚­ãƒ¼ã«å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼‰\r\n-  const YOUTUBE_API_KEY = 'AIzaSyCB9iLVqz1AsLrYk83tILnILa7n6OzfEkg';\r\n-\r\n-  // å‹•ç”»IDã‚’URLã‹ã‚‰å–å¾—\r\n+  // YouTubeå‹•ç”»IDã‚’URLã‹ã‚‰å–å¾—\r\n   function getVideoId() {\r\n     const url = new URL(location.href);\r\n     return url.searchParams.get('v');\r\n-  }  // YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¨ä»¶å–å¾—ï¼ˆæœ€å¤§1000ä»¶ã¾ã§ï¼‰\r\n+  }\r\n+\r\n+  // YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¨ä»¶å–å¾—ï¼ˆæœ€å¤§1000ä»¶ã¾ã§ï¼‰\r\n   async function fetchComments(videoId) {\r\n     if (!videoId) return { count: 0, comments: [] };\r\n-    const maxTotal = 1000; // æœ€å¤§å–å¾—ä»¶æ•°ï¼ˆAPIåˆ¶é™ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®ï¼‰\r\n+    const maxTotal = 1000;\r\n     let comments = [];\r\n     let pageToken = '';\r\n     try {\r\n       while (comments.length < maxTotal) {\r\n@@ -143,21 +126,20 @@\n       console.error('API fetch error:', e);\r\n       return { count: 0, comments: [] };\r\n     }\r\n   }\r\n-  // YouTubeã®æ™‚é–“è¡¨ç¤ºå½¢å¼ã«å¤‰æ›\r\n+\r\n+  // YouTubeã®ã€Œâ—‹åˆ†å‰ã€å½¢å¼\r\n   function formatTimeAgo(publishedAt) {\r\n     const now = new Date();\r\n     const published = new Date(publishedAt);\r\n     const diffMs = now - published;\r\n-    \r\n     const minutes = Math.floor(diffMs / (1000 * 60));\r\n     const hours = Math.floor(diffMs / (1000 * 60 * 60));\r\n     const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n     const weeks = Math.floor(days / 7);\r\n     const months = Math.floor(days / 30);\r\n     const years = Math.floor(days / 365);\r\n-\r\n     if (years > 0) {\r\n       return `${years} å¹´å‰`;\r\n     } else if (months > 0) {\r\n       return `${months} ã‹æœˆå‰`;\r\n@@ -171,155 +153,229 @@\n       return `${minutes} åˆ†å‰`;\r\n     } else {\r\n       return 'ä»Š';\r\n     }\r\n-  }  async function onAnalyzeClick() {\r\n-    // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã—ã¦è§£æé–‹å§‹\r\n+  }\r\n+\r\n+  // ç”»é¢ä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’ã§ãã‚‹ã ã‘æ­£ç¢ºã«å–å¾—ã™ã‚‹\r\n+  function getDisplayedCommentIds() {\r\n+    const ids = new Set();\r\n+    // 1. é€šå¸¸ã‚³ãƒ¡ãƒ³ãƒˆ\r\n+    document.querySelectorAll('ytd-comment-thread-renderer a[href*=\"lc=\"]').forEach(anchor => {\r\n+      const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n+      if (match) ids.add(match[1]);\r\n+    });\r\n+    // 2. è¿”ä¿¡ï¼ˆã‚µãƒ–ã‚³ãƒ¡ãƒ³ãƒˆï¼‰\r\n+    document.querySelectorAll('ytd-comment-renderer a[href*=\"lc=\"]').forEach(anchor => {\r\n+      const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n+      if (match) ids.add(match[1]);\r\n+    });\r\n+    // 3. ãƒœã‚¿ãƒ³å†…ã®ï¼ˆè¦‹è½ã¨ã—é˜²æ­¢ç”¨ï¼‰\r\n+    document.querySelectorAll('ytd-comment-thread-renderer #action-menu-button').forEach(node => {\r\n+      const anchor = node.closest('ytd-comment-thread-renderer')?.querySelector('a[href*=\"lc=\"]');\r\n+      if (anchor) {\r\n+        const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n+        if (match) ids.add(match[1]);\r\n+      }\r\n+    });\r\n+    // 4. data-idå±æ€§ç³»\r\n+    document.querySelectorAll('[data-id]').forEach(node => {\r\n+      ids.add(node.getAttribute('data-id'));\r\n+    });\r\n+    // 5. data-legacy-cmidï¼ˆå¤ã„ä»•æ§˜å¯¾å¿œï¼‰\r\n+    document.querySelectorAll('[data-legacy-cmid]').forEach(node => {\r\n+      ids.add(node.getAttribute('data-legacy-cmid'));\r\n+    });\r\n+    // 6. è§£æã§æŒ¿å…¥ã—ãŸæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ\r\n+    document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]').forEach(node => {\r\n+      const id = node.getAttribute('data-comment-id');\r\n+      if (id) ids.add(id);\r\n+    });\r\n+    return ids;\r\n+  }\r\n+\r\n+  // ç”»é¢ã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã‚’ã§ãã‚‹ã ã‘å…¨ã¦ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\r\n+  async function loadAllVisibleComments(maxTry = 10) {\r\n+    // ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’è‡ªå‹•ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹\r\n+    let tries = 0;\r\n+    while (tries < maxTry) {\r\n+      let moreBtn = Array.from(document.querySelectorAll('ytd-button-renderer'))\r\n+        .find(btn => /ã•ã‚‰ã«è¡¨ç¤º|Show more/i.test(btn.textContent));\r\n+      if (moreBtn) {\r\n+        moreBtn.click();\r\n+        await new Promise(r => setTimeout(r, 1000));\r\n+      } else {\r\n+        break;\r\n+      }\r\n+      tries++;\r\n+    }\r\n+    // ç”»é¢ã‚’è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦é…å»¶ãƒ­ãƒ¼ãƒ‰ã‚‚ä¿ƒã™\r\n+    let lastCount = 0;\r\n+    for (let i = 0; i < maxTry; i++) {\r\n+      window.scrollTo(0, document.body.scrollHeight);\r\n+      await new Promise(r => setTimeout(r, 800));\r\n+      const currCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n+      if (currCount === lastCount) break;\r\n+      lastCount = currCount;\r\n+    }\r\n+  }\r\n+\r\n+  // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸Šéƒ¨ã«æŒ¿å…¥\r\n+  function insertHiddenComment(comment) {\r\n+    const commentElement = document.createElement('ytd-comment-view-model');\r\n+    commentElement.className = 'style-scope ytd-comment-thread-renderer';\r\n+    commentElement.setAttribute('data-ytcmtck-hidden', 'true');\r\n+    commentElement.setAttribute('data-comment-id', comment.id);\r\n+    commentElement.style.borderRadius = '8px';\r\n+    commentElement.style.marginBottom = '16px';\r\n+    commentElement.innerHTML = `\r\n+      <div id=\"body\" class=\"style-scope ytd-comment-view-model\">\r\n+        <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n+          <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n+            <yt-img-shadow fit=\"\" height=\"40\" width=\"40\" class=\"style-scope ytd-comment-view-model no-transition\" style=\"background-color: transparent;\">\r\n+              <img style=\"width: 40px; height: 40px; border-radius: 50%; object-fit: cover;\" src=\"${comment.authorProfileImageUrl}\" alt=\"${comment.author}\" onerror=\"this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNFNUU3RUIiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMzQgMzJDMzQgMjYuNDc3MiAyOS41MjI4IDIyIDI0IDIySDIwSDEyQzEwLjg5NTQgMjIgMTAgMjIuODk1NCAxMCAyNFYzNEgzNFYzMloiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+'\" />\r\n+            </yt-img-shadow>\r\n+          </button>\r\n+        </div>\r\n+        <div id=\"main\" class=\"style-scope ytd-comment-view-model\">\r\n+          <div id=\"header\" class=\"style-scope ytd-comment-view-model\" style=\"display: flex; align-items: center; flex-wrap: wrap; gap: 8px;\">\r\n+            <h3 class=\"style-scope ytd-comment-view-model\" style=\"margin: 0; font-size: 13px; line-height: 18px; font-weight: 500;\">\r\n+              <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"${comment.authorChannelUrl}\" style=\"color: #0f0f0f; text-decoration: none;\">\r\n+                <span class=\"style-scope ytd-comment-view-model\">${comment.author}</span>\r\n+              </a>\r\n+            </h3>\r\n+            <span dir=\"auto\" style=\"color: #606060; font-size: 12px; line-height: 18px;\">\r\n+              <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"/watch?v=${getVideoId()}&lc=${comment.id}\" style=\"color: inherit; text-decoration: none;\">\r\n+                ${formatTimeAgo(comment.publishedAt)}\r\n+              </a>\r\n+            </span>\r\n+          </div>\r\n+          <div style=\"margin-top: 2px;\">\r\n+            <span style=\"color: #0f0f0f; font-size: 14px; line-height: 20px; white-space: pre-wrap;\">${comment.text}</span>\r\n+          </div>\r\n+          <div style=\"margin-top: 8px; display: flex; align-items: center; gap: 8px;\">\r\n+            <button style=\"background: none; border: none; padding: 0px; border-radius: 18px; cursor: pointer; display: flex; align-items: center; gap: 6px;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\" title=\"é«˜è©•ä¾¡\">\r\n+              <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n+                <path d=\"M18.77 11h-4.23l1.52-4.94C16.38 5.03 15.54 4 14.38 4c-.58 0-1.14.24-1.52.65L7 11H3v10h14.43c1.06 0 1.98-.67 2.19-1.61l1.34-6c.27-1.24-.78-2.39-2.19-2.39zM7 20H4v-8h3v8zm12.98-6.83-1.34 6c-.1.48-.61.83-1.21.83H8v-8.61l5.6-6.06c.19-.21.48-.33.78-.33.26 0 .5.11.63.3.07.1.15.26.09.47l-1.52 4.94-.4 1.29h5.58c.41 0 .8.17 1.03.46.13.15.26.4.19.71z\"/>\r\n+              </svg>\r\n+              ${comment.likeCount > 0 ? `<span style=\"font-size: 12px; color: #606060;\">${comment.likeCount}</span>` : ''}\r\n+            </button>\r\n+            <button style=\"background: none; border: none; border-radius: 18px; padding: 0px; cursor: pointer; display: flex; align-items: center;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\">\r\n+              <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n+                <path d=\"M17 4H6.57c-1.07 0-1.98.67-2.19 1.61l-1.34 6C2.77 12.85 3.82 14 5.23 14h4.23l-1.52 4.94C7.62 19.97 8.46 21 9.62 21c.58 0 1.14-.24 1.52-.65L17 14h4V4h-4zm-6.6 15.67c-.19.21-.48.33-.78.33-.26 0-.5-.11-.63-.3-.07-.1-.15-.26-.09-.47l1.52-4.94.4-1.29H5.23c-.41 0-.8-.17-1.03-.46-.12-.15-.25-.4-.18-.72l1.34-6c.1-.47.61-.82 1.21-.82H16v8.61l-5.6 6.06zM20 13h-3V5h3v8z\"/>\r\n+              </svg>\r\n+            </button>\r\n+            <button style=\"background: none; border: none; padding: 6px 16px; border-radius: 18px; cursor: pointer; font-size: 12px; font-weight: 500; onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\">\r\n+              è¿”ä¿¡\r\n+            </button>\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+    `;\r\n+    const commentSection = document.querySelector('#comments #contents');\r\n+    if (commentSection) commentSection.prepend(commentElement);\r\n+  }\r\n+\r\n+  // è§£æã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒ¡ã‚¤ãƒ³å‡¦ç†\r\n+  async function onAnalyzeClick() {\r\n     addLog('ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n     showResult('è§£æä¸­...', false);\r\n \r\n-    // ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’æœ€æ–°å–å¾—\r\n+    addLog('ã¾ãšç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã§ãã‚‹ã ã‘å…¨ã¦èª­ã¿è¾¼ã¿ã¾ã™', 'progress');\r\n+    await loadAllVisibleComments(10);\r\n+\r\n+    addLog('ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’å–å¾—...', 'progress');\r\n     displayedCommentIds = getDisplayedCommentIds();\r\n-    addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'info');\r\n-    \r\n+    addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'success');\r\n+\r\n     addLog('å‹•ç”»IDã‚’å–å¾—ä¸­...', 'progress');\r\n     const videoId = getVideoId();\r\n     if (!videoId) {\r\n       addLog('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', 'error');\r\n       showResult('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n       return;\r\n     }\r\n     addLog(`å‹•ç”»ID: ${videoId}`, 'success');\r\n-    \r\n-    addLog('YouTubeä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’å–å¾—ä¸­...', 'progress');\r\n-    const ytComments = document.querySelectorAll('#contents #content-text');\r\n-    const ytCount = ytComments.length;\r\n-    addLog(`YouTubeä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${ytCount}ä»¶`, 'success');\r\n-    \r\n-    await new Promise(r => setTimeout(r, 1000));\r\n+\r\n+    await new Promise(r => setTimeout(r, 500));\r\n     addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ä¸­...', 'api');\r\n-    \r\n     const apiData = await fetchComments(videoId);\r\n     const apiCount = apiData.count;\r\n-    \r\n     if (apiData.count === 0 && apiData.comments.length === 0) {\r\n       addLog('è­¦å‘Š: APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ (APIã‚­ãƒ¼ã¾ãŸã¯æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„)', 'error');\r\n-    } else {\r\n-      addLog(`APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ: ${apiCount}ä»¶`, 'success');\r\n+      showResult('APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n+      return;\r\n     }\r\n-    \r\n+    addLog(`APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ: ${apiCount}ä»¶`, 'success');\r\n+\r\n     showResult('è§£æãŒå®Œäº†ã—ã¾ã—ãŸã€‚', false);\r\n     addLog('è§£æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');\r\n-    \r\n-    await new Promise(r => setTimeout(r, 1000));\r\n-    \r\n+    await new Promise(r => setTimeout(r, 500));\r\n+\r\n+    // --- ã“ã“ã‹ã‚‰ä¿®æ­£ç‰ˆï¼šIDãƒ™ãƒ¼ã‚¹ã§æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®š ---\r\n     let resultMsg = 'è§£æçµæœï¼š\\n';\r\n-    \r\n-    if (ytCount === apiCount) {\r\n+    // APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆå…¨ä»¶ã‹ã‚‰ã€Œç”»é¢ä¸Šã«ãªã„IDã€ã®ã¿ã‚’æœªè¡¨ç¤ºæ‰±ã„\r\n+    const newHiddenComments = apiData.comments.filter(comment => !displayedCommentIds.has(comment.id));\r\n+    if (newHiddenComments.length === 0) {\r\n       resultMsg += 'å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚';\r\n       addLog('çµæœ: å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™', 'success');\r\n     } else {\r\n-      const hiddenCount = Math.max(0, apiCount - ytCount);\r\n-      resultMsg += 'è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã‚³ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã£ãŸãŸã‚ã€ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã®ãƒˆãƒƒãƒ—ã«è¡¨ç¤ºã—ã¾ã—ãŸ';\r\n-      addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${hiddenCount}ä»¶ã‚’æ¤œå‡º`, 'progress');      // APIã§å–å¾—ã—ãŸæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸Šéƒ¨ã«è¡¨ç¤º\r\n-      const hiddenComments = apiData.comments.slice(ytCount); // è¡¨ç¤ºåˆ†ã‚’é™¤ã„ãŸæ®‹ã‚Š\r\n-      if (hiddenComments.length > 0) {\r\n-        // æ–°ã—ã„æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆé‡è¤‡é™¤å»ï¼‰\r\n-        const newHiddenComments = hiddenComments.filter(comment => !displayedCommentIds.has(comment.id));\r\n-        \r\n-        if (newHiddenComments.length > 0) {\r\n-          addLog(`æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºä¸­...`, 'progress');\r\n-          newHiddenComments.forEach((comment, index) => {\r\n-            addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${index + 1}/${newHiddenComments.length} ã‚’æŒ¿å…¥: ${comment.author}`, 'progress');\r\n-            \r\n-            // è¡¨ç¤ºæ¸ˆã¿ãƒªã‚¹ãƒˆã«è¿½åŠ \r\n-            displayedCommentIds.add(comment.id);\r\n-            \r\n-            const commentElement = document.createElement('ytd-comment-view-model');\r\n-            commentElement.className = 'style-scope ytd-comment-thread-renderer';\r\n-            commentElement.setAttribute('data-ytcmtck-hidden', 'true'); // è­˜åˆ¥ç”¨ãƒãƒ¼ã‚«ãƒ¼\r\n-            commentElement.style.borderRadius = '8px';\r\n-            commentElement.style.marginBottom = '16px';\r\n-            commentElement.innerHTML = `\r\n-            \r\n-            <div id=\"body\" class=\"style-scope ytd-comment-view-model\">              <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n-                <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n-                  <yt-img-shadow fit=\"\" height=\"40\" width=\"40\" class=\"style-scope ytd-comment-view-model no-transition\" style=\"background-color: transparent;\">\r\n-                    <img style=\"width: 40px; height: 40px; border-radius: 50%; object-fit: cover;\" src=\"${comment.authorProfileImageUrl}\" alt=\"${comment.author}\" onerror=\"this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNFNUU3RUIiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMzQgMzJDMzQgMjYuNDc3MiAyOS41MjI4IDIyIDI0IDIySDIwSDEyQzEwLjg5NTQgMjIgMTAgMjIuODk1NCAxMCAyNFYzNEgzNFYzMloiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+'\">\r\n-                  </yt-img-shadow>\r\n-                </button>\r\n-              </div>\r\n-              <div id=\"main\" class=\"style-scope ytd-comment-view-model\">\r\n-                <div id=\"header\" class=\"style-scope ytd-comment-view-model\" style=\"display: flex; align-items: center; flex-wrap: wrap; gap: 8px;\">\r\n-                  <h3 class=\"style-scope ytd-comment-view-model\" style=\"margin: 0; font-size: 13px; line-height: 18px; font-weight: 500;\"> \r\n-                    <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"${comment.authorChannelUrl}\" style=\"color: #0f0f0f; text-decoration: none;\">\r\n-                      <span class=\"style-scope ytd-comment-view-model\">${comment.author}</span>\r\n-                    </a>\r\n-                  </h3>\r\n-                  <span dir=\"auto\" style=\"color: #606060; font-size: 12px; line-height: 18px;\">\r\n-                    <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"/watch?v=${getVideoId()}&lc=${comment.id}\" style=\"color: inherit; text-decoration: none;\">\r\n-                      ${formatTimeAgo(comment.publishedAt)}\r\n-                    </a>\r\n-                  </span>\r\n-                </div>\r\n-                <div style=\"margin-top: 2px;\">\r\n-                  <span style=\"color: #0f0f0f; font-size: 14px; line-height: 20px; white-space: pre-wrap;\">${comment.text}</span>\r\n-                </div>                <div style=\"margin-top: 8px; display: flex; align-items: center; gap: 8px;\">\r\n-                  <button style=\"background: none; border: none; padding: 0px; border-radius: 18px; cursor: pointer; display: flex; align-items: center; gap: 6px;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\" title=\"é«˜è©•ä¾¡\">\r\n-                    <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n-                      <path d=\"M18.77 11h-4.23l1.52-4.94C16.38 5.03 15.54 4 14.38 4c-.58 0-1.14.24-1.52.65L7 11H3v10h14.43c1.06 0 1.98-.67 2.19-1.61l1.34-6c.27-1.24-.78-2.39-2.19-2.39zM7 20H4v-8h3v8zm12.98-6.83-1.34 6c-.1.48-.61.83-1.21.83H8v-8.61l5.6-6.06c.19-.21.48-.33.78-.33.26 0 .5.11.63.3.07.1.15.26.09.47l-1.52 4.94-.4 1.29h5.58c.41 0 .8.17 1.03.46.13.15.26.4.19.71z\"/>\r\n-                    </svg>\r\n-                    ${comment.likeCount > 0 ? `<span style=\"font-size: 12px; color: #606060;\">${comment.likeCount}</span>` : ''}\r\n-                  </button>\r\n-                  <button style=\"background: none; border: none; border-radius: 18px; padding: 0px; cursor: pointer; display: flex; align-items: center;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\">\r\n-                    <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n-                      <path d=\"M17 4H6.57c-1.07 0-1.98.67-2.19 1.61l-1.34 6C2.77 12.85 3.82 14 5.23 14h4.23l-1.52 4.94C7.62 19.97 8.46 21 9.62 21c.58 0 1.14-.24 1.52-.65L17 14h4V4h-4zm-6.6 15.67c-.19.21-.48.33-.78.33-.26 0-.5-.11-.63-.3-.07-.1-.15-.26-.09-.47l1.52-4.94.4-1.29H5.23c-.41 0-.8-.17-1.03-.46-.12-.15-.25-.4-.18-.72l1.34-6c.1-.47.61-.82 1.21-.82H16v8.61l-5.6 6.06zM20 13h-3V5h3v8z\"/>\r\n-                    </svg>\r\n-                  </button>\r\n-                  <button style=\"background: none; border: none; padding: 6px 16px; border-radius: 18px; cursor: pointer; font-size: 12px; font-weight: 500; onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\">\r\n-                    è¿”ä¿¡\r\n-                  </button>\r\n-                </div>\r\n-              </div>\r\n-            </div>\r\n-          `;            const commentSection = document.querySelector('#comments #contents');\r\n-            if (commentSection) commentSection.prepend(commentElement);\r\n-          });          addLog(`${newHiddenComments.length}ä»¶ã®æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n-          addLog(`ç´¯è¨ˆè¡¨ç¤ºæ¸ˆã¿æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${displayedCommentIds.size}ä»¶`, 'info');\r\n-        } else {\r\n-          addLog('æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼ˆæ—¢ã«è¡¨ç¤ºæ¸ˆã¿ï¼‰', 'info');\r\n-          addLog(`ç´¯è¨ˆè¡¨ç¤ºæ¸ˆã¿æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${displayedCommentIds.size}ä»¶`, 'info');\r\n-        }\r\n-      }\r\n+      resultMsg += `æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚`;\r\n+      addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’æ¤œå‡º`, 'progress');\r\n+      newHiddenComments.forEach(comment => {\r\n+        insertHiddenComment(comment);\r\n+        displayedCommentIds.add(comment.id);\r\n+      });\r\n+      addLog(`${newHiddenComments.length}ä»¶ã®æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n     }\r\n     showResult(resultMsg, true);\r\n     addLog('ğŸ‰ ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n-    \r\n-    // 3ç§’å¾Œã«ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è‡ªå‹•ã§é–‰ã˜ã‚‹\r\n+\r\n     setTimeout(() => {\r\n       addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™ (æ‰‹å‹•ã§é–‰ã˜ã‚‹ã“ã¨ã‚‚å¯èƒ½)', 'info');\r\n       setTimeout(closeLogPopup, 2000);\r\n     }, 3000);\r\n   }\r\n-  // å‹•çš„ãƒšãƒ¼ã‚¸å¯¾å¿œã¨MutationObserver\r\n+\r\n+  // MutationObserverã§DOMå¤‰åŒ–ç›£è¦–\r\n+  function startObserver() {\r\n+    const observer = new MutationObserver((mutations) => {\r\n+      let shouldCheck = false;\r\n+      mutations.forEach((mutation) => {\r\n+        if (mutation.type === 'childList') {\r\n+          mutation.addedNodes.forEach((node) => {\r\n+            if (node.nodeType === 1) {\r\n+              if (node.matches && (\r\n+                node.matches('ytd-comments-header-renderer') ||\r\n+                node.querySelector && node.querySelector('ytd-comments-header-renderer')\r\n+              )) {\r\n+                shouldCheck = true;\r\n+              }\r\n+            }\r\n+          });\r\n+        }\r\n+      });\r\n+      if (shouldCheck) {\r\n+        setTimeout(insertAnalyzeButton, 500);\r\n+      }\r\n+    });\r\n+    observer.observe(document.body, { childList: true, subtree: true });\r\n+    return observer;\r\n+  }\r\n+\r\n+  // å‹•çš„ãƒšãƒ¼ã‚¸å¯¾å¿œï¼‹ãƒœã‚¿ãƒ³ç›£è¦–\r\n   let lastUrl = location.href;\r\n   let checkInterval;\r\n   let observer;\r\n-\r\n   function startMonitoring() {\r\n-    // MutationObserverã‚’é–‹å§‹\r\n     observer = startObserver();\r\n-    \r\n-    // URLãƒã‚§ãƒƒã‚¯ç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«\r\n     checkInterval = setInterval(() => {\r\n       if (location.href !== lastUrl) {\r\n         lastUrl = location.href;\r\n         console.log('ytcmtck: ãƒšãƒ¼ã‚¸é·ç§»ã‚’æ¤œå‡ºã€ãƒœã‚¿ãƒ³å†æŒ¿å…¥ã‚’è©¦è¡Œ');\r\n         setTimeout(insertAnalyzeButton, 1000);\r\n-        setTimeout(insertAnalyzeButton, 3000); // é…å»¶èª­ã¿è¾¼ã¿å¯¾å¿œ\r\n+        setTimeout(insertAnalyzeButton, 3000);\r\n       }\r\n-      \r\n-      // ãƒœã‚¿ãƒ³ãŒæ¶ˆãˆãŸå ´åˆã®å¾©æ—§\r\n       if (!document.getElementById('ytcmtck-analyze-btn') && findInsertTarget()) {\r\n         console.log('ytcmtck: ãƒœã‚¿ãƒ³ãŒæ¶ˆå¤±ã€å†æŒ¿å…¥');\r\n         insertAnalyzeButton();\r\n       }\r\n@@ -327,25 +383,20 @@\n   }\r\n \r\n   // åˆæœŸåŒ–\r\n   function init() {\r\n-    // è¤‡æ•°å›è©¦è¡Œã§ç¢ºå®Ÿã«æŒ¿å…¥\r\n     setTimeout(insertAnalyzeButton, 1000);\r\n     setTimeout(insertAnalyzeButton, 3000);\r\n     setTimeout(insertAnalyzeButton, 5000);\r\n-    \r\n-    // ç›£è¦–é–‹å§‹\r\n     startMonitoring();\r\n   }\r\n-\r\n-  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–\r\n   if (document.readyState === 'loading') {\r\n     document.addEventListener('DOMContentLoaded', init);\r\n   } else {\r\n     init();\r\n   }\r\n \r\n-  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’ä½œæˆãƒ»è¡¨ç¤º\r\n+  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ä½œæˆãƒ»è¡¨ç¤º\r\n   function showLogPopup() {\r\n     let popup = document.getElementById('ytcmtck-log-popup');\r\n     if (!popup) {\r\n       popup = document.createElement('div');\r\n@@ -362,9 +413,8 @@\n       popup.style.zIndex = '10000';\r\n       popup.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n       popup.style.fontSize = '14px';\r\n       popup.style.overflow = 'hidden';\r\n-      \r\n       const header = document.createElement('div');\r\n       header.style.backgroundColor = '#cc0000';\r\n       header.style.color = '#fff';\r\n       header.style.padding = '12px';\r\n@@ -372,9 +422,8 @@\n       header.style.display = 'flex';\r\n       header.style.justifyContent = 'space-between';\r\n       header.style.alignItems = 'center';\r\n       header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚°';\r\n-      \r\n       const closeBtn = document.createElement('button');\r\n       closeBtn.innerHTML = 'Ã—';\r\n       closeBtn.style.backgroundColor = 'transparent';\r\n       closeBtn.style.border = 'none';\r\n@@ -385,62 +434,40 @@\n       closeBtn.style.width = '24px';\r\n       closeBtn.style.height = '24px';\r\n       closeBtn.onclick = () => popup.remove();\r\n       header.appendChild(closeBtn);\r\n-      \r\n       const content = document.createElement('div');\r\n       content.id = 'ytcmtck-log-content';\r\n       content.style.padding = '16px';\r\n       content.style.maxHeight = '400px';\r\n       content.style.overflowY = 'auto';\r\n       content.style.lineHeight = '1.4';\r\n-      \r\n       popup.appendChild(header);\r\n       popup.appendChild(content);\r\n       document.body.appendChild(popup);\r\n     }\r\n     return popup;\r\n   }\r\n \r\n-  // ãƒ­ã‚°ã‚’è¿½åŠ \r\n+  // ãƒ­ã‚°è¿½åŠ \r\n   function addLog(message, type = 'info') {\r\n     const popup = showLogPopup();\r\n     const content = document.getElementById('ytcmtck-log-content');\r\n     const logEntry = document.createElement('div');\r\n     logEntry.style.marginBottom = '8px';\r\n     logEntry.style.padding = '8px';\r\n     logEntry.style.borderRadius = '4px';\r\n-    \r\n     const timestamp = new Date().toLocaleTimeString('ja-JP');\r\n     let icon = '';\r\n     let bgColor = '';\r\n-    \r\n     switch(type) {\r\n-      case 'start':\r\n-        icon = 'ğŸš€';\r\n-        bgColor = '#e3f2fd';\r\n-        break;\r\n-      case 'progress':\r\n-        icon = 'â³';\r\n-        bgColor = '#fff3e0';\r\n-        break;\r\n-      case 'success':\r\n-        icon = 'âœ…';\r\n-        bgColor = '#e8f5e8';\r\n-        break;\r\n-      case 'error':\r\n-        icon = 'âŒ';\r\n-        bgColor = '#ffebee';\r\n-        break;\r\n-      case 'api':\r\n-        icon = 'ğŸ”—';\r\n-        bgColor = '#f3e5f5';\r\n-        break;\r\n-      default:\r\n-        icon = 'â„¹ï¸';\r\n-        bgColor = '#f5f5f5';\r\n+      case 'start': icon = 'ğŸš€'; bgColor = '#e3f2fd'; break;\r\n+      case 'progress': icon = 'â³'; bgColor = '#fff3e0'; break;\r\n+      case 'success': icon = 'âœ…'; bgColor = '#e8f5e8'; break;\r\n+      case 'error': icon = 'âŒ'; bgColor = '#ffebee'; break;\r\n+      case 'api': icon = 'ğŸ”—'; bgColor = '#f3e5f5'; break;\r\n+      default: icon = 'â„¹ï¸'; bgColor = '#f5f5f5';\r\n     }\r\n-    \r\n     logEntry.style.backgroundColor = bgColor;\r\n     logEntry.innerHTML = `<span style=\"color: #666; font-size: 12px;\">${timestamp}</span> ${icon} ${message}`;\r\n     content.appendChild(logEntry);\r\n     content.scrollTop = content.scrollHeight;\r\n@@ -450,30 +477,5 @@\n   function closeLogPopup() {\r\n     const popup = document.getElementById('ytcmtck-log-popup');\r\n     if (popup) popup.remove();\r\n   }\r\n-\r\n-  // æ—¢ã«è¡¨ç¤ºæ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’è¨˜éŒ²ã™ã‚‹é…åˆ—\r\n-  let displayedCommentIds = new Set();\r\n-\r\n-  // æ—¢å­˜ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°\r\n-  function removeExistingHiddenComments() {\r\n-    const existingComments = document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]');\r\n-    existingComments.forEach(comment => comment.remove());\r\n-    addLog(`æ—¢å­˜ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${existingComments.length}ä»¶ã‚’å‰Šé™¤`, 'progress');\r\n-  }\r\n-\r\n-  // ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’ã™ã¹ã¦å–å¾—\r\n-  function getDisplayedCommentIds() {\r\n-    const nodes = document.querySelectorAll('ytd-comment-thread-renderer #comment #action-menu-button');\r\n-    const ids = new Set();\r\n-    nodes.forEach(node => {\r\n-      // ã‚³ãƒ¡ãƒ³ãƒˆã®permalinkã‹ã‚‰IDã‚’æŠ½å‡º\r\n-      const anchor = node.closest('ytd-comment-thread-renderer')?.querySelector('a[href*=\"lc=\"]');\r\n-      if (anchor) {\r\n-        const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n-        if (match) ids.add(match[1]);\r\n-      }\r\n-    });\r\n-    return ids;\r\n-  }\r\n-})();\r\n+})();\n\\ No newline at end of file\n"
                },
                {
                    "date": 1750259292396,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n // ==UserScript==\r\n-// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ«\r\n+// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)\r\n // @namespace    https://github.com/yourname/\r\n-// @version      1.1.0\r\n-// @description  YouTubeã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§APIä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã¨ç”»é¢ä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¯”è¼ƒã—ã€æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ã‚’æ¤œå‡ºã—ã¦æœ€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã™ã€‚IDå–å¾—ã®ä¿¡é ¼æ€§ã‚‚å‘ä¸Šã€‚\r\n+// @version      1.2.0\r\n+// @description  YouTubeã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§APIä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã¨ç”»é¢ä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¯”è¼ƒã—ã€æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ã‚’æ¤œå‡ºã—ã¦æœ€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã™ã€‚ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ä»˜ãã€‚\r\n // @author       YourName\r\n // @match        https://www.youtube.com/watch*\r\n // @grant        none\r\n // ==/UserScript==\r\n@@ -34,9 +34,9 @@\n       return;\r\n     }\r\n     const btn = document.createElement('button');\r\n     btn.id = 'ytcmtck-analyze-btn';\r\n-    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ';\r\n+    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)';\r\n     btn.style.marginLeft = '16px';\r\n     btn.style.marginTop = '2px';\r\n     btn.style.background = 'transparent';\r\n     btn.style.color = '#0f0f0f';\r\n@@ -80,9 +80,9 @@\n         if (result && result.parentNode) {\r\n           result.remove();\r\n           addLog('è§£æçµæœè¡¨ç¤ºã‚’è‡ªå‹•ã§å‰Šé™¤ã—ã¾ã—ãŸ', 'info');\r\n         }\r\n-      }, 5000);\r\n+      }, 10000); // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚10ç§’ã«å»¶é•·\r\n     }\r\n   }\r\n \r\n   // YouTubeå‹•ç”»IDã‚’URLã‹ã‚‰å–å¾—\r\n@@ -155,69 +155,94 @@\n       return 'ä»Š';\r\n     }\r\n   }\r\n \r\n-  // ç”»é¢ä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’ã§ãã‚‹ã ã‘æ­£ç¢ºã«å–å¾—ã™ã‚‹\r\n+  // ç”»é¢ä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’ã§ãã‚‹ã ã‘æ­£ç¢ºã«å–å¾—ã™ã‚‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç‰ˆï¼‰\r\n   function getDisplayedCommentIds() {\r\n     const ids = new Set();\r\n-    // 1. é€šå¸¸ã‚³ãƒ¡ãƒ³ãƒˆ\r\n-    document.querySelectorAll('ytd-comment-thread-renderer a[href*=\"lc=\"]').forEach(anchor => {\r\n-      const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n-      if (match) ids.add(match[1]);\r\n+    const debugInfo = [];\r\n+    \r\n+    // 1. é€šå¸¸ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆãƒ¡ã‚¤ãƒ³ã®æ–¹æ³•ï¼‰\r\n+    document.querySelectorAll('ytd-comment-thread-renderer').forEach((threadRenderer, index) => {\r\n+      // ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ã®ãƒªãƒ³ã‚¯ã‹ã‚‰IDã‚’å–å¾—\r\n+      const linkWithLc = threadRenderer.querySelector('a[href*=\"lc=\"]');\r\n+      if (linkWithLc) {\r\n+        const match = linkWithLc.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n+        if (match) {\r\n+          ids.add(match[1]);\r\n+          debugInfo.push(`æ–¹æ³•1-${index}: ${match[1]} (${threadRenderer.querySelector('#content-text')?.textContent?.slice(0, 30) || 'ãƒ†ã‚­ã‚¹ãƒˆä¸æ˜'}...)`);\r\n+        }\r\n+      }\r\n+      \r\n+      // dataå±æ€§ç³»ã‚‚ç¢ºèª\r\n+      const dataId = threadRenderer.getAttribute('data-id');\r\n+      if (dataId) {\r\n+        ids.add(dataId);\r\n+        debugInfo.push(`data-id-${index}: ${dataId}`);\r\n+      }\r\n     });\r\n-    // 2. è¿”ä¿¡ï¼ˆã‚µãƒ–ã‚³ãƒ¡ãƒ³ãƒˆï¼‰\r\n-    document.querySelectorAll('ytd-comment-renderer a[href*=\"lc=\"]').forEach(anchor => {\r\n-      const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n-      if (match) ids.add(match[1]);\r\n+\r\n+    // 2. è¿”ä¿¡ã‚³ãƒ¡ãƒ³ãƒˆ\r\n+    document.querySelectorAll('ytd-comment-renderer').forEach((commentRenderer, index) => {\r\n+      const linkWithLc = commentRenderer.querySelector('a[href*=\"lc=\"]');\r\n+      if (linkWithLc) {\r\n+        const match = linkWithLc.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n+        if (match) {\r\n+          ids.add(match[1]);\r\n+          debugInfo.push(`è¿”ä¿¡${index}: ${match[1]}`);\r\n+        }\r\n+      }\r\n     });\r\n-    // 3. ãƒœã‚¿ãƒ³å†…ã®ï¼ˆè¦‹è½ã¨ã—é˜²æ­¢ç”¨ï¼‰\r\n-    document.querySelectorAll('ytd-comment-thread-renderer #action-menu-button').forEach(node => {\r\n-      const anchor = node.closest('ytd-comment-thread-renderer')?.querySelector('a[href*=\"lc=\"]');\r\n-      if (anchor) {\r\n-        const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n-        if (match) ids.add(match[1]);\r\n+\r\n+    // 3. æ—¢ã«æŒ¿å…¥ã—ãŸæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ\r\n+    document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]').forEach((hiddenComment, index) => {\r\n+      const commentId = hiddenComment.getAttribute('data-comment-id');\r\n+      if (commentId) {\r\n+        ids.add(commentId);\r\n+        debugInfo.push(`æ—¢å­˜æœªè¡¨ç¤º${index}: ${commentId}`);\r\n       }\r\n     });\r\n-    // 4. data-idå±æ€§ç³»\r\n-    document.querySelectorAll('[data-id]').forEach(node => {\r\n-      ids.add(node.getAttribute('data-id'));\r\n-    });\r\n-    // 5. data-legacy-cmidï¼ˆå¤ã„ä»•æ§˜å¯¾å¿œï¼‰\r\n-    document.querySelectorAll('[data-legacy-cmid]').forEach(node => {\r\n-      ids.add(node.getAttribute('data-legacy-cmid'));\r\n-    });\r\n-    // 6. è§£æã§æŒ¿å…¥ã—ãŸæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ\r\n-    document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]').forEach(node => {\r\n-      const id = node.getAttribute('data-comment-id');\r\n-      if (id) ids.add(id);\r\n-    });\r\n+\r\n+    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ãƒ­ã‚°ã«å‡ºåŠ›\r\n+    addLog(`=== ãƒ‡ãƒãƒƒã‚°: ç”»é¢ä¸Šã§æ¤œå‡ºã—ãŸã‚³ãƒ¡ãƒ³ãƒˆIDä¸€è¦§ ===`, 'debug');\r\n+    debugInfo.forEach(info => addLog(info, 'debug'));\r\n+    addLog(`=== åˆè¨ˆ: ${ids.size}å€‹ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ID ===`, 'debug');\r\n+    \r\n     return ids;\r\n   }\r\n \r\n   // ç”»é¢ã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã‚’ã§ãã‚‹ã ã‘å…¨ã¦ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\r\n   async function loadAllVisibleComments(maxTry = 10) {\r\n+    addLog('ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¨ã¦èª­ã¿è¾¼ã¿ä¸­...', 'progress');\r\n+    \r\n     // ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’è‡ªå‹•ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹\r\n     let tries = 0;\r\n     while (tries < maxTry) {\r\n       let moreBtn = Array.from(document.querySelectorAll('ytd-button-renderer'))\r\n         .find(btn => /ã•ã‚‰ã«è¡¨ç¤º|Show more/i.test(btn.textContent));\r\n-      if (moreBtn) {\r\n+      if (moreBtn && moreBtn.offsetParent !== null) { // è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒœã‚¿ãƒ³ã®ã¿\r\n+        addLog(`ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ (${tries + 1}/${maxTry})`, 'progress');\r\n         moreBtn.click();\r\n-        await new Promise(r => setTimeout(r, 1000));\r\n+        await new Promise(r => setTimeout(r, 2000)); // å°‘ã—é•·ã‚ã«å¾…æ©Ÿ\r\n       } else {\r\n+        addLog('ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€å…¨ã¦èª­ã¿è¾¼ã¿å®Œäº†', 'info');\r\n         break;\r\n       }\r\n       tries++;\r\n     }\r\n+    \r\n     // ç”»é¢ã‚’è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦é…å»¶ãƒ­ãƒ¼ãƒ‰ã‚‚ä¿ƒã™\r\n     let lastCount = 0;\r\n     for (let i = 0; i < maxTry; i++) {\r\n       window.scrollTo(0, document.body.scrollHeight);\r\n-      await new Promise(r => setTimeout(r, 800));\r\n+      await new Promise(r => setTimeout(r, 1000));\r\n       const currCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n-      if (currCount === lastCount) break;\r\n+      addLog(`ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« ${i + 1}/${maxTry}: ${currCount}ä»¶ã®ã‚³ãƒ¡ãƒ³ãƒˆè¦ç´ `, 'progress');\r\n+      if (currCount === lastCount && i > 2) break; // 3å›å¤‰åŒ–ãŒãªã‘ã‚Œã°çµ‚äº†\r\n       lastCount = currCount;\r\n     }\r\n+    \r\n+    addLog(`ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${lastCount}ä»¶`, 'success');\r\n   }\r\n \r\n   // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸Šéƒ¨ã«æŒ¿å…¥\r\n   function insertHiddenComment(comment) {\r\n@@ -226,9 +251,14 @@\n     commentElement.setAttribute('data-ytcmtck-hidden', 'true');\r\n     commentElement.setAttribute('data-comment-id', comment.id);\r\n     commentElement.style.borderRadius = '8px';\r\n     commentElement.style.marginBottom = '16px';\r\n+    commentElement.style.backgroundColor = '#fff3cd'; // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã¯è–„é»„è‰²èƒŒæ™¯\r\n+    commentElement.style.border = '2px solid #856404'; // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šå¢ƒç•Œç·š\r\n     commentElement.innerHTML = `\r\n+      <div style=\"background: #856404; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n+        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (ID: ${comment.id})\r\n+      </div>\r\n       <div id=\"body\" class=\"style-scope ytd-comment-view-model\">\r\n         <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n           <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n             <yt-img-shadow fit=\"\" height=\"40\" width=\"40\" class=\"style-scope ytd-comment-view-model no-transition\" style=\"background-color: transparent;\">\r\n@@ -252,22 +282,9 @@\n           <div style=\"margin-top: 2px;\">\r\n             <span style=\"color: #0f0f0f; font-size: 14px; line-height: 20px; white-space: pre-wrap;\">${comment.text}</span>\r\n           </div>\r\n           <div style=\"margin-top: 8px; display: flex; align-items: center; gap: 8px;\">\r\n-            <button style=\"background: none; border: none; padding: 0px; border-radius: 18px; cursor: pointer; display: flex; align-items: center; gap: 6px;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\" title=\"é«˜è©•ä¾¡\">\r\n-              <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n-                <path d=\"M18.77 11h-4.23l1.52-4.94C16.38 5.03 15.54 4 14.38 4c-.58 0-1.14.24-1.52.65L7 11H3v10h14.43c1.06 0 1.98-.67 2.19-1.61l1.34-6c.27-1.24-.78-2.39-2.19-2.39zM7 20H4v-8h3v8zm12.98-6.83-1.34 6c-.1.48-.61.83-1.21.83H8v-8.61l5.6-6.06c.19-.21.48-.33.78-.33.26 0 .5.11.63.3.07.1.15.26.09.47l-1.52 4.94-.4 1.29h5.58c.41 0 .8.17 1.03.46.13.15.26.4.19.71z\"/>\r\n-              </svg>\r\n-              ${comment.likeCount > 0 ? `<span style=\"font-size: 12px; color: #606060;\">${comment.likeCount}</span>` : ''}\r\n-            </button>\r\n-            <button style=\"background: none; border: none; border-radius: 18px; padding: 0px; cursor: pointer; display: flex; align-items: center;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\">\r\n-              <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n-                <path d=\"M17 4H6.57c-1.07 0-1.98.67-2.19 1.61l-1.34 6C2.77 12.85 3.82 14 5.23 14h4.23l-1.52 4.94C7.62 19.97 8.46 21 9.62 21c.58 0 1.14-.24 1.52-.65L17 14h4V4h-4zm-6.6 15.67c-.19.21-.48.33-.78.33-.26 0-.5-.11-.63-.3-.07-.1-.15-.26-.09-.47l1.52-4.94.4-1.29H5.23c-.41 0-.8-.17-1.03-.46-.12-.15-.25-.4-.18-.72l1.34-6c.1-.47.61-.82 1.21-.82H16v8.61l-5.6 6.06zM20 13h-3V5h3v8z\"/>\r\n-              </svg>\r\n-            </button>\r\n-            <button style=\"background: none; border: none; padding: 6px 16px; border-radius: 18px; cursor: pointer; font-size: 12px; font-weight: 500; onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\">\r\n-              è¿”ä¿¡\r\n-            </button>\r\n+            <span style=\"font-size: 12px; color: #856404;\">ğŸ‘† ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒæ—¢ã«ä¸‹ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é‡è¤‡ã§ã™</span>\r\n           </div>\r\n         </div>\r\n       </div>\r\n     `;\r\n@@ -276,13 +293,13 @@\n   }\r\n \r\n   // è§£æã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒ¡ã‚¤ãƒ³å‡¦ç†\r\n   async function onAnalyzeClick() {\r\n-    addLog('ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n+    addLog('ğŸ” ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n     showResult('è§£æä¸­...', false);\r\n \r\n     addLog('ã¾ãšç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã§ãã‚‹ã ã‘å…¨ã¦èª­ã¿è¾¼ã¿ã¾ã™', 'progress');\r\n-    await loadAllVisibleComments(10);\r\n+    await loadAllVisibleComments(5); // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—æ¸›ã‚‰ã™\r\n \r\n     addLog('ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’å–å¾—...', 'progress');\r\n     displayedCommentIds = getDisplayedCommentIds();\r\n     addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'success');\r\n@@ -306,21 +323,32 @@\n       return;\r\n     }\r\n     addLog(`APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ: ${apiCount}ä»¶`, 'success');\r\n \r\n+    // ãƒ‡ãƒãƒƒã‚°ï¼šAPIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆã®æœ€åˆã®5ä»¶ã‚’ãƒ­ã‚°å‡ºåŠ›\r\n+    addLog('=== ãƒ‡ãƒãƒƒã‚°: APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆã®æœ€åˆã®5ä»¶ ===', 'debug');\r\n+    apiData.comments.slice(0, 5).forEach((comment, index) => {\r\n+      addLog(`API${index + 1}: ${comment.id} - ${comment.author}: ${comment.text.slice(0, 30)}...`, 'debug');\r\n+    });\r\n+\r\n     showResult('è§£æãŒå®Œäº†ã—ã¾ã—ãŸã€‚', false);\r\n     addLog('è§£æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');\r\n     await new Promise(r => setTimeout(r, 500));\r\n \r\n-    // --- ã“ã“ã‹ã‚‰ä¿®æ­£ç‰ˆï¼šIDãƒ™ãƒ¼ã‚¹ã§æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®š ---\r\n+    // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®š\r\n+    const newHiddenComments = apiData.comments.filter(comment => !displayedCommentIds.has(comment.id));\r\n+    \r\n+    addLog('=== ãƒ‡ãƒãƒƒã‚°: æœªè¡¨ç¤ºã¨åˆ¤å®šã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆ ===', 'debug');\r\n+    newHiddenComments.slice(0, 10).forEach((comment, index) => {\r\n+      addLog(`æœªè¡¨ç¤º${index + 1}: ${comment.id} - ${comment.author}: ${comment.text.slice(0, 30)}...`, 'debug');\r\n+    });\r\n+\r\n     let resultMsg = 'è§£æçµæœï¼š\\n';\r\n-    // APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆå…¨ä»¶ã‹ã‚‰ã€Œç”»é¢ä¸Šã«ãªã„IDã€ã®ã¿ã‚’æœªè¡¨ç¤ºæ‰±ã„\r\n-    const newHiddenComments = apiData.comments.filter(comment => !displayedCommentIds.has(comment.id));\r\n     if (newHiddenComments.length === 0) {\r\n       resultMsg += 'å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚';\r\n       addLog('çµæœ: å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™', 'success');\r\n     } else {\r\n-      resultMsg += `æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚`;\r\n+      resultMsg += `æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚\\n\\nâš ï¸ ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰: é»„è‰²èƒŒæ™¯ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒæ—¢ã«ä¸‹ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é‡è¤‡ã§ã™ã€‚`;\r\n       addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’æ¤œå‡º`, 'progress');\r\n       newHiddenComments.forEach(comment => {\r\n         insertHiddenComment(comment);\r\n         displayedCommentIds.add(comment.id);\r\n@@ -332,9 +360,9 @@\n \r\n     setTimeout(() => {\r\n       addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™ (æ‰‹å‹•ã§é–‰ã˜ã‚‹ã“ã¨ã‚‚å¯èƒ½)', 'info');\r\n       setTimeout(closeLogPopup, 2000);\r\n-    }, 3000);\r\n+    }, 5000);\r\n   }\r\n \r\n   // MutationObserverã§DOMå¤‰åŒ–ç›£è¦–\r\n   function startObserver() {\r\n@@ -403,17 +431,17 @@\n       popup.id = 'ytcmtck-log-popup';\r\n       popup.style.position = 'fixed';\r\n       popup.style.top = '20px';\r\n       popup.style.right = '20px';\r\n-      popup.style.width = '400px';\r\n-      popup.style.maxHeight = '500px';\r\n+      popup.style.width = '450px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—å¹…ã‚’åºƒã’ã‚‹\r\n+      popup.style.maxHeight = '600px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚é«˜ãã™ã‚‹\r\n       popup.style.backgroundColor = '#fff';\r\n       popup.style.border = '2px solid #cc0000';\r\n       popup.style.borderRadius = '8px';\r\n       popup.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';\r\n       popup.style.zIndex = '10000';\r\n       popup.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n-      popup.style.fontSize = '14px';\r\n+      popup.style.fontSize = '13px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—å°ã•ã\r\n       popup.style.overflow = 'hidden';\r\n       const header = document.createElement('div');\r\n       header.style.backgroundColor = '#cc0000';\r\n       header.style.color = '#fff';\r\n@@ -421,9 +449,9 @@\n       header.style.fontWeight = 'bold';\r\n       header.style.display = 'flex';\r\n       header.style.justifyContent = 'space-between';\r\n       header.style.alignItems = 'center';\r\n-      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚°';\r\n+      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚° (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)';\r\n       const closeBtn = document.createElement('button');\r\n       closeBtn.innerHTML = 'Ã—';\r\n       closeBtn.style.backgroundColor = 'transparent';\r\n       closeBtn.style.border = 'none';\r\n@@ -437,11 +465,11 @@\n       header.appendChild(closeBtn);\r\n       const content = document.createElement('div');\r\n       content.id = 'ytcmtck-log-content';\r\n       content.style.padding = '16px';\r\n-      content.style.maxHeight = '400px';\r\n+      content.style.maxHeight = '500px';\r\n       content.style.overflowY = 'auto';\r\n-      content.style.lineHeight = '1.4';\r\n+      content.style.lineHeight = '1.3';\r\n       popup.appendChild(header);\r\n       popup.appendChild(content);\r\n       document.body.appendChild(popup);\r\n     }\r\n@@ -452,11 +480,12 @@\n   function addLog(message, type = 'info') {\r\n     const popup = showLogPopup();\r\n     const content = document.getElementById('ytcmtck-log-content');\r\n     const logEntry = document.createElement('div');\r\n-    logEntry.style.marginBottom = '8px';\r\n-    logEntry.style.padding = '8px';\r\n+    logEntry.style.marginBottom = '6px';\r\n+    logEntry.style.padding = '6px';\r\n     logEntry.style.borderRadius = '4px';\r\n+    logEntry.style.fontSize = '12px';\r\n     const timestamp = new Date().toLocaleTimeString('ja-JP');\r\n     let icon = '';\r\n     let bgColor = '';\r\n     switch(type) {\r\n@@ -464,12 +493,13 @@\n       case 'progress': icon = 'â³'; bgColor = '#fff3e0'; break;\r\n       case 'success': icon = 'âœ…'; bgColor = '#e8f5e8'; break;\r\n       case 'error': icon = 'âŒ'; bgColor = '#ffebee'; break;\r\n       case 'api': icon = 'ğŸ”—'; bgColor = '#f3e5f5'; break;\r\n+      case 'debug': icon = 'ğŸ›'; bgColor = '#fff9c4'; break;\r\n       default: icon = 'â„¹ï¸'; bgColor = '#f5f5f5';\r\n     }\r\n     logEntry.style.backgroundColor = bgColor;\r\n-    logEntry.innerHTML = `<span style=\"color: #666; font-size: 12px;\">${timestamp}</span> ${icon} ${message}`;\r\n+    logEntry.innerHTML = `<span style=\"color: #666; font-size: 11px;\">${timestamp}</span> ${icon} ${message}`;\r\n     content.appendChild(logEntry);\r\n     content.scrollTop = content.scrollHeight;\r\n   }\r\n \r\n"
                },
                {
                    "date": 1750259634606,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,32 +1,27 @@\n // ==UserScript==\r\n-// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)\r\n+// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (ä¿®æ­£ç‰ˆ)\r\n // @namespace    https://github.com/yourname/\r\n-// @version      1.2.0\r\n-// @description  YouTubeã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§APIä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã¨ç”»é¢ä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¯”è¼ƒã—ã€æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ã‚’æ¤œå‡ºã—ã¦æœ€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã™ã€‚ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ä»˜ãã€‚\r\n+// @version      1.3.0\r\n+// @description  YouTubeã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§ç¢ºå®Ÿã«å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ã‹ã‚‰æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œå‡º\r\n // @author       YourName\r\n // @match        https://www.youtube.com/watch*\r\n // @grant        none\r\n // ==/UserScript==\r\n \r\n (function() {\r\n   'use strict';\r\n \r\n-  // è¨­å®šï¼šYouTube Data APIã‚­ãƒ¼\r\n   const YOUTUBE_API_KEY = 'AIzaSyCB9iLVqz1AsLrYk83tILnILa7n6OzfEkg';\r\n-\r\n-  // æ—¢ã«è¡¨ç¤ºæ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’è¨˜éŒ²ã™ã‚‹ã‚»ãƒƒãƒˆ\r\n   let displayedCommentIds = new Set();\r\n \r\n-  // è§£æãƒœã‚¿ãƒ³æŒ¿å…¥ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’æ¢ã™\r\n   function findInsertTarget() {\r\n     const commentsHeader = document.querySelector('ytd-comments-header-renderer');\r\n     if (!commentsHeader) return null;\r\n     const additional = commentsHeader.querySelector('#additional-section');\r\n     return additional;\r\n   }\r\n \r\n-  // è§£æãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥\r\n   function insertAnalyzeButton() {\r\n     if (document.getElementById('ytcmtck-analyze-btn')) return;\r\n     const additional = findInsertTarget();\r\n     if (!additional) {\r\n@@ -34,9 +29,9 @@\n       return;\r\n     }\r\n     const btn = document.createElement('button');\r\n     btn.id = 'ytcmtck-analyze-btn';\r\n-    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)';\r\n+    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (å…¨èª­ã¿è¾¼ã¿ç‰ˆ)';\r\n     btn.style.marginLeft = '16px';\r\n     btn.style.marginTop = '2px';\r\n     btn.style.background = 'transparent';\r\n     btn.style.color = '#0f0f0f';\r\n@@ -53,9 +48,8 @@\n     btn.addEventListener('click', onAnalyzeClick);\r\n     console.log('ytcmtck: è§£æãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥ã—ã¾ã—ãŸ');\r\n   }\r\n \r\n-  // ã‚³ãƒ¡ãƒ³ãƒˆçµæœè¡¨ç¤º\r\n   function showResult(message, isFinal) {\r\n     let result = document.getElementById('ytcmtck-analyze-result');\r\n     if (!result) {\r\n       result = document.createElement('div');\r\n@@ -80,19 +74,17 @@\n         if (result && result.parentNode) {\r\n           result.remove();\r\n           addLog('è§£æçµæœè¡¨ç¤ºã‚’è‡ªå‹•ã§å‰Šé™¤ã—ã¾ã—ãŸ', 'info');\r\n         }\r\n-      }, 10000); // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚10ç§’ã«å»¶é•·\r\n+      }, 8000);\r\n     }\r\n   }\r\n \r\n-  // YouTubeå‹•ç”»IDã‚’URLã‹ã‚‰å–å¾—\r\n   function getVideoId() {\r\n     const url = new URL(location.href);\r\n     return url.searchParams.get('v');\r\n   }\r\n \r\n-  // YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¨ä»¶å–å¾—ï¼ˆæœ€å¤§1000ä»¶ã¾ã§ï¼‰\r\n   async function fetchComments(videoId) {\r\n     if (!videoId) return { count: 0, comments: [] };\r\n     const maxTotal = 1000;\r\n     let comments = [];\r\n@@ -127,9 +119,8 @@\n       return { count: 0, comments: [] };\r\n     }\r\n   }\r\n \r\n-  // YouTubeã®ã€Œâ—‹åˆ†å‰ã€å½¢å¼\r\n   function formatTimeAgo(publishedAt) {\r\n     const now = new Date();\r\n     const published = new Date(publishedAt);\r\n     const diffMs = now - published;\r\n@@ -155,109 +146,94 @@\n       return 'ä»Š';\r\n     }\r\n   }\r\n \r\n-  // ç”»é¢ä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’ã§ãã‚‹ã ã‘æ­£ç¢ºã«å–å¾—ã™ã‚‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç‰ˆï¼‰\r\n   function getDisplayedCommentIds() {\r\n     const ids = new Set();\r\n-    const debugInfo = [];\r\n-    \r\n-    // 1. é€šå¸¸ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆãƒ¡ã‚¤ãƒ³ã®æ–¹æ³•ï¼‰\r\n-    document.querySelectorAll('ytd-comment-thread-renderer').forEach((threadRenderer, index) => {\r\n-      // ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ã®ãƒªãƒ³ã‚¯ã‹ã‚‰IDã‚’å–å¾—\r\n-      const linkWithLc = threadRenderer.querySelector('a[href*=\"lc=\"]');\r\n-      if (linkWithLc) {\r\n-        const match = linkWithLc.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n-        if (match) {\r\n-          ids.add(match[1]);\r\n-          debugInfo.push(`æ–¹æ³•1-${index}: ${match[1]} (${threadRenderer.querySelector('#content-text')?.textContent?.slice(0, 30) || 'ãƒ†ã‚­ã‚¹ãƒˆä¸æ˜'}...)`);\r\n-        }\r\n-      }\r\n-      \r\n-      // dataå±æ€§ç³»ã‚‚ç¢ºèª\r\n-      const dataId = threadRenderer.getAttribute('data-id');\r\n-      if (dataId) {\r\n-        ids.add(dataId);\r\n-        debugInfo.push(`data-id-${index}: ${dataId}`);\r\n-      }\r\n+    // é€šå¸¸ã‚³ãƒ¡ãƒ³ãƒˆ\r\n+    document.querySelectorAll('ytd-comment-thread-renderer a[href*=\"lc=\"]').forEach(anchor => {\r\n+      const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n+      if (match) ids.add(match[1]);\r\n     });\r\n-\r\n-    // 2. è¿”ä¿¡ã‚³ãƒ¡ãƒ³ãƒˆ\r\n-    document.querySelectorAll('ytd-comment-renderer').forEach((commentRenderer, index) => {\r\n-      const linkWithLc = commentRenderer.querySelector('a[href*=\"lc=\"]');\r\n-      if (linkWithLc) {\r\n-        const match = linkWithLc.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n-        if (match) {\r\n-          ids.add(match[1]);\r\n-          debugInfo.push(`è¿”ä¿¡${index}: ${match[1]}`);\r\n-        }\r\n-      }\r\n+    // è¿”ä¿¡ã‚³ãƒ¡ãƒ³ãƒˆ\r\n+    document.querySelectorAll('ytd-comment-renderer a[href*=\"lc=\"]').forEach(anchor => {\r\n+      const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n+      if (match) ids.add(match[1]);\r\n     });\r\n-\r\n-    // 3. æ—¢ã«æŒ¿å…¥ã—ãŸæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ\r\n-    document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]').forEach((hiddenComment, index) => {\r\n-      const commentId = hiddenComment.getAttribute('data-comment-id');\r\n-      if (commentId) {\r\n-        ids.add(commentId);\r\n-        debugInfo.push(`æ—¢å­˜æœªè¡¨ç¤º${index}: ${commentId}`);\r\n-      }\r\n+    // æ—¢å­˜ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ\r\n+    document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]').forEach(node => {\r\n+      const id = node.getAttribute('data-comment-id');\r\n+      if (id) ids.add(id);\r\n     });\r\n-\r\n-    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ãƒ­ã‚°ã«å‡ºåŠ›\r\n-    addLog(`=== ãƒ‡ãƒãƒƒã‚°: ç”»é¢ä¸Šã§æ¤œå‡ºã—ãŸã‚³ãƒ¡ãƒ³ãƒˆIDä¸€è¦§ ===`, 'debug');\r\n-    debugInfo.forEach(info => addLog(info, 'debug'));\r\n-    addLog(`=== åˆè¨ˆ: ${ids.size}å€‹ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ID ===`, 'debug');\r\n-    \r\n     return ids;\r\n   }\r\n \r\n-  // ç”»é¢ã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã‚’ã§ãã‚‹ã ã‘å…¨ã¦ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\r\n-  async function loadAllVisibleComments(maxTry = 10) {\r\n-    addLog('ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¨ã¦èª­ã¿è¾¼ã¿ä¸­...', 'progress');\r\n+  // â˜… æœ€é‡è¦ï¼šç¢ºå®Ÿã«å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€é–¢æ•°\r\n+  async function loadAllVisibleComments() {\r\n+    addLog('ğŸ”„ YouTubeä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­... (æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™)', 'progress');\r\n     \r\n-    // ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’è‡ªå‹•ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹\r\n-    let tries = 0;\r\n-    while (tries < maxTry) {\r\n-      let moreBtn = Array.from(document.querySelectorAll('ytd-button-renderer'))\r\n-        .find(btn => /ã•ã‚‰ã«è¡¨ç¤º|Show more/i.test(btn.textContent));\r\n-      if (moreBtn && moreBtn.offsetParent !== null) { // è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒœã‚¿ãƒ³ã®ã¿\r\n-        addLog(`ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ (${tries + 1}/${maxTry})`, 'progress');\r\n-        moreBtn.click();\r\n-        await new Promise(r => setTimeout(r, 2000)); // å°‘ã—é•·ã‚ã«å¾…æ©Ÿ\r\n+    let previousCount = 0;\r\n+    let stableCount = 0;\r\n+    let maxAttempts = 50; // æœ€å¤§è©¦è¡Œå›æ•°\r\n+    let attempts = 0;\r\n+    \r\n+    while (attempts < maxAttempts) {\r\n+      // ç¾åœ¨ã®ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ\r\n+      const currentCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n+      addLog(`ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­: ${currentCount}ä»¶ (è©¦è¡Œ ${attempts + 1}/${maxAttempts})`, 'progress');\r\n+      \r\n+      // ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦ã‚¯ãƒªãƒƒã‚¯\r\n+      const moreButtons = Array.from(document.querySelectorAll('ytd-button-renderer'))\r\n+        .filter(btn => /ã•ã‚‰ã«è¡¨ç¤º|Show more|ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã™ã¹ã¦è¡¨ç¤º/i.test(btn.textContent))\r\n+        .filter(btn => btn.offsetParent !== null); // è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ã¿\r\n+      \r\n+      if (moreButtons.length > 0) {\r\n+        addLog(`ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯`, 'progress');\r\n+        moreButtons[0].click();\r\n+        await new Promise(r => setTimeout(r, 2000));\r\n       } else {\r\n-        addLog('ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€å…¨ã¦èª­ã¿è¾¼ã¿å®Œäº†', 'info');\r\n-        break;\r\n+        // ãƒœã‚¿ãƒ³ãŒãªã„å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§è¿½åŠ èª­ã¿è¾¼ã¿ã‚’è©¦è¡Œ\r\n+        window.scrollTo(0, document.body.scrollHeight);\r\n+        await new Promise(r => setTimeout(r, 1500));\r\n       }\r\n-      tries++;\r\n+      \r\n+      // å¤‰åŒ–ãŒãªã„å ´åˆã®ã‚«ã‚¦ãƒ³ãƒˆ\r\n+      if (currentCount === previousCount) {\r\n+        stableCount++;\r\n+        if (stableCount >= 5) {\r\n+          addLog(`ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ ${stableCount} å›é€£ç¶šã§å¤‰åŒ–ãªã—ã€‚èª­ã¿è¾¼ã¿å®Œäº†ã¨åˆ¤æ–­`, 'success');\r\n+          break;\r\n+        }\r\n+      } else {\r\n+        stableCount = 0; // ãƒªã‚»ãƒƒãƒˆ\r\n+      }\r\n+      \r\n+      previousCount = currentCount;\r\n+      attempts++;\r\n     }\r\n     \r\n-    // ç”»é¢ã‚’è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦é…å»¶ãƒ­ãƒ¼ãƒ‰ã‚‚ä¿ƒã™\r\n-    let lastCount = 0;\r\n-    for (let i = 0; i < maxTry; i++) {\r\n-      window.scrollTo(0, document.body.scrollHeight);\r\n-      await new Promise(r => setTimeout(r, 1000));\r\n-      const currCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n-      addLog(`ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« ${i + 1}/${maxTry}: ${currCount}ä»¶ã®ã‚³ãƒ¡ãƒ³ãƒˆè¦ç´ `, 'progress');\r\n-      if (currCount === lastCount && i > 2) break; // 3å›å¤‰åŒ–ãŒãªã‘ã‚Œã°çµ‚äº†\r\n-      lastCount = currCount;\r\n-    }\r\n+    const finalCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n+    addLog(`âœ… ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${finalCount}ä»¶`, 'success');\r\n     \r\n-    addLog(`ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${lastCount}ä»¶`, 'success');\r\n+    // æœ€å¾Œã«ã‚‚ã†ä¸€åº¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ç¢ºå®Ÿã«ã™ã‚‹\r\n+    window.scrollTo(0, document.body.scrollHeight);\r\n+    await new Promise(r => setTimeout(r, 1000));\r\n+    \r\n+    return finalCount;\r\n   }\r\n \r\n-  // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸Šéƒ¨ã«æŒ¿å…¥\r\n   function insertHiddenComment(comment) {\r\n     const commentElement = document.createElement('ytd-comment-view-model');\r\n     commentElement.className = 'style-scope ytd-comment-thread-renderer';\r\n     commentElement.setAttribute('data-ytcmtck-hidden', 'true');\r\n     commentElement.setAttribute('data-comment-id', comment.id);\r\n     commentElement.style.borderRadius = '8px';\r\n     commentElement.style.marginBottom = '16px';\r\n-    commentElement.style.backgroundColor = '#fff3cd'; // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã¯è–„é»„è‰²èƒŒæ™¯\r\n-    commentElement.style.border = '2px solid #856404'; // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šå¢ƒç•Œç·š\r\n+    commentElement.style.backgroundColor = '#fff9c4';\r\n+    commentElement.style.border = '2px solid #f0ad4e';\r\n     commentElement.innerHTML = `\r\n-      <div style=\"background: #856404; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n-        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (ID: ${comment.id})\r\n+      <div style=\"background: #f0ad4e; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n+        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (å…ƒã€…ã¯éè¡¨ç¤ºã§ã—ãŸ)\r\n       </div>\r\n       <div id=\"body\" class=\"style-scope ytd-comment-view-model\">\r\n         <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n           <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n@@ -282,26 +258,31 @@\n           <div style=\"margin-top: 2px;\">\r\n             <span style=\"color: #0f0f0f; font-size: 14px; line-height: 20px; white-space: pre-wrap;\">${comment.text}</span>\r\n           </div>\r\n           <div style=\"margin-top: 8px; display: flex; align-items: center; gap: 8px;\">\r\n-            <span style=\"font-size: 12px; color: #856404;\">ğŸ‘† ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒæ—¢ã«ä¸‹ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é‡è¤‡ã§ã™</span>\r\n+            <button style=\"background: none; border: none; padding: 0px; border-radius: 18px; cursor: pointer; display: flex; align-items: center; gap: 6px;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\" title=\"é«˜è©•ä¾¡\">\r\n+              <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n+                <path d=\"M18.77 11h-4.23l1.52-4.94C16.38 5.03 15.54 4 14.38 4c-.58 0-1.14.24-1.52.65L7 11H3v10h14.43c1.06 0 1.98-.67 2.19-1.61l1.34-6c.27-1.24-.78-2.39-2.19-2.39zM7 20H4v-8h3v8zm12.98-6.83-1.34 6c-.1.48-.61.83-1.21.83H8v-8.61l5.6-6.06c.19-.21.48-.33.78-.33.26 0 .5.11.63.3.07.1.15.26.09.47l-1.52 4.94-.4 1.29h5.58c.41 0 .8.17 1.03.46.13.15.26.4.19.71z\"/>\r\n+              </svg>\r\n+              ${comment.likeCount > 0 ? `<span style=\"font-size: 12px; color: #606060;\">${comment.likeCount}</span>` : ''}\r\n+            </button>\r\n           </div>\r\n         </div>\r\n       </div>\r\n     `;\r\n     const commentSection = document.querySelector('#comments #contents');\r\n     if (commentSection) commentSection.prepend(commentElement);\r\n   }\r\n \r\n-  // è§£æã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒ¡ã‚¤ãƒ³å‡¦ç†\r\n   async function onAnalyzeClick() {\r\n-    addLog('ğŸ” ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n-    showResult('è§£æä¸­...', false);\r\n+    addLog('ğŸš€ ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n+    showResult('è§£ææº–å‚™ä¸­...', false);\r\n \r\n-    addLog('ã¾ãšç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã§ãã‚‹ã ã‘å…¨ã¦èª­ã¿è¾¼ã¿ã¾ã™', 'progress');\r\n-    await loadAllVisibleComments(5); // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—æ¸›ã‚‰ã™\r\n+    // â˜… æœ€é‡è¦ï¼šã¾ãšç¢ºå®Ÿã«å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€\r\n+    showResult('YouTubeä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...\\n(æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™)', false);\r\n+    const loadedCount = await loadAllVisibleComments();\r\n \r\n-    addLog('ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’å–å¾—...', 'progress');\r\n+    showResult('ã‚³ãƒ¡ãƒ³ãƒˆIDæŠ½å‡ºä¸­...', false);\r\n     displayedCommentIds = getDisplayedCommentIds();\r\n     addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'success');\r\n \r\n     addLog('å‹•ç”»IDã‚’å–å¾—ä¸­...', 'progress');\r\n@@ -312,60 +293,48 @@\n       return;\r\n     }\r\n     addLog(`å‹•ç”»ID: ${videoId}`, 'success');\r\n \r\n-    await new Promise(r => setTimeout(r, 500));\r\n+    showResult('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ä¸­...', false);\r\n     addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ä¸­...', 'api');\r\n     const apiData = await fetchComments(videoId);\r\n     const apiCount = apiData.count;\r\n     if (apiData.count === 0 && apiData.comments.length === 0) {\r\n-      addLog('è­¦å‘Š: APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ (APIã‚­ãƒ¼ã¾ãŸã¯æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„)', 'error');\r\n+      addLog('è­¦å‘Š: APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', 'error');\r\n       showResult('APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n       return;\r\n     }\r\n     addLog(`APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ: ${apiCount}ä»¶`, 'success');\r\n \r\n-    // ãƒ‡ãƒãƒƒã‚°ï¼šAPIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆã®æœ€åˆã®5ä»¶ã‚’ãƒ­ã‚°å‡ºåŠ›\r\n-    addLog('=== ãƒ‡ãƒãƒƒã‚°: APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆã®æœ€åˆã®5ä»¶ ===', 'debug');\r\n-    apiData.comments.slice(0, 5).forEach((comment, index) => {\r\n-      addLog(`API${index + 1}: ${comment.id} - ${comment.author}: ${comment.text.slice(0, 30)}...`, 'debug');\r\n-    });\r\n+    showResult('è§£æä¸­...', false);\r\n+    addLog('è§£æå‡¦ç†ä¸­...', 'success');\r\n \r\n-    showResult('è§£æãŒå®Œäº†ã—ã¾ã—ãŸã€‚', false);\r\n-    addLog('è§£æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');\r\n-    await new Promise(r => setTimeout(r, 500));\r\n-\r\n-    // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®š\r\n+    // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®šï¼ˆIDãƒ™ãƒ¼ã‚¹ã§ç¢ºå®Ÿã«ï¼‰\r\n     const newHiddenComments = apiData.comments.filter(comment => !displayedCommentIds.has(comment.id));\r\n-    \r\n-    addLog('=== ãƒ‡ãƒãƒƒã‚°: æœªè¡¨ç¤ºã¨åˆ¤å®šã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆ ===', 'debug');\r\n-    newHiddenComments.slice(0, 10).forEach((comment, index) => {\r\n-      addLog(`æœªè¡¨ç¤º${index + 1}: ${comment.id} - ${comment.author}: ${comment.text.slice(0, 30)}...`, 'debug');\r\n-    });\r\n \r\n     let resultMsg = 'è§£æçµæœï¼š\\n';\r\n     if (newHiddenComments.length === 0) {\r\n-      resultMsg += 'å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚';\r\n+      resultMsg += `âœ… å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶`;\r\n       addLog('çµæœ: å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™', 'success');\r\n     } else {\r\n-      resultMsg += `æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚\\n\\nâš ï¸ ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰: é»„è‰²èƒŒæ™¯ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒæ—¢ã«ä¸‹ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é‡è¤‡ã§ã™ã€‚`;\r\n+      resultMsg += `âš ï¸ æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã¾ã—ãŸã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\næœªè¡¨ç¤º: ${newHiddenComments.length}ä»¶\\n\\næœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚`;\r\n       addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’æ¤œå‡º`, 'progress');\r\n       newHiddenComments.forEach(comment => {\r\n         insertHiddenComment(comment);\r\n         displayedCommentIds.add(comment.id);\r\n       });\r\n-      addLog(`${newHiddenComments.length}ä»¶ã®æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n+      addLog(`${newHiddenComments.length}ä»¶ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n     }\r\n     showResult(resultMsg, true);\r\n     addLog('ğŸ‰ ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n \r\n     setTimeout(() => {\r\n-      addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™ (æ‰‹å‹•ã§é–‰ã˜ã‚‹ã“ã¨ã‚‚å¯èƒ½)', 'info');\r\n+      addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™', 'info');\r\n       setTimeout(closeLogPopup, 2000);\r\n     }, 5000);\r\n   }\r\n \r\n-  // MutationObserverã§DOMå¤‰åŒ–ç›£è¦–\r\n+  // ä»¥ä¸‹ã€ç›£è¦–ãƒ»åˆæœŸåŒ–ãƒ»ãƒ­ã‚°é–¢é€£ã¯å‰å›ã¨åŒã˜\r\n   function startObserver() {\r\n     const observer = new MutationObserver((mutations) => {\r\n       let shouldCheck = false;\r\n       mutations.forEach((mutation) => {\r\n@@ -389,9 +358,8 @@\n     observer.observe(document.body, { childList: true, subtree: true });\r\n     return observer;\r\n   }\r\n \r\n-  // å‹•çš„ãƒšãƒ¼ã‚¸å¯¾å¿œï¼‹ãƒœã‚¿ãƒ³ç›£è¦–\r\n   let lastUrl = location.href;\r\n   let checkInterval;\r\n   let observer;\r\n   function startMonitoring() {\r\n@@ -409,9 +377,8 @@\n       }\r\n     }, 2000);\r\n   }\r\n \r\n-  // åˆæœŸåŒ–\r\n   function init() {\r\n     setTimeout(insertAnalyzeButton, 1000);\r\n     setTimeout(insertAnalyzeButton, 3000);\r\n     setTimeout(insertAnalyzeButton, 5000);\r\n@@ -422,26 +389,25 @@\n   } else {\r\n     init();\r\n   }\r\n \r\n-  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ä½œæˆãƒ»è¡¨ç¤º\r\n   function showLogPopup() {\r\n     let popup = document.getElementById('ytcmtck-log-popup');\r\n     if (!popup) {\r\n       popup = document.createElement('div');\r\n       popup.id = 'ytcmtck-log-popup';\r\n       popup.style.position = 'fixed';\r\n       popup.style.top = '20px';\r\n       popup.style.right = '20px';\r\n-      popup.style.width = '450px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—å¹…ã‚’åºƒã’ã‚‹\r\n-      popup.style.maxHeight = '600px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚é«˜ãã™ã‚‹\r\n+      popup.style.width = '400px';\r\n+      popup.style.maxHeight = '500px';\r\n       popup.style.backgroundColor = '#fff';\r\n       popup.style.border = '2px solid #cc0000';\r\n       popup.style.borderRadius = '8px';\r\n       popup.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';\r\n       popup.style.zIndex = '10000';\r\n       popup.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n-      popup.style.fontSize = '13px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—å°ã•ã\r\n+      popup.style.fontSize = '14px';\r\n       popup.style.overflow = 'hidden';\r\n       const header = document.createElement('div');\r\n       header.style.backgroundColor = '#cc0000';\r\n       header.style.color = '#fff';\r\n@@ -449,9 +415,9 @@\n       header.style.fontWeight = 'bold';\r\n       header.style.display = 'flex';\r\n       header.style.justifyContent = 'space-between';\r\n       header.style.alignItems = 'center';\r\n-      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚° (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)';\r\n+      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚°';\r\n       const closeBtn = document.createElement('button');\r\n       closeBtn.innerHTML = 'Ã—';\r\n       closeBtn.style.backgroundColor = 'transparent';\r\n       closeBtn.style.border = 'none';\r\n@@ -465,27 +431,25 @@\n       header.appendChild(closeBtn);\r\n       const content = document.createElement('div');\r\n       content.id = 'ytcmtck-log-content';\r\n       content.style.padding = '16px';\r\n-      content.style.maxHeight = '500px';\r\n+      content.style.maxHeight = '400px';\r\n       content.style.overflowY = 'auto';\r\n-      content.style.lineHeight = '1.3';\r\n+      content.style.lineHeight = '1.4';\r\n       popup.appendChild(header);\r\n       popup.appendChild(content);\r\n       document.body.appendChild(popup);\r\n     }\r\n     return popup;\r\n   }\r\n \r\n-  // ãƒ­ã‚°è¿½åŠ \r\n   function addLog(message, type = 'info') {\r\n     const popup = showLogPopup();\r\n     const content = document.getElementById('ytcmtck-log-content');\r\n     const logEntry = document.createElement('div');\r\n-    logEntry.style.marginBottom = '6px';\r\n-    logEntry.style.padding = '6px';\r\n+    logEntry.style.marginBottom = '8px';\r\n+    logEntry.style.padding = '8px';\r\n     logEntry.style.borderRadius = '4px';\r\n-    logEntry.style.fontSize = '12px';\r\n     const timestamp = new Date().toLocaleTimeString('ja-JP');\r\n     let icon = '';\r\n     let bgColor = '';\r\n     switch(type) {\r\n@@ -493,18 +457,16 @@\n       case 'progress': icon = 'â³'; bgColor = '#fff3e0'; break;\r\n       case 'success': icon = 'âœ…'; bgColor = '#e8f5e8'; break;\r\n       case 'error': icon = 'âŒ'; bgColor = '#ffebee'; break;\r\n       case 'api': icon = 'ğŸ”—'; bgColor = '#f3e5f5'; break;\r\n-      case 'debug': icon = 'ğŸ›'; bgColor = '#fff9c4'; break;\r\n       default: icon = 'â„¹ï¸'; bgColor = '#f5f5f5';\r\n     }\r\n     logEntry.style.backgroundColor = bgColor;\r\n-    logEntry.innerHTML = `<span style=\"color: #666; font-size: 11px;\">${timestamp}</span> ${icon} ${message}`;\r\n+    logEntry.innerHTML = `<span style=\"color: #666; font-size: 12px;\">${timestamp}</span> ${icon} ${message}`;\r\n     content.appendChild(logEntry);\r\n     content.scrollTop = content.scrollHeight;\r\n   }\r\n \r\n-  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹\r\n   function closeLogPopup() {\r\n     const popup = document.getElementById('ytcmtck-log-popup');\r\n     if (popup) popup.remove();\r\n   }\r\n"
                },
                {
                    "date": 1750260690371,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,10 @@\n // ==UserScript==\r\n-// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (ä¿®æ­£ç‰ˆ)\r\n+// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (å°è¦æ¨¡å‹•ç”»å°‚ç”¨)\r\n // @namespace    https://github.com/yourname/\r\n-// @version      1.3.0\r\n-// @description  YouTubeã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§ç¢ºå®Ÿã«å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ã‹ã‚‰æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œå‡º\r\n-// @author       YourName\r\n+// @version      2.1.0\r\n+// @description  ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®å‹•ç”»ã®ã¿ã§æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œå‡ºãƒ»è¡¨ç¤º\r\n+// @author       Himarry\r\n // @match        https://www.youtube.com/watch*\r\n // @grant        none\r\n // ==/UserScript==\r\n \r\n@@ -29,9 +29,9 @@\n       return;\r\n     }\r\n     const btn = document.createElement('button');\r\n     btn.id = 'ytcmtck-analyze-btn';\r\n-    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (å…¨èª­ã¿è¾¼ã¿ç‰ˆ)';\r\n+    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (100ä»¶ä»¥ä¸‹å°‚ç”¨)';\r\n     btn.style.marginLeft = '16px';\r\n     btn.style.marginTop = '2px';\r\n     btn.style.background = 'transparent';\r\n     btn.style.color = '#0f0f0f';\r\n@@ -72,9 +72,8 @@\n       result.style.fontWeight = '500';\r\n       setTimeout(() => {\r\n         if (result && result.parentNode) {\r\n           result.remove();\r\n-          addLog('è§£æçµæœè¡¨ç¤ºã‚’è‡ªå‹•ã§å‰Šé™¤ã—ã¾ã—ãŸ', 'info');\r\n         }\r\n       }, 8000);\r\n     }\r\n   }\r\n@@ -83,16 +82,17 @@\n     const url = new URL(location.href);\r\n     return url.searchParams.get('v');\r\n   }\r\n \r\n-  async function fetchComments(videoId) {\r\n+  // å°è¦æ¨¡å‹•ç”»å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n+  async function fetchAllComments(videoId) {\r\n     if (!videoId) return { count: 0, comments: [] };\r\n-    const maxTotal = 1000;\r\n+    const maxTotal = 150; // 100ä»¶åˆ¶é™ã«å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹\r\n     let comments = [];\r\n     let pageToken = '';\r\n     try {\r\n       while (comments.length < maxTotal) {\r\n-        let apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=100`;\r\n+        let apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=100&order=time`;\r\n         if (pageToken) apiUrl += `&pageToken=${pageToken}`;\r\n         const res = await fetch(apiUrl);\r\n         const data = await res.json();\r\n         if (data.error) {\r\n@@ -108,10 +108,18 @@\n           updatedAt: item.snippet.topLevelComment.snippet.updatedAt,\r\n           likeCount: item.snippet.topLevelComment.snippet.likeCount || 0,\r\n           id: item.snippet.topLevelComment.id\r\n         })) : [];\r\n+        \r\n         comments = comments.concat(newComments);\r\n-        if (!data.nextPageToken || comments.length >= maxTotal) break;\r\n+        \r\n+        // 100ä»¶ã‚’è¶…ãˆãŸå ´åˆã¯å‡¦ç†åœæ­¢\r\n+        if (comments.length > 100) {\r\n+          addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${comments.length}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n+          return { count: -1, comments: [] }; // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦-1ã‚’è¿”ã™\r\n+        }\r\n+        \r\n+        if (!data.nextPageToken) break;\r\n         pageToken = data.nextPageToken;\r\n       }\r\n       return { count: comments.length, comments: comments };\r\n     } catch (e) {\r\n@@ -166,59 +174,66 @@\n     });\r\n     return ids;\r\n   }\r\n \r\n-  // â˜… æœ€é‡è¦ï¼šç¢ºå®Ÿã«å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€é–¢æ•°\r\n-  async function loadAllVisibleComments() {\r\n-    addLog('ğŸ”„ YouTubeä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­... (æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™)', 'progress');\r\n+  // å°è¦æ¨¡å‹•ç”»å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºå®Ÿã«èª­ã¿è¾¼ã‚€\r\n+  async function loadAllCommentsForSmallVideo() {\r\n+    addLog('ğŸ“„ å°è¦æ¨¡å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­...', 'progress');\r\n     \r\n     let previousCount = 0;\r\n     let stableCount = 0;\r\n-    let maxAttempts = 50; // æœ€å¤§è©¦è¡Œå›æ•°\r\n+    let maxAttempts = 20; // å°è¦æ¨¡ãªã®ã§å›æ•°ã‚’æ¸›ã‚‰ã™\r\n     let attempts = 0;\r\n     \r\n     while (attempts < maxAttempts) {\r\n-      // ç¾åœ¨ã®ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ\r\n       const currentCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n       addLog(`ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­: ${currentCount}ä»¶ (è©¦è¡Œ ${attempts + 1}/${maxAttempts})`, 'progress');\r\n       \r\n+      // 100ä»¶ã‚’è¶…ãˆãã†ãªå ´åˆã¯åœæ­¢\r\n+      if (currentCount > 120) {\r\n+        addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒå¤šã™ãã¾ã™ (${currentCount}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n+        return -1; // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰\r\n+      }\r\n+      \r\n       // ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦ã‚¯ãƒªãƒƒã‚¯\r\n       const moreButtons = Array.from(document.querySelectorAll('ytd-button-renderer'))\r\n         .filter(btn => /ã•ã‚‰ã«è¡¨ç¤º|Show more|ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã™ã¹ã¦è¡¨ç¤º/i.test(btn.textContent))\r\n-        .filter(btn => btn.offsetParent !== null); // è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ã¿\r\n+        .filter(btn => btn.offsetParent !== null);\r\n       \r\n       if (moreButtons.length > 0) {\r\n         addLog(`ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯`, 'progress');\r\n         moreButtons[0].click();\r\n-        await new Promise(r => setTimeout(r, 2000));\r\n+        await new Promise(r => setTimeout(r, 1500));\r\n       } else {\r\n-        // ãƒœã‚¿ãƒ³ãŒãªã„å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§è¿½åŠ èª­ã¿è¾¼ã¿ã‚’è©¦è¡Œ\r\n+        // ãƒœã‚¿ãƒ³ãŒãªã„å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«\r\n         window.scrollTo(0, document.body.scrollHeight);\r\n-        await new Promise(r => setTimeout(r, 1500));\r\n+        await new Promise(r => setTimeout(r, 1000));\r\n       }\r\n       \r\n       // å¤‰åŒ–ãŒãªã„å ´åˆã®ã‚«ã‚¦ãƒ³ãƒˆ\r\n       if (currentCount === previousCount) {\r\n         stableCount++;\r\n-        if (stableCount >= 5) {\r\n-          addLog(`ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ ${stableCount} å›é€£ç¶šã§å¤‰åŒ–ãªã—ã€‚èª­ã¿è¾¼ã¿å®Œäº†ã¨åˆ¤æ–­`, 'success');\r\n+        if (stableCount >= 3) { // å°è¦æ¨¡å‹•ç”»ãªã®ã§3å›ã§ååˆ†\r\n+          addLog(`ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ ${stableCount} å›é€£ç¶šã§å¤‰åŒ–ãªã—ã€‚èª­ã¿è¾¼ã¿å®Œäº†`, 'success');\r\n           break;\r\n         }\r\n       } else {\r\n-        stableCount = 0; // ãƒªã‚»ãƒƒãƒˆ\r\n+        stableCount = 0;\r\n       }\r\n       \r\n       previousCount = currentCount;\r\n       attempts++;\r\n     }\r\n     \r\n     const finalCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n-    addLog(`âœ… ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${finalCount}ä»¶`, 'success');\r\n     \r\n-    // æœ€å¾Œã«ã‚‚ã†ä¸€åº¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ç¢ºå®Ÿã«ã™ã‚‹\r\n-    window.scrollTo(0, document.body.scrollHeight);\r\n-    await new Promise(r => setTimeout(r, 1000));\r\n+    // æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼š100ä»¶ã‚’è¶…ãˆã¦ã„ãªã„ã‹\r\n+    if (finalCount > 100) {\r\n+      addLog(`âŒ æœ€çµ‚ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${finalCount}ä»¶)`, 'error');\r\n+      return -1;\r\n+    }\r\n     \r\n+    addLog(`âœ… å…¨ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${finalCount}ä»¶`, 'success');\r\n     return finalCount;\r\n   }\r\n \r\n   function insertHiddenComment(comment) {\r\n@@ -227,13 +242,13 @@\n     commentElement.setAttribute('data-ytcmtck-hidden', 'true');\r\n     commentElement.setAttribute('data-comment-id', comment.id);\r\n     commentElement.style.borderRadius = '8px';\r\n     commentElement.style.marginBottom = '16px';\r\n-    commentElement.style.backgroundColor = '#fff9c4';\r\n-    commentElement.style.border = '2px solid #f0ad4e';\r\n+    commentElement.style.backgroundColor = '#e8f5e8';\r\n+    commentElement.style.border = '2px solid #4caf50';\r\n     commentElement.innerHTML = `\r\n-      <div style=\"background: #f0ad4e; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n-        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (å…ƒã€…ã¯éè¡¨ç¤ºã§ã—ãŸ)\r\n+      <div style=\"background: #4caf50; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n+        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (å°è¦æ¨¡å‹•ç”»ã§ç™ºè¦‹)\r\n       </div>\r\n       <div id=\"body\" class=\"style-scope ytd-comment-view-model\">\r\n         <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n           <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n@@ -273,19 +288,11 @@\n     if (commentSection) commentSection.prepend(commentElement);\r\n   }\r\n \r\n   async function onAnalyzeClick() {\r\n-    addLog('ğŸš€ ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n+    addLog('ğŸš€ å°è¦æ¨¡å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n     showResult('è§£ææº–å‚™ä¸­...', false);\r\n \r\n-    // â˜… æœ€é‡è¦ï¼šã¾ãšç¢ºå®Ÿã«å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€\r\n-    showResult('YouTubeä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...\\n(æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™)', false);\r\n-    const loadedCount = await loadAllVisibleComments();\r\n-\r\n-    showResult('ã‚³ãƒ¡ãƒ³ãƒˆIDæŠ½å‡ºä¸­...', false);\r\n-    displayedCommentIds = getDisplayedCommentIds();\r\n-    addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'success');\r\n-\r\n     addLog('å‹•ç”»IDã‚’å–å¾—ä¸­...', 'progress');\r\n     const videoId = getVideoId();\r\n     if (!videoId) {\r\n       addLog('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', 'error');\r\n@@ -293,48 +300,72 @@\n       return;\r\n     }\r\n     addLog(`å‹•ç”»ID: ${videoId}`, 'success');\r\n \r\n-    showResult('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ä¸­...', false);\r\n-    addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ä¸­...', 'api');\r\n-    const apiData = await fetchComments(videoId);\r\n-    const apiCount = apiData.count;\r\n-    if (apiData.count === 0 && apiData.comments.length === 0) {\r\n+    // ã¾ãšAPIã§ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’ãƒã‚§ãƒƒã‚¯\r\n+    showResult('ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...', false);\r\n+    addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...', 'api');\r\n+    const apiData = await fetchAllComments(videoId);\r\n+    \r\n+    if (apiData.count === -1) {\r\n+      // 100ä»¶è¶…éã‚¨ãƒ©ãƒ¼\r\n+      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚\\n\\nå°è¦æ¨¡å‹•ç”»ï¼ˆ100ä»¶ä»¥ä¸‹ï¼‰ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚', true);\r\n+      addLog('è§£æä¸­æ­¢: ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™', 'error');\r\n+      return;\r\n+    }\r\n+    \r\n+    if (apiData.count === 0) {\r\n       addLog('è­¦å‘Š: APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', 'error');\r\n       showResult('APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n       return;\r\n     }\r\n-    addLog(`APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ: ${apiCount}ä»¶`, 'success');\r\n+    \r\n+    const apiCount = apiData.count;\r\n+    addLog(`âœ… å°è¦æ¨¡å‹•ç”»ç¢ºèª: APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ ${apiCount}ä»¶`, 'success');\r\n \r\n-    showResult('è§£æä¸­...', false);\r\n-    addLog('è§£æå‡¦ç†ä¸­...', 'success');\r\n+    // å°è¦æ¨¡å‹•ç”»ãªã®ã§å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿\r\n+    showResult('å°è¦æ¨¡å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...', false);\r\n+    const loadedCount = await loadAllCommentsForSmallVideo();\r\n+    \r\n+    if (loadedCount === -1) {\r\n+      // ç”»é¢å´ã§ã‚‚100ä»¶è¶…é\r\n+      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚', true);\r\n+      return;\r\n+    }\r\n \r\n-    // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®šï¼ˆIDãƒ™ãƒ¼ã‚¹ã§ç¢ºå®Ÿã«ï¼‰\r\n+    showResult('ã‚³ãƒ¡ãƒ³ãƒˆIDæŠ½å‡ºä¸­...', false);\r\n+    displayedCommentIds = getDisplayedCommentIds();\r\n+    addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'success');\r\n+\r\n+    showResult('æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢ä¸­...', false);\r\n+    addLog('æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢ä¸­...', 'progress');\r\n+\r\n+    // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®š\r\n     const newHiddenComments = apiData.comments.filter(comment => !displayedCommentIds.has(comment.id));\r\n \r\n-    let resultMsg = 'è§£æçµæœï¼š\\n';\r\n+    let resultMsg = 'å°è¦æ¨¡å‹•ç”»å°‚ç”¨è§£æçµæœï¼š\\n';\r\n     if (newHiddenComments.length === 0) {\r\n-      resultMsg += `âœ… å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶`;\r\n+      resultMsg += `âœ… å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n       addLog('çµæœ: å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™', 'success');\r\n     } else {\r\n-      resultMsg += `âš ï¸ æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã¾ã—ãŸã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\næœªè¡¨ç¤º: ${newHiddenComments.length}ä»¶\\n\\næœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚`;\r\n+      resultMsg += `âš ï¸ æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã¾ã—ãŸã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\næœªè¡¨ç¤º: ${newHiddenComments.length}ä»¶\\n\\nã“ã‚Œã‚‰ã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n       addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’æ¤œå‡º`, 'progress');\r\n       newHiddenComments.forEach(comment => {\r\n         insertHiddenComment(comment);\r\n         displayedCommentIds.add(comment.id);\r\n       });\r\n       addLog(`${newHiddenComments.length}ä»¶ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n     }\r\n     showResult(resultMsg, true);\r\n-    addLog('ğŸ‰ ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n+    addLog('ğŸ‰ å°è¦æ¨¡å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n \r\n     setTimeout(() => {\r\n       addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™', 'info');\r\n       setTimeout(closeLogPopup, 2000);\r\n     }, 5000);\r\n   }\r\n \r\n-  // ä»¥ä¸‹ã€ç›£è¦–ãƒ»åˆæœŸåŒ–ãƒ»ãƒ­ã‚°é–¢é€£ã¯å‰å›ã¨åŒã˜\r\n+  // ä»¥ä¸‹ã€ç›£è¦–ãƒ»åˆæœŸåŒ–ãƒ»ãƒ­ã‚°é–¢é€£ã¯åŒã˜\r\n   function startObserver() {\r\n     const observer = new MutationObserver((mutations) => {\r\n       let shouldCheck = false;\r\n       mutations.forEach((mutation) => {\r\n@@ -400,24 +431,24 @@\n       popup.style.right = '20px';\r\n       popup.style.width = '400px';\r\n       popup.style.maxHeight = '500px';\r\n       popup.style.backgroundColor = '#fff';\r\n-      popup.style.border = '2px solid #cc0000';\r\n+      popup.style.border = '2px solid #4caf50';\r\n       popup.style.borderRadius = '8px';\r\n       popup.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';\r\n       popup.style.zIndex = '10000';\r\n       popup.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n       popup.style.fontSize = '14px';\r\n       popup.style.overflow = 'hidden';\r\n       const header = document.createElement('div');\r\n-      header.style.backgroundColor = '#cc0000';\r\n+      header.style.backgroundColor = '#4caf50';\r\n       header.style.color = '#fff';\r\n       header.style.padding = '12px';\r\n       header.style.fontWeight = 'bold';\r\n       header.style.display = 'flex';\r\n       header.style.justifyContent = 'space-between';\r\n       header.style.alignItems = 'center';\r\n-      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚°';\r\n+      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚° (100ä»¶ä»¥ä¸‹å°‚ç”¨)';\r\n       const closeBtn = document.createElement('button');\r\n       closeBtn.innerHTML = 'Ã—';\r\n       closeBtn.style.backgroundColor = 'transparent';\r\n       closeBtn.style.border = 'none';\r\n"
                },
                {
                    "date": 1750260705518,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -112,9 +112,9 @@\n         \r\n         comments = comments.concat(newComments);\r\n         \r\n         // 100ä»¶ã‚’è¶…ãˆãŸå ´åˆã¯å‡¦ç†åœæ­¢\r\n-        if (comments.length > 100) {\r\n+        if (comments.length > 50) {\r\n           addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${comments.length}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n           return { count: -1, comments: [] }; // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦-1ã‚’è¿”ã™\r\n         }\r\n         \r\n"
                },
                {
                    "date": 1750260713683,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,9 +85,9 @@\n \r\n   // å°è¦æ¨¡å‹•ç”»å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n   async function fetchAllComments(videoId) {\r\n     if (!videoId) return { count: 0, comments: [] };\r\n-    const maxTotal = 150; // 100ä»¶åˆ¶é™ã«å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹\r\n+    const maxTotal = 0; // 100ä»¶åˆ¶é™ã«å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹\r\n     let comments = [];\r\n     let pageToken = '';\r\n     try {\r\n       while (comments.length < maxTotal) {\r\n"
                },
                {
                    "date": 1750260720255,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,9 +85,9 @@\n \r\n   // å°è¦æ¨¡å‹•ç”»å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n   async function fetchAllComments(videoId) {\r\n     if (!videoId) return { count: 0, comments: [] };\r\n-    const maxTotal = 0; // 100ä»¶åˆ¶é™ã«å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹\r\n+    const maxTotal = 50; // 100ä»¶åˆ¶é™ã«å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹\r\n     let comments = [];\r\n     let pageToken = '';\r\n     try {\r\n       while (comments.length < maxTotal) {\r\n@@ -112,9 +112,9 @@\n         \r\n         comments = comments.concat(newComments);\r\n         \r\n         // 100ä»¶ã‚’è¶…ãˆãŸå ´åˆã¯å‡¦ç†åœæ­¢\r\n-        if (comments.length > 50) {\r\n+        if (comments.length > 40) {\r\n           addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${comments.length}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n           return { count: -1, comments: [] }; // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦-1ã‚’è¿”ã™\r\n         }\r\n         \r\n"
                },
                {
                    "date": 1750260994068,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,9 +85,9 @@\n \r\n   // å°è¦æ¨¡å‹•ç”»å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n   async function fetchAllComments(videoId) {\r\n     if (!videoId) return { count: 0, comments: [] };\r\n-    const maxTotal = 50; // 100ä»¶åˆ¶é™ã«å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹\r\n+    const maxTotal = 150; // 100ä»¶åˆ¶é™ã«å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹\r\n     let comments = [];\r\n     let pageToken = '';\r\n     try {\r\n       while (comments.length < maxTotal) {\r\n@@ -112,9 +112,9 @@\n         \r\n         comments = comments.concat(newComments);\r\n         \r\n         // 100ä»¶ã‚’è¶…ãˆãŸå ´åˆã¯å‡¦ç†åœæ­¢\r\n-        if (comments.length > 40) {\r\n+        if (comments.length > 100) {\r\n           addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${comments.length}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n           return { count: -1, comments: [] }; // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦-1ã‚’è¿”ã™\r\n         }\r\n         \r\n"
                },
                {
                    "date": 1750261075710,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n // ==UserScript==\r\n-// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (å°è¦æ¨¡å‹•ç”»å°‚ç”¨)\r\n-// @namespace    https://github.com/yourname/\r\n-// @version      2.1.0\r\n-// @description  ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®å‹•ç”»ã®ã¿ã§æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œå‡ºãƒ»è¡¨ç¤º\r\n+// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (40ä»¶å°‚ç”¨)\r\n+// @namespace    https://github.com/Himarry/\r\n+// @version      2.2.0\r\n+// @description  ã‚³ãƒ¡ãƒ³ãƒˆ40ä»¶ã®å‹•ç”»ã®ã¿ã§æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œå‡ºãƒ»è¡¨ç¤º\r\n // @author       Himarry\r\n // @match        https://www.youtube.com/watch*\r\n // @grant        none\r\n // ==/UserScript==\r\n@@ -29,9 +29,9 @@\n       return;\r\n     }\r\n     const btn = document.createElement('button');\r\n     btn.id = 'ytcmtck-analyze-btn';\r\n-    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (100ä»¶ä»¥ä¸‹å°‚ç”¨)';\r\n+    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (40ä»¶å°‚ç”¨)';\r\n     btn.style.marginLeft = '16px';\r\n     btn.style.marginTop = '2px';\r\n     btn.style.background = 'transparent';\r\n     btn.style.color = '#0f0f0f';\r\n@@ -82,17 +82,16 @@\n     const url = new URL(location.href);\r\n     return url.searchParams.get('v');\r\n   }\r\n \r\n-  // å°è¦æ¨¡å‹•ç”»å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n+  // 40ä»¶å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n   async function fetchAllComments(videoId) {\r\n     if (!videoId) return { count: 0, comments: [] };\r\n-    const maxTotal = 150; // 100ä»¶åˆ¶é™ã«å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹\r\n     let comments = [];\r\n     let pageToken = '';\r\n     try {\r\n-      while (comments.length < maxTotal) {\r\n-        let apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=100&order=time`;\r\n+      while (comments.length <= 40) {\r\n+        let apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=40&order=time`;\r\n         if (pageToken) apiUrl += `&pageToken=${pageToken}`;\r\n         const res = await fetch(apiUrl);\r\n         const data = await res.json();\r\n         if (data.error) {\r\n@@ -111,12 +110,12 @@\n         })) : [];\r\n         \r\n         comments = comments.concat(newComments);\r\n         \r\n-        // 100ä»¶ã‚’è¶…ãˆãŸå ´åˆã¯å‡¦ç†åœæ­¢\r\n-        if (comments.length > 100) {\r\n-          addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${comments.length}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n-          return { count: -1, comments: [] }; // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦-1ã‚’è¿”ã™\r\n+        // 40ä»¶ã‚’è¶…ãˆãŸå ´åˆã¯å‡¦ç†åœæ­¢\r\n+        if (comments.length > 40) {\r\n+          addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${comments.length}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n+          return { count: -1, comments: [] };\r\n         }\r\n         \r\n         if (!data.nextPageToken) break;\r\n         pageToken = data.nextPageToken;\r\n@@ -174,25 +173,25 @@\n     });\r\n     return ids;\r\n   }\r\n \r\n-  // å°è¦æ¨¡å‹•ç”»å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºå®Ÿã«èª­ã¿è¾¼ã‚€\r\n-  async function loadAllCommentsForSmallVideo() {\r\n-    addLog('ğŸ“„ å°è¦æ¨¡å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­...', 'progress');\r\n+  // 40ä»¶å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºå®Ÿã«èª­ã¿è¾¼ã‚€\r\n+  async function loadAllCommentsFor40Video() {\r\n+    addLog('ğŸ“„ 40ä»¶å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­...', 'progress');\r\n     \r\n     let previousCount = 0;\r\n     let stableCount = 0;\r\n-    let maxAttempts = 20; // å°è¦æ¨¡ãªã®ã§å›æ•°ã‚’æ¸›ã‚‰ã™\r\n+    let maxAttempts = 15;\r\n     let attempts = 0;\r\n     \r\n     while (attempts < maxAttempts) {\r\n       const currentCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n       addLog(`ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­: ${currentCount}ä»¶ (è©¦è¡Œ ${attempts + 1}/${maxAttempts})`, 'progress');\r\n       \r\n-      // 100ä»¶ã‚’è¶…ãˆãã†ãªå ´åˆã¯åœæ­¢\r\n-      if (currentCount > 120) {\r\n-        addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒå¤šã™ãã¾ã™ (${currentCount}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n-        return -1; // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰\r\n+      // 40ä»¶ã‚’è¶…ãˆãŸå ´åˆã¯åœæ­¢\r\n+      if (currentCount > 40) {\r\n+        addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${currentCount}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n+        return -1;\r\n       }\r\n       \r\n       // ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦ã‚¯ãƒªãƒƒã‚¯\r\n       const moreButtons = Array.from(document.querySelectorAll('ytd-button-renderer'))\r\n@@ -211,9 +210,9 @@\n       \r\n       // å¤‰åŒ–ãŒãªã„å ´åˆã®ã‚«ã‚¦ãƒ³ãƒˆ\r\n       if (currentCount === previousCount) {\r\n         stableCount++;\r\n-        if (stableCount >= 3) { // å°è¦æ¨¡å‹•ç”»ãªã®ã§3å›ã§ååˆ†\r\n+        if (stableCount >= 3) {\r\n           addLog(`ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ ${stableCount} å›é€£ç¶šã§å¤‰åŒ–ãªã—ã€‚èª­ã¿è¾¼ã¿å®Œäº†`, 'success');\r\n           break;\r\n         }\r\n       } else {\r\n@@ -225,11 +224,11 @@\n     }\r\n     \r\n     const finalCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n     \r\n-    // æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼š100ä»¶ã‚’è¶…ãˆã¦ã„ãªã„ã‹\r\n-    if (finalCount > 100) {\r\n-      addLog(`âŒ æœ€çµ‚ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${finalCount}ä»¶)`, 'error');\r\n+    // æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼š40ä»¶ã‚’è¶…ãˆã¦ã„ãªã„ã‹\r\n+    if (finalCount > 40) {\r\n+      addLog(`âŒ æœ€çµ‚ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${finalCount}ä»¶)`, 'error');\r\n       return -1;\r\n     }\r\n     \r\n     addLog(`âœ… å…¨ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${finalCount}ä»¶`, 'success');\r\n@@ -242,13 +241,13 @@\n     commentElement.setAttribute('data-ytcmtck-hidden', 'true');\r\n     commentElement.setAttribute('data-comment-id', comment.id);\r\n     commentElement.style.borderRadius = '8px';\r\n     commentElement.style.marginBottom = '16px';\r\n-    commentElement.style.backgroundColor = '#e8f5e8';\r\n-    commentElement.style.border = '2px solid #4caf50';\r\n+    commentElement.style.backgroundColor = '#fff3e0';\r\n+    commentElement.style.border = '2px solid #ff9800';\r\n     commentElement.innerHTML = `\r\n-      <div style=\"background: #4caf50; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n-        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (å°è¦æ¨¡å‹•ç”»ã§ç™ºè¦‹)\r\n+      <div style=\"background: #ff9800; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n+        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (40ä»¶å‹•ç”»ã§ç™ºè¦‹)\r\n       </div>\r\n       <div id=\"body\" class=\"style-scope ytd-comment-view-model\">\r\n         <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n           <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n@@ -288,9 +287,9 @@\n     if (commentSection) commentSection.prepend(commentElement);\r\n   }\r\n \r\n   async function onAnalyzeClick() {\r\n-    addLog('ğŸš€ å°è¦æ¨¡å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n+    addLog('ğŸš€ 40ä»¶å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n     showResult('è§£ææº–å‚™ä¸­...', false);\r\n \r\n     addLog('å‹•ç”»IDã‚’å–å¾—ä¸­...', 'progress');\r\n     const videoId = getVideoId();\r\n@@ -306,11 +305,11 @@\n     addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...', 'api');\r\n     const apiData = await fetchAllComments(videoId);\r\n     \r\n     if (apiData.count === -1) {\r\n-      // 100ä»¶è¶…éã‚¨ãƒ©ãƒ¼\r\n-      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚\\n\\nå°è¦æ¨¡å‹•ç”»ï¼ˆ100ä»¶ä»¥ä¸‹ï¼‰ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚', true);\r\n-      addLog('è§£æä¸­æ­¢: ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™', 'error');\r\n+      // 40ä»¶è¶…éã‚¨ãƒ©ãƒ¼\r\n+      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚\\n\\n40ä»¶ä»¥ä¸‹ã®å‹•ç”»ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚', true);\r\n+      addLog('è§£æä¸­æ­¢: ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™', 'error');\r\n       return;\r\n     }\r\n     \r\n     if (apiData.count === 0) {\r\n@@ -319,17 +318,17 @@\n       return;\r\n     }\r\n     \r\n     const apiCount = apiData.count;\r\n-    addLog(`âœ… å°è¦æ¨¡å‹•ç”»ç¢ºèª: APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ ${apiCount}ä»¶`, 'success');\r\n+    addLog(`âœ… 40ä»¶å‹•ç”»ç¢ºèª: APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ ${apiCount}ä»¶`, 'success');\r\n \r\n-    // å°è¦æ¨¡å‹•ç”»ãªã®ã§å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿\r\n-    showResult('å°è¦æ¨¡å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...', false);\r\n-    const loadedCount = await loadAllCommentsForSmallVideo();\r\n+    // 40ä»¶å‹•ç”»ãªã®ã§å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿\r\n+    showResult('40ä»¶å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...', false);\r\n+    const loadedCount = await loadAllCommentsFor40Video();\r\n     \r\n     if (loadedCount === -1) {\r\n-      // ç”»é¢å´ã§ã‚‚100ä»¶è¶…é\r\n-      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚', true);\r\n+      // ç”»é¢å´ã§ã‚‚40ä»¶è¶…é\r\n+      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚', true);\r\n       return;\r\n     }\r\n \r\n     showResult('ã‚³ãƒ¡ãƒ³ãƒˆIDæŠ½å‡ºä¸­...', false);\r\n@@ -341,23 +340,23 @@\n \r\n     // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®š\r\n     const newHiddenComments = apiData.comments.filter(comment => !displayedCommentIds.has(comment.id));\r\n \r\n-    let resultMsg = 'å°è¦æ¨¡å‹•ç”»å°‚ç”¨è§£æçµæœï¼š\\n';\r\n+    let resultMsg = '40ä»¶å‹•ç”»å°‚ç”¨è§£æçµæœï¼š\\n';\r\n     if (newHiddenComments.length === 0) {\r\n-      resultMsg += `âœ… å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n+      resultMsg += `âœ… å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ40ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n       addLog('çµæœ: å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™', 'success');\r\n     } else {\r\n-      resultMsg += `âš ï¸ æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã¾ã—ãŸã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\næœªè¡¨ç¤º: ${newHiddenComments.length}ä»¶\\n\\nã“ã‚Œã‚‰ã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n+      resultMsg += `âš ï¸ æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã¾ã—ãŸã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\næœªè¡¨ç¤º: ${newHiddenComments.length}ä»¶\\n\\nã“ã‚Œã‚‰ã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ40ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n       addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’æ¤œå‡º`, 'progress');\r\n       newHiddenComments.forEach(comment => {\r\n         insertHiddenComment(comment);\r\n         displayedCommentIds.add(comment.id);\r\n       });\r\n       addLog(`${newHiddenComments.length}ä»¶ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n     }\r\n     showResult(resultMsg, true);\r\n-    addLog('ğŸ‰ å°è¦æ¨¡å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n+    addLog('ğŸ‰ 40ä»¶å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n \r\n     setTimeout(() => {\r\n       addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™', 'info');\r\n       setTimeout(closeLogPopup, 2000);\r\n@@ -431,24 +430,24 @@\n       popup.style.right = '20px';\r\n       popup.style.width = '400px';\r\n       popup.style.maxHeight = '500px';\r\n       popup.style.backgroundColor = '#fff';\r\n-      popup.style.border = '2px solid #4caf50';\r\n+      popup.style.border = '2px solid #ff9800';\r\n       popup.style.borderRadius = '8px';\r\n       popup.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';\r\n       popup.style.zIndex = '10000';\r\n       popup.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n       popup.style.fontSize = '14px';\r\n       popup.style.overflow = 'hidden';\r\n       const header = document.createElement('div');\r\n-      header.style.backgroundColor = '#4caf50';\r\n+      header.style.backgroundColor = '#ff9800';\r\n       header.style.color = '#fff';\r\n       header.style.padding = '12px';\r\n       header.style.fontWeight = 'bold';\r\n       header.style.display = 'flex';\r\n       header.style.justifyContent = 'space-between';\r\n       header.style.alignItems = 'center';\r\n-      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚° (100ä»¶ä»¥ä¸‹å°‚ç”¨)';\r\n+      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚° (40ä»¶å°‚ç”¨)';\r\n       const closeBtn = document.createElement('button');\r\n       closeBtn.innerHTML = 'Ã—';\r\n       closeBtn.style.backgroundColor = 'transparent';\r\n       closeBtn.style.border = 'none';\r\n"
                },
                {
                    "date": 1750261139056,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n // ==UserScript==\r\n-// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (40ä»¶å°‚ç”¨)\r\n-// @namespace    https://github.com/Himarry/\r\n-// @version      2.2.0\r\n-// @description  ã‚³ãƒ¡ãƒ³ãƒˆ40ä»¶ã®å‹•ç”»ã®ã¿ã§æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œå‡ºãƒ»è¡¨ç¤º\r\n+// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (å°è¦æ¨¡å‹•ç”»å°‚ç”¨)\r\n+// @namespace    https://github.com/yourname/\r\n+// @version      2.1.0\r\n+// @description  ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®å‹•ç”»ã®ã¿ã§æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œå‡ºãƒ»è¡¨ç¤º\r\n // @author       Himarry\r\n // @match        https://www.youtube.com/watch*\r\n // @grant        none\r\n // ==/UserScript==\r\n@@ -29,9 +29,9 @@\n       return;\r\n     }\r\n     const btn = document.createElement('button');\r\n     btn.id = 'ytcmtck-analyze-btn';\r\n-    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (40ä»¶å°‚ç”¨)';\r\n+    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (100ä»¶ä»¥ä¸‹å°‚ç”¨)';\r\n     btn.style.marginLeft = '16px';\r\n     btn.style.marginTop = '2px';\r\n     btn.style.background = 'transparent';\r\n     btn.style.color = '#0f0f0f';\r\n@@ -82,16 +82,17 @@\n     const url = new URL(location.href);\r\n     return url.searchParams.get('v');\r\n   }\r\n \r\n-  // 40ä»¶å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n+  // å°è¦æ¨¡å‹•ç”»å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n   async function fetchAllComments(videoId) {\r\n     if (!videoId) return { count: 0, comments: [] };\r\n+    const maxTotal = 50; // 100ä»¶åˆ¶é™ã«å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹\r\n     let comments = [];\r\n     let pageToken = '';\r\n     try {\r\n-      while (comments.length <= 40) {\r\n-        let apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=40&order=time`;\r\n+      while (comments.length < maxTotal) {\r\n+        let apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=100&order=time`;\r\n         if (pageToken) apiUrl += `&pageToken=${pageToken}`;\r\n         const res = await fetch(apiUrl);\r\n         const data = await res.json();\r\n         if (data.error) {\r\n@@ -110,12 +111,12 @@\n         })) : [];\r\n         \r\n         comments = comments.concat(newComments);\r\n         \r\n-        // 40ä»¶ã‚’è¶…ãˆãŸå ´åˆã¯å‡¦ç†åœæ­¢\r\n+        // 100ä»¶ã‚’è¶…ãˆãŸå ´åˆã¯å‡¦ç†åœæ­¢\r\n         if (comments.length > 40) {\r\n-          addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${comments.length}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n-          return { count: -1, comments: [] };\r\n+          addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ0ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${comments.length}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n+          return { count: -1, comments: [] }; // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦-1ã‚’è¿”ã™\r\n         }\r\n         \r\n         if (!data.nextPageToken) break;\r\n         pageToken = data.nextPageToken;\r\n@@ -173,25 +174,25 @@\n     });\r\n     return ids;\r\n   }\r\n \r\n-  // 40ä»¶å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºå®Ÿã«èª­ã¿è¾¼ã‚€\r\n-  async function loadAllCommentsFor40Video() {\r\n-    addLog('ğŸ“„ 40ä»¶å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­...', 'progress');\r\n+  // å°è¦æ¨¡å‹•ç”»å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºå®Ÿã«èª­ã¿è¾¼ã‚€\r\n+  async function loadAllCommentsForSmallVideo() {\r\n+    addLog('ğŸ“„ å°è¦æ¨¡å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­...', 'progress');\r\n     \r\n     let previousCount = 0;\r\n     let stableCount = 0;\r\n-    let maxAttempts = 15;\r\n+    let maxAttempts = 20; // å°è¦æ¨¡ãªã®ã§å›æ•°ã‚’æ¸›ã‚‰ã™\r\n     let attempts = 0;\r\n     \r\n     while (attempts < maxAttempts) {\r\n       const currentCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n       addLog(`ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­: ${currentCount}ä»¶ (è©¦è¡Œ ${attempts + 1}/${maxAttempts})`, 'progress');\r\n       \r\n-      // 40ä»¶ã‚’è¶…ãˆãŸå ´åˆã¯åœæ­¢\r\n-      if (currentCount > 40) {\r\n-        addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${currentCount}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n-        return -1;\r\n+      // 100ä»¶ã‚’è¶…ãˆãã†ãªå ´åˆã¯åœæ­¢\r\n+      if (currentCount > 120) {\r\n+        addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒå¤šã™ãã¾ã™ (${currentCount}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n+        return -1; // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰\r\n       }\r\n       \r\n       // ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦ã‚¯ãƒªãƒƒã‚¯\r\n       const moreButtons = Array.from(document.querySelectorAll('ytd-button-renderer'))\r\n@@ -210,9 +211,9 @@\n       \r\n       // å¤‰åŒ–ãŒãªã„å ´åˆã®ã‚«ã‚¦ãƒ³ãƒˆ\r\n       if (currentCount === previousCount) {\r\n         stableCount++;\r\n-        if (stableCount >= 3) {\r\n+        if (stableCount >= 3) { // å°è¦æ¨¡å‹•ç”»ãªã®ã§3å›ã§ååˆ†\r\n           addLog(`ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ ${stableCount} å›é€£ç¶šã§å¤‰åŒ–ãªã—ã€‚èª­ã¿è¾¼ã¿å®Œäº†`, 'success');\r\n           break;\r\n         }\r\n       } else {\r\n@@ -224,11 +225,11 @@\n     }\r\n     \r\n     const finalCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n     \r\n-    // æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼š40ä»¶ã‚’è¶…ãˆã¦ã„ãªã„ã‹\r\n-    if (finalCount > 40) {\r\n-      addLog(`âŒ æœ€çµ‚ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${finalCount}ä»¶)`, 'error');\r\n+    // æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼š100ä»¶ã‚’è¶…ãˆã¦ã„ãªã„ã‹\r\n+    if (finalCount > 100) {\r\n+      addLog(`âŒ æœ€çµ‚ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${finalCount}ä»¶)`, 'error');\r\n       return -1;\r\n     }\r\n     \r\n     addLog(`âœ… å…¨ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${finalCount}ä»¶`, 'success');\r\n@@ -241,13 +242,13 @@\n     commentElement.setAttribute('data-ytcmtck-hidden', 'true');\r\n     commentElement.setAttribute('data-comment-id', comment.id);\r\n     commentElement.style.borderRadius = '8px';\r\n     commentElement.style.marginBottom = '16px';\r\n-    commentElement.style.backgroundColor = '#fff3e0';\r\n-    commentElement.style.border = '2px solid #ff9800';\r\n+    commentElement.style.backgroundColor = '#e8f5e8';\r\n+    commentElement.style.border = '2px solid #4caf50';\r\n     commentElement.innerHTML = `\r\n-      <div style=\"background: #ff9800; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n-        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (40ä»¶å‹•ç”»ã§ç™ºè¦‹)\r\n+      <div style=\"background: #4caf50; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n+        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (å°è¦æ¨¡å‹•ç”»ã§ç™ºè¦‹)\r\n       </div>\r\n       <div id=\"body\" class=\"style-scope ytd-comment-view-model\">\r\n         <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n           <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n@@ -287,9 +288,9 @@\n     if (commentSection) commentSection.prepend(commentElement);\r\n   }\r\n \r\n   async function onAnalyzeClick() {\r\n-    addLog('ğŸš€ 40ä»¶å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n+    addLog('ğŸš€ å°è¦æ¨¡å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n     showResult('è§£ææº–å‚™ä¸­...', false);\r\n \r\n     addLog('å‹•ç”»IDã‚’å–å¾—ä¸­...', 'progress');\r\n     const videoId = getVideoId();\r\n@@ -305,11 +306,11 @@\n     addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...', 'api');\r\n     const apiData = await fetchAllComments(videoId);\r\n     \r\n     if (apiData.count === -1) {\r\n-      // 40ä»¶è¶…éã‚¨ãƒ©ãƒ¼\r\n-      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚\\n\\n40ä»¶ä»¥ä¸‹ã®å‹•ç”»ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚', true);\r\n-      addLog('è§£æä¸­æ­¢: ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™', 'error');\r\n+      // 100ä»¶è¶…éã‚¨ãƒ©ãƒ¼\r\n+      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚\\n\\nå°è¦æ¨¡å‹•ç”»ï¼ˆ100ä»¶ä»¥ä¸‹ï¼‰ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚', true);\r\n+      addLog('è§£æä¸­æ­¢: ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™', 'error');\r\n       return;\r\n     }\r\n     \r\n     if (apiData.count === 0) {\r\n@@ -318,17 +319,17 @@\n       return;\r\n     }\r\n     \r\n     const apiCount = apiData.count;\r\n-    addLog(`âœ… 40ä»¶å‹•ç”»ç¢ºèª: APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ ${apiCount}ä»¶`, 'success');\r\n+    addLog(`âœ… å°è¦æ¨¡å‹•ç”»ç¢ºèª: APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ ${apiCount}ä»¶`, 'success');\r\n \r\n-    // 40ä»¶å‹•ç”»ãªã®ã§å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿\r\n-    showResult('40ä»¶å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...', false);\r\n-    const loadedCount = await loadAllCommentsFor40Video();\r\n+    // å°è¦æ¨¡å‹•ç”»ãªã®ã§å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿\r\n+    showResult('å°è¦æ¨¡å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...', false);\r\n+    const loadedCount = await loadAllCommentsForSmallVideo();\r\n     \r\n     if (loadedCount === -1) {\r\n-      // ç”»é¢å´ã§ã‚‚40ä»¶è¶…é\r\n-      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ40ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚', true);\r\n+      // ç”»é¢å´ã§ã‚‚100ä»¶è¶…é\r\n+      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚', true);\r\n       return;\r\n     }\r\n \r\n     showResult('ã‚³ãƒ¡ãƒ³ãƒˆIDæŠ½å‡ºä¸­...', false);\r\n@@ -340,23 +341,23 @@\n \r\n     // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®š\r\n     const newHiddenComments = apiData.comments.filter(comment => !displayedCommentIds.has(comment.id));\r\n \r\n-    let resultMsg = '40ä»¶å‹•ç”»å°‚ç”¨è§£æçµæœï¼š\\n';\r\n+    let resultMsg = 'å°è¦æ¨¡å‹•ç”»å°‚ç”¨è§£æçµæœï¼š\\n';\r\n     if (newHiddenComments.length === 0) {\r\n-      resultMsg += `âœ… å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ40ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n+      resultMsg += `âœ… å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n       addLog('çµæœ: å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™', 'success');\r\n     } else {\r\n-      resultMsg += `âš ï¸ æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã¾ã—ãŸã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\næœªè¡¨ç¤º: ${newHiddenComments.length}ä»¶\\n\\nã“ã‚Œã‚‰ã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ40ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n+      resultMsg += `âš ï¸ æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã¾ã—ãŸã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\næœªè¡¨ç¤º: ${newHiddenComments.length}ä»¶\\n\\nã“ã‚Œã‚‰ã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n       addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’æ¤œå‡º`, 'progress');\r\n       newHiddenComments.forEach(comment => {\r\n         insertHiddenComment(comment);\r\n         displayedCommentIds.add(comment.id);\r\n       });\r\n       addLog(`${newHiddenComments.length}ä»¶ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n     }\r\n     showResult(resultMsg, true);\r\n-    addLog('ğŸ‰ 40ä»¶å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n+    addLog('ğŸ‰ å°è¦æ¨¡å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n \r\n     setTimeout(() => {\r\n       addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™', 'info');\r\n       setTimeout(closeLogPopup, 2000);\r\n@@ -430,24 +431,24 @@\n       popup.style.right = '20px';\r\n       popup.style.width = '400px';\r\n       popup.style.maxHeight = '500px';\r\n       popup.style.backgroundColor = '#fff';\r\n-      popup.style.border = '2px solid #ff9800';\r\n+      popup.style.border = '2px solid #4caf50';\r\n       popup.style.borderRadius = '8px';\r\n       popup.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';\r\n       popup.style.zIndex = '10000';\r\n       popup.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n       popup.style.fontSize = '14px';\r\n       popup.style.overflow = 'hidden';\r\n       const header = document.createElement('div');\r\n-      header.style.backgroundColor = '#ff9800';\r\n+      header.style.backgroundColor = '#4caf50';\r\n       header.style.color = '#fff';\r\n       header.style.padding = '12px';\r\n       header.style.fontWeight = 'bold';\r\n       header.style.display = 'flex';\r\n       header.style.justifyContent = 'space-between';\r\n       header.style.alignItems = 'center';\r\n-      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚° (40ä»¶å°‚ç”¨)';\r\n+      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚° (100ä»¶ä»¥ä¸‹å°‚ç”¨)';\r\n       const closeBtn = document.createElement('button');\r\n       closeBtn.innerHTML = 'Ã—';\r\n       closeBtn.style.backgroundColor = 'transparent';\r\n       closeBtn.style.border = 'none';\r\n"
                },
                {
                    "date": 1750261144448,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,511 @@\n+// ==UserScript==\r\n+// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)\r\n+// @namespace    https://github.com/yourname/\r\n+// @version      1.2.0\r\n+// @description  YouTubeã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§APIä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã¨ç”»é¢ä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¯”è¼ƒã—ã€æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ã‚’æ¤œå‡ºã—ã¦æœ€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã™ã€‚ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ä»˜ãã€‚\r\n+// @author       YourName\r\n+// @match        https://www.youtube.com/watch*\r\n+// @grant        none\r\n+// ==/UserScript==\r\n+\r\n+(function() {\r\n+  'use strict';\r\n+\r\n+  // è¨­å®šï¼šYouTube Data APIã‚­ãƒ¼\r\n+  const YOUTUBE_API_KEY = 'AIzaSyCB9iLVqz1AsLrYk83tILnILa7n6OzfEkg';\r\n+\r\n+  // æ—¢ã«è¡¨ç¤ºæ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’è¨˜éŒ²ã™ã‚‹ã‚»ãƒƒãƒˆ\r\n+  let displayedCommentIds = new Set();\r\n+\r\n+  // è§£æãƒœã‚¿ãƒ³æŒ¿å…¥ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’æ¢ã™\r\n+  function findInsertTarget() {\r\n+    const commentsHeader = document.querySelector('ytd-comments-header-renderer');\r\n+    if (!commentsHeader) return null;\r\n+    const additional = commentsHeader.querySelector('#additional-section');\r\n+    return additional;\r\n+  }\r\n+\r\n+  // è§£æãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥\r\n+  function insertAnalyzeButton() {\r\n+    if (document.getElementById('ytcmtck-analyze-btn')) return;\r\n+    const additional = findInsertTarget();\r\n+    if (!additional) {\r\n+      console.log('ytcmtck: #additional-section not found, retrying...');\r\n+      return;\r\n+    }\r\n+    const btn = document.createElement('button');\r\n+    btn.id = 'ytcmtck-analyze-btn';\r\n+    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)';\r\n+    btn.style.marginLeft = '16px';\r\n+    btn.style.marginTop = '2px';\r\n+    btn.style.background = 'transparent';\r\n+    btn.style.color = '#0f0f0f';\r\n+    btn.style.border = '0px';\r\n+    btn.style.cursor = 'pointer';\r\n+    btn.style.fontSize = '1.4rem';\r\n+    btn.style.fontWeight = '500';\r\n+    btn.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n+    btn.style.height = '36px';\r\n+    btn.style.display = 'flex';\r\n+    btn.style.alignItems = 'top';\r\n+    btn.style.transition = 'background-color 0.1s ease';\r\n+    additional.appendChild(btn);\r\n+    btn.addEventListener('click', onAnalyzeClick);\r\n+    console.log('ytcmtck: è§£æãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥ã—ã¾ã—ãŸ');\r\n+  }\r\n+\r\n+  // ã‚³ãƒ¡ãƒ³ãƒˆçµæœè¡¨ç¤º\r\n+  function showResult(message, isFinal) {\r\n+    let result = document.getElementById('ytcmtck-analyze-result');\r\n+    if (!result) {\r\n+      result = document.createElement('div');\r\n+      result.id = 'ytcmtck-analyze-result';\r\n+      result.style.margin = '16px 0';\r\n+      result.style.padding = '16px';\r\n+      result.style.background = '#f9f9f9';\r\n+      result.style.border = '1px solid #ddd';\r\n+      result.style.borderRadius = '8px';\r\n+      result.style.fontSize = '16px';\r\n+      result.style.lineHeight = '1.5';\r\n+      result.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n+      result.style.whiteSpace = 'pre-line';\r\n+      const commentSection = document.querySelector('#comments');\r\n+      if (commentSection) commentSection.prepend(result);\r\n+    }\r\n+    result.textContent = message;\r\n+    if (isFinal) {\r\n+      result.style.background = '#e6ffe6';\r\n+      result.style.fontWeight = '500';\r\n+      setTimeout(() => {\r\n+        if (result && result.parentNode) {\r\n+          result.remove();\r\n+          addLog('è§£æçµæœè¡¨ç¤ºã‚’è‡ªå‹•ã§å‰Šé™¤ã—ã¾ã—ãŸ', 'info');\r\n+        }\r\n+      }, 10000); // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚10ç§’ã«å»¶é•·\r\n+    }\r\n+  }\r\n+\r\n+  // YouTubeå‹•ç”»IDã‚’URLã‹ã‚‰å–å¾—\r\n+  function getVideoId() {\r\n+    const url = new URL(location.href);\r\n+    return url.searchParams.get('v');\r\n+  }\r\n+\r\n+  // YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¨ä»¶å–å¾—ï¼ˆæœ€å¤§1000ä»¶ã¾ã§ï¼‰\r\n+  async function fetchComments(videoId) {\r\n+    if (!videoId) return { count: 0, comments: [] };\r\n+    const maxTotal = 1000;\r\n+    let comments = [];\r\n+    let pageToken = '';\r\n+    try {\r\n+      while (comments.length < maxTotal) {\r\n+        let apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=100`;\r\n+        if (pageToken) apiUrl += `&pageToken=${pageToken}`;\r\n+        const res = await fetch(apiUrl);\r\n+        const data = await res.json();\r\n+        if (data.error) {\r\n+          console.error('YouTube API Error:', data.error);\r\n+          break;\r\n+        }\r\n+        const newComments = data.items ? data.items.map(item => ({\r\n+          author: item.snippet.topLevelComment.snippet.authorDisplayName,\r\n+          authorProfileImageUrl: item.snippet.topLevelComment.snippet.authorProfileImageUrl,\r\n+          authorChannelUrl: item.snippet.topLevelComment.snippet.authorChannelUrl || '#',\r\n+          text: item.snippet.topLevelComment.snippet.textDisplay,\r\n+          publishedAt: item.snippet.topLevelComment.snippet.publishedAt,\r\n+          updatedAt: item.snippet.topLevelComment.snippet.updatedAt,\r\n+          likeCount: item.snippet.topLevelComment.snippet.likeCount || 0,\r\n+          id: item.snippet.topLevelComment.id\r\n+        })) : [];\r\n+        comments = comments.concat(newComments);\r\n+        if (!data.nextPageToken || comments.length >= maxTotal) break;\r\n+        pageToken = data.nextPageToken;\r\n+      }\r\n+      return { count: comments.length, comments: comments };\r\n+    } catch (e) {\r\n+      console.error('API fetch error:', e);\r\n+      return { count: 0, comments: [] };\r\n+    }\r\n+  }\r\n+\r\n+  // YouTubeã®ã€Œâ—‹åˆ†å‰ã€å½¢å¼\r\n+  function formatTimeAgo(publishedAt) {\r\n+    const now = new Date();\r\n+    const published = new Date(publishedAt);\r\n+    const diffMs = now - published;\r\n+    const minutes = Math.floor(diffMs / (1000 * 60));\r\n+    const hours = Math.floor(diffMs / (1000 * 60 * 60));\r\n+    const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n+    const weeks = Math.floor(days / 7);\r\n+    const months = Math.floor(days / 30);\r\n+    const years = Math.floor(days / 365);\r\n+    if (years > 0) {\r\n+      return `${years} å¹´å‰`;\r\n+    } else if (months > 0) {\r\n+      return `${months} ã‹æœˆå‰`;\r\n+    } else if (weeks > 0) {\r\n+      return `${weeks} é€±é–“å‰`;\r\n+    } else if (days > 0) {\r\n+      return `${days} æ—¥å‰`;\r\n+    } else if (hours > 0) {\r\n+      return `${hours} æ™‚é–“å‰`;\r\n+    } else if (minutes > 0) {\r\n+      return `${minutes} åˆ†å‰`;\r\n+    } else {\r\n+      return 'ä»Š';\r\n+    }\r\n+  }\r\n+\r\n+  // ç”»é¢ä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’ã§ãã‚‹ã ã‘æ­£ç¢ºã«å–å¾—ã™ã‚‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç‰ˆï¼‰\r\n+  function getDisplayedCommentIds() {\r\n+    const ids = new Set();\r\n+    const debugInfo = [];\r\n+    \r\n+    // 1. é€šå¸¸ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆãƒ¡ã‚¤ãƒ³ã®æ–¹æ³•ï¼‰\r\n+    document.querySelectorAll('ytd-comment-thread-renderer').forEach((threadRenderer, index) => {\r\n+      // ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ã®ãƒªãƒ³ã‚¯ã‹ã‚‰IDã‚’å–å¾—\r\n+      const linkWithLc = threadRenderer.querySelector('a[href*=\"lc=\"]');\r\n+      if (linkWithLc) {\r\n+        const match = linkWithLc.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n+        if (match) {\r\n+          ids.add(match[1]);\r\n+          debugInfo.push(`æ–¹æ³•1-${index}: ${match[1]} (${threadRenderer.querySelector('#content-text')?.textContent?.slice(0, 30) || 'ãƒ†ã‚­ã‚¹ãƒˆä¸æ˜'}...)`);\r\n+        }\r\n+      }\r\n+      \r\n+      // dataå±æ€§ç³»ã‚‚ç¢ºèª\r\n+      const dataId = threadRenderer.getAttribute('data-id');\r\n+      if (dataId) {\r\n+        ids.add(dataId);\r\n+        debugInfo.push(`data-id-${index}: ${dataId}`);\r\n+      }\r\n+    });\r\n+\r\n+    // 2. è¿”ä¿¡ã‚³ãƒ¡ãƒ³ãƒˆ\r\n+    document.querySelectorAll('ytd-comment-renderer').forEach((commentRenderer, index) => {\r\n+      const linkWithLc = commentRenderer.querySelector('a[href*=\"lc=\"]');\r\n+      if (linkWithLc) {\r\n+        const match = linkWithLc.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n+        if (match) {\r\n+          ids.add(match[1]);\r\n+          debugInfo.push(`è¿”ä¿¡${index}: ${match[1]}`);\r\n+        }\r\n+      }\r\n+    });\r\n+\r\n+    // 3. æ—¢ã«æŒ¿å…¥ã—ãŸæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ\r\n+    document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]').forEach((hiddenComment, index) => {\r\n+      const commentId = hiddenComment.getAttribute('data-comment-id');\r\n+      if (commentId) {\r\n+        ids.add(commentId);\r\n+        debugInfo.push(`æ—¢å­˜æœªè¡¨ç¤º${index}: ${commentId}`);\r\n+      }\r\n+    });\r\n+\r\n+    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ãƒ­ã‚°ã«å‡ºåŠ›\r\n+    addLog(`=== ãƒ‡ãƒãƒƒã‚°: ç”»é¢ä¸Šã§æ¤œå‡ºã—ãŸã‚³ãƒ¡ãƒ³ãƒˆIDä¸€è¦§ ===`, 'debug');\r\n+    debugInfo.forEach(info => addLog(info, 'debug'));\r\n+    addLog(`=== åˆè¨ˆ: ${ids.size}å€‹ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ID ===`, 'debug');\r\n+    \r\n+    return ids;\r\n+  }\r\n+\r\n+  // ç”»é¢ã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã‚’ã§ãã‚‹ã ã‘å…¨ã¦ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\r\n+  async function loadAllVisibleComments(maxTry = 10) {\r\n+    addLog('ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¨ã¦èª­ã¿è¾¼ã¿ä¸­...', 'progress');\r\n+    \r\n+    // ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’è‡ªå‹•ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹\r\n+    let tries = 0;\r\n+    while (tries < maxTry) {\r\n+      let moreBtn = Array.from(document.querySelectorAll('ytd-button-renderer'))\r\n+        .find(btn => /ã•ã‚‰ã«è¡¨ç¤º|Show more/i.test(btn.textContent));\r\n+      if (moreBtn && moreBtn.offsetParent !== null) { // è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒœã‚¿ãƒ³ã®ã¿\r\n+        addLog(`ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ (${tries + 1}/${maxTry})`, 'progress');\r\n+        moreBtn.click();\r\n+        await new Promise(r => setTimeout(r, 2000)); // å°‘ã—é•·ã‚ã«å¾…æ©Ÿ\r\n+      } else {\r\n+        addLog('ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€å…¨ã¦èª­ã¿è¾¼ã¿å®Œäº†', 'info');\r\n+        break;\r\n+      }\r\n+      tries++;\r\n+    }\r\n+    \r\n+    // ç”»é¢ã‚’è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦é…å»¶ãƒ­ãƒ¼ãƒ‰ã‚‚ä¿ƒã™\r\n+    let lastCount = 0;\r\n+    for (let i = 0; i < maxTry; i++) {\r\n+      window.scrollTo(0, document.body.scrollHeight);\r\n+      await new Promise(r => setTimeout(r, 1000));\r\n+      const currCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n+      addLog(`ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« ${i + 1}/${maxTry}: ${currCount}ä»¶ã®ã‚³ãƒ¡ãƒ³ãƒˆè¦ç´ `, 'progress');\r\n+      if (currCount === lastCount && i > 2) break; // 3å›å¤‰åŒ–ãŒãªã‘ã‚Œã°çµ‚äº†\r\n+      lastCount = currCount;\r\n+    }\r\n+    \r\n+    addLog(`ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${lastCount}ä»¶`, 'success');\r\n+  }\r\n+\r\n+  // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸Šéƒ¨ã«æŒ¿å…¥\r\n+  function insertHiddenComment(comment) {\r\n+    const commentElement = document.createElement('ytd-comment-view-model');\r\n+    commentElement.className = 'style-scope ytd-comment-thread-renderer';\r\n+    commentElement.setAttribute('data-ytcmtck-hidden', 'true');\r\n+    commentElement.setAttribute('data-comment-id', comment.id);\r\n+    commentElement.style.borderRadius = '8px';\r\n+    commentElement.style.marginBottom = '16px';\r\n+    commentElement.style.backgroundColor = '#fff3cd'; // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã¯è–„é»„è‰²èƒŒæ™¯\r\n+    commentElement.style.border = '2px solid #856404'; // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šå¢ƒç•Œç·š\r\n+    commentElement.innerHTML = `\r\n+      <div style=\"background: #856404; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n+        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (ID: ${comment.id})\r\n+      </div>\r\n+      <div id=\"body\" class=\"style-scope ytd-comment-view-model\">\r\n+        <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n+          <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n+            <yt-img-shadow fit=\"\" height=\"40\" width=\"40\" class=\"style-scope ytd-comment-view-model no-transition\" style=\"background-color: transparent;\">\r\n+              <img style=\"width: 40px; height: 40px; border-radius: 50%; object-fit: cover;\" src=\"${comment.authorProfileImageUrl}\" alt=\"${comment.author}\" onerror=\"this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNFNUU3RUIiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMzQgMzJDMzQgMjYuNDc3MiAyOS41MjI4IDIyIDI0IDIySDIwSDEyQzEwLjg5NTQgMjIgMTAgMjIuODk1NCAxMCAyNFYzNEgzNFYzMloiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+'\" />\r\n+            </yt-img-shadow>\r\n+          </button>\r\n+        </div>\r\n+        <div id=\"main\" class=\"style-scope ytd-comment-view-model\">\r\n+          <div id=\"header\" class=\"style-scope ytd-comment-view-model\" style=\"display: flex; align-items: center; flex-wrap: wrap; gap: 8px;\">\r\n+            <h3 class=\"style-scope ytd-comment-view-model\" style=\"margin: 0; font-size: 13px; line-height: 18px; font-weight: 500;\">\r\n+              <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"${comment.authorChannelUrl}\" style=\"color: #0f0f0f; text-decoration: none;\">\r\n+                <span class=\"style-scope ytd-comment-view-model\">${comment.author}</span>\r\n+              </a>\r\n+            </h3>\r\n+            <span dir=\"auto\" style=\"color: #606060; font-size: 12px; line-height: 18px;\">\r\n+              <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"/watch?v=${getVideoId()}&lc=${comment.id}\" style=\"color: inherit; text-decoration: none;\">\r\n+                ${formatTimeAgo(comment.publishedAt)}\r\n+              </a>\r\n+            </span>\r\n+          </div>\r\n+          <div style=\"margin-top: 2px;\">\r\n+            <span style=\"color: #0f0f0f; font-size: 14px; line-height: 20px; white-space: pre-wrap;\">${comment.text}</span>\r\n+          </div>\r\n+          <div style=\"margin-top: 8px; display: flex; align-items: center; gap: 8px;\">\r\n+            <span style=\"font-size: 12px; color: #856404;\">ğŸ‘† ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒæ—¢ã«ä¸‹ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é‡è¤‡ã§ã™</span>\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+    `;\r\n+    const commentSection = document.querySelector('#comments #contents');\r\n+    if (commentSection) commentSection.prepend(commentElement);\r\n+  }\r\n+\r\n+  // è§£æã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒ¡ã‚¤ãƒ³å‡¦ç†\r\n+  async function onAnalyzeClick() {\r\n+    addLog('ğŸ” ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n+    showResult('è§£æä¸­...', false);\r\n+\r\n+    addLog('ã¾ãšç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã§ãã‚‹ã ã‘å…¨ã¦èª­ã¿è¾¼ã¿ã¾ã™', 'progress');\r\n+    await loadAllVisibleComments(5); // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—æ¸›ã‚‰ã™\r\n+\r\n+    addLog('ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’å–å¾—...', 'progress');\r\n+    displayedCommentIds = getDisplayedCommentIds();\r\n+    addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'success');\r\n+\r\n+    addLog('å‹•ç”»IDã‚’å–å¾—ä¸­...', 'progress');\r\n+    const videoId = getVideoId();\r\n+    if (!videoId) {\r\n+      addLog('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', 'error');\r\n+      showResult('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n+      return;\r\n+    }\r\n+    addLog(`å‹•ç”»ID: ${videoId}`, 'success');\r\n+\r\n+    await new Promise(r => setTimeout(r, 500));\r\n+    addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ä¸­...', 'api');\r\n+    const apiData = await fetchComments(videoId);\r\n+    const apiCount = apiData.count;\r\n+    if (apiData.count === 0 && apiData.comments.length === 0) {\r\n+      addLog('è­¦å‘Š: APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ (APIã‚­ãƒ¼ã¾ãŸã¯æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„)', 'error');\r\n+      showResult('APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n+      return;\r\n+    }\r\n+    addLog(`APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ: ${apiCount}ä»¶`, 'success');\r\n+\r\n+    // ãƒ‡ãƒãƒƒã‚°ï¼šAPIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆã®æœ€åˆã®5ä»¶ã‚’ãƒ­ã‚°å‡ºåŠ›\r\n+    addLog('=== ãƒ‡ãƒãƒƒã‚°: APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆã®æœ€åˆã®5ä»¶ ===', 'debug');\r\n+    apiData.comments.slice(0, 5).forEach((comment, index) => {\r\n+      addLog(`API${index + 1}: ${comment.id} - ${comment.author}: ${comment.text.slice(0, 30)}...`, 'debug');\r\n+    });\r\n+\r\n+    showResult('è§£æãŒå®Œäº†ã—ã¾ã—ãŸã€‚', false);\r\n+    addLog('è§£æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');\r\n+    await new Promise(r => setTimeout(r, 500));\r\n+\r\n+    // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®š\r\n+    const newHiddenComments = apiData.comments.filter(comment => !displayedCommentIds.has(comment.id));\r\n+    \r\n+    addLog('=== ãƒ‡ãƒãƒƒã‚°: æœªè¡¨ç¤ºã¨åˆ¤å®šã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆ ===', 'debug');\r\n+    newHiddenComments.slice(0, 10).forEach((comment, index) => {\r\n+      addLog(`æœªè¡¨ç¤º${index + 1}: ${comment.id} - ${comment.author}: ${comment.text.slice(0, 30)}...`, 'debug');\r\n+    });\r\n+\r\n+    let resultMsg = 'è§£æçµæœï¼š\\n';\r\n+    if (newHiddenComments.length === 0) {\r\n+      resultMsg += 'å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚';\r\n+      addLog('çµæœ: å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™', 'success');\r\n+    } else {\r\n+      resultMsg += `æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚\\n\\nâš ï¸ ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰: é»„è‰²èƒŒæ™¯ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒæ—¢ã«ä¸‹ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é‡è¤‡ã§ã™ã€‚`;\r\n+      addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’æ¤œå‡º`, 'progress');\r\n+      newHiddenComments.forEach(comment => {\r\n+        insertHiddenComment(comment);\r\n+        displayedCommentIds.add(comment.id);\r\n+      });\r\n+      addLog(`${newHiddenComments.length}ä»¶ã®æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n+    }\r\n+    showResult(resultMsg, true);\r\n+    addLog('ğŸ‰ ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n+\r\n+    setTimeout(() => {\r\n+      addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™ (æ‰‹å‹•ã§é–‰ã˜ã‚‹ã“ã¨ã‚‚å¯èƒ½)', 'info');\r\n+      setTimeout(closeLogPopup, 2000);\r\n+    }, 5000);\r\n+  }\r\n+\r\n+  // MutationObserverã§DOMå¤‰åŒ–ç›£è¦–\r\n+  function startObserver() {\r\n+    const observer = new MutationObserver((mutations) => {\r\n+      let shouldCheck = false;\r\n+      mutations.forEach((mutation) => {\r\n+        if (mutation.type === 'childList') {\r\n+          mutation.addedNodes.forEach((node) => {\r\n+            if (node.nodeType === 1) {\r\n+              if (node.matches && (\r\n+                node.matches('ytd-comments-header-renderer') ||\r\n+                node.querySelector && node.querySelector('ytd-comments-header-renderer')\r\n+              )) {\r\n+                shouldCheck = true;\r\n+              }\r\n+            }\r\n+          });\r\n+        }\r\n+      });\r\n+      if (shouldCheck) {\r\n+        setTimeout(insertAnalyzeButton, 500);\r\n+      }\r\n+    });\r\n+    observer.observe(document.body, { childList: true, subtree: true });\r\n+    return observer;\r\n+  }\r\n+\r\n+  // å‹•çš„ãƒšãƒ¼ã‚¸å¯¾å¿œï¼‹ãƒœã‚¿ãƒ³ç›£è¦–\r\n+  let lastUrl = location.href;\r\n+  let checkInterval;\r\n+  let observer;\r\n+  function startMonitoring() {\r\n+    observer = startObserver();\r\n+    checkInterval = setInterval(() => {\r\n+      if (location.href !== lastUrl) {\r\n+        lastUrl = location.href;\r\n+        console.log('ytcmtck: ãƒšãƒ¼ã‚¸é·ç§»ã‚’æ¤œå‡ºã€ãƒœã‚¿ãƒ³å†æŒ¿å…¥ã‚’è©¦è¡Œ');\r\n+        setTimeout(insertAnalyzeButton, 1000);\r\n+        setTimeout(insertAnalyzeButton, 3000);\r\n+      }\r\n+      if (!document.getElementById('ytcmtck-analyze-btn') && findInsertTarget()) {\r\n+        console.log('ytcmtck: ãƒœã‚¿ãƒ³ãŒæ¶ˆå¤±ã€å†æŒ¿å…¥');\r\n+        insertAnalyzeButton();\r\n+      }\r\n+    }, 2000);\r\n+  }\r\n+\r\n+  // åˆæœŸåŒ–\r\n+  function init() {\r\n+    setTimeout(insertAnalyzeButton, 1000);\r\n+    setTimeout(insertAnalyzeButton, 3000);\r\n+    setTimeout(insertAnalyzeButton, 5000);\r\n+    startMonitoring();\r\n+  }\r\n+  if (document.readyState === 'loading') {\r\n+    document.addEventListener('DOMContentLoaded', init);\r\n+  } else {\r\n+    init();\r\n+  }\r\n+\r\n+  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ä½œæˆãƒ»è¡¨ç¤º\r\n+  function showLogPopup() {\r\n+    let popup = document.getElementById('ytcmtck-log-popup');\r\n+    if (!popup) {\r\n+      popup = document.createElement('div');\r\n+      popup.id = 'ytcmtck-log-popup';\r\n+      popup.style.position = 'fixed';\r\n+      popup.style.top = '20px';\r\n+      popup.style.right = '20px';\r\n+      popup.style.width = '450px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—å¹…ã‚’åºƒã’ã‚‹\r\n+      popup.style.maxHeight = '600px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚é«˜ãã™ã‚‹\r\n+      popup.style.backgroundColor = '#fff';\r\n+      popup.style.border = '2px solid #cc0000';\r\n+      popup.style.borderRadius = '8px';\r\n+      popup.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';\r\n+      popup.style.zIndex = '10000';\r\n+      popup.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n+      popup.style.fontSize = '13px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—å°ã•ã\r\n+      popup.style.overflow = 'hidden';\r\n+      const header = document.createElement('div');\r\n+      header.style.backgroundColor = '#cc0000';\r\n+      header.style.color = '#fff';\r\n+      header.style.padding = '12px';\r\n+      header.style.fontWeight = 'bold';\r\n+      header.style.display = 'flex';\r\n+      header.style.justifyContent = 'space-between';\r\n+      header.style.alignItems = 'center';\r\n+      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚° (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)';\r\n+      const closeBtn = document.createElement('button');\r\n+      closeBtn.innerHTML = 'Ã—';\r\n+      closeBtn.style.backgroundColor = 'transparent';\r\n+      closeBtn.style.border = 'none';\r\n+      closeBtn.style.color = '#fff';\r\n+      closeBtn.style.fontSize = '18px';\r\n+      closeBtn.style.cursor = 'pointer';\r\n+      closeBtn.style.padding = '0';\r\n+      closeBtn.style.width = '24px';\r\n+      closeBtn.style.height = '24px';\r\n+      closeBtn.onclick = () => popup.remove();\r\n+      header.appendChild(closeBtn);\r\n+      const content = document.createElement('div');\r\n+      content.id = 'ytcmtck-log-content';\r\n+      content.style.padding = '16px';\r\n+      content.style.maxHeight = '500px';\r\n+      content.style.overflowY = 'auto';\r\n+      content.style.lineHeight = '1.3';\r\n+      popup.appendChild(header);\r\n+      popup.appendChild(content);\r\n+      document.body.appendChild(popup);\r\n+    }\r\n+    return popup;\r\n+  }\r\n+\r\n+  // ãƒ­ã‚°è¿½åŠ \r\n+  function addLog(message, type = 'info') {\r\n+    const popup = showLogPopup();\r\n+    const content = document.getElementById('ytcmtck-log-content');\r\n+    const logEntry = document.createElement('div');\r\n+    logEntry.style.marginBottom = '6px';\r\n+    logEntry.style.padding = '6px';\r\n+    logEntry.style.borderRadius = '4px';\r\n+    logEntry.style.fontSize = '12px';\r\n+    const timestamp = new Date().toLocaleTimeString('ja-JP');\r\n+    let icon = '';\r\n+    let bgColor = '';\r\n+    switch(type) {\r\n+      case 'start': icon = 'ğŸš€'; bgColor = '#e3f2fd'; break;\r\n+      case 'progress': icon = 'â³'; bgColor = '#fff3e0'; break;\r\n+      case 'success': icon = 'âœ…'; bgColor = '#e8f5e8'; break;\r\n+      case 'error': icon = 'âŒ'; bgColor = '#ffebee'; break;\r\n+      case 'api': icon = 'ğŸ”—'; bgColor = '#f3e5f5'; break;\r\n+      case 'debug': icon = 'ğŸ›'; bgColor = '#fff9c4'; break;\r\n+      default: icon = 'â„¹ï¸'; bgColor = '#f5f5f5';\r\n+    }\r\n+    logEntry.style.backgroundColor = bgColor;\r\n+    logEntry.innerHTML = `<span style=\"color: #666; font-size: 11px;\">${timestamp}</span> ${icon} ${message}`;\r\n+    content.appendChild(logEntry);\r\n+    content.scrollTop = content.scrollHeight;\r\n+  }\r\n+\r\n+  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹\r\n+  function closeLogPopup() {\r\n+    const popup = document.getElementById('ytcmtck-log-popup');\r\n+    if (popup) popup.remove();\r\n+  }\r\n+})();\n\\ No newline at end of file\n"
                },
                {
                    "date": 1750261151112,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,42 +1,26 @@\n-// ==UserScript==\r\n-// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)\r\n-// @namespace    https://github.com/yourname/\r\n-// @version      1.2.0\r\n-// @description  YouTubeã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§APIä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆã¨ç”»é¢ä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¯”è¼ƒã—ã€æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ã‚’æ¤œå‡ºã—ã¦æœ€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã™ã€‚ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ä»˜ãã€‚\r\n-// @author       YourName\r\n-// @match        https://www.youtube.com/watch*\r\n-// @grant        none\r\n-// ==/UserScript==\r\n-\r\n+// YouTubeã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ä»˜è¿‘ã«ã€Œã‚³ãƒ¡ãƒ³ãƒˆã‚’è§£æã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã—ã€ã‚¯ãƒªãƒƒã‚¯æ™‚ã«è§£æãƒ»çµæœè¡¨ç¤º\r\n (function() {\r\n-  'use strict';\r\n-\r\n-  // è¨­å®šï¼šYouTube Data APIã‚­ãƒ¼\r\n-  const YOUTUBE_API_KEY = 'AIzaSyCB9iLVqz1AsLrYk83tILnILa7n6OzfEkg';\r\n-\r\n-  // æ—¢ã«è¡¨ç¤ºæ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’è¨˜éŒ²ã™ã‚‹ã‚»ãƒƒãƒˆ\r\n-  let displayedCommentIds = new Set();\r\n-\r\n-  // è§£æãƒœã‚¿ãƒ³æŒ¿å…¥ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’æ¢ã™\r\n+  // ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã®è¦ªè¦ç´ ã‚’æ¢ã™ï¼ˆæ–°ä»•æ§˜: #additional-sectionå†…éƒ¨ï¼‰\r\n   function findInsertTarget() {\r\n     const commentsHeader = document.querySelector('ytd-comments-header-renderer');\r\n     if (!commentsHeader) return null;\r\n     const additional = commentsHeader.querySelector('#additional-section');\r\n     return additional;\r\n   }\r\n \r\n-  // è§£æãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥\r\n   function insertAnalyzeButton() {\r\n+    // æ—¢ã«ãƒœã‚¿ãƒ³ãŒã‚ã‚‹å ´åˆã¯ä½•ã‚‚ã—ãªã„\r\n     if (document.getElementById('ytcmtck-analyze-btn')) return;\r\n+    \r\n     const additional = findInsertTarget();\r\n     if (!additional) {\r\n       console.log('ytcmtck: #additional-section not found, retrying...');\r\n       return;\r\n     }\r\n-    const btn = document.createElement('button');\r\n+      const btn = document.createElement('button');\r\n     btn.id = 'ytcmtck-analyze-btn';\r\n-    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)';\r\n+    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ';\r\n     btn.style.marginLeft = '16px';\r\n     btn.style.marginTop = '2px';\r\n     btn.style.background = 'transparent';\r\n     btn.style.color = '#0f0f0f';\r\n@@ -48,331 +32,23 @@\n     btn.style.height = '36px';\r\n     btn.style.display = 'flex';\r\n     btn.style.alignItems = 'top';\r\n     btn.style.transition = 'background-color 0.1s ease';\r\n+    \r\n+    // #additional-sectionå†…éƒ¨ã®æœ€å¾Œã«æŒ¿å…¥\r\n     additional.appendChild(btn);\r\n     btn.addEventListener('click', onAnalyzeClick);\r\n     console.log('ytcmtck: è§£æãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥ã—ã¾ã—ãŸ');\r\n   }\r\n \r\n-  // ã‚³ãƒ¡ãƒ³ãƒˆçµæœè¡¨ç¤º\r\n-  function showResult(message, isFinal) {\r\n-    let result = document.getElementById('ytcmtck-analyze-result');\r\n-    if (!result) {\r\n-      result = document.createElement('div');\r\n-      result.id = 'ytcmtck-analyze-result';\r\n-      result.style.margin = '16px 0';\r\n-      result.style.padding = '16px';\r\n-      result.style.background = '#f9f9f9';\r\n-      result.style.border = '1px solid #ddd';\r\n-      result.style.borderRadius = '8px';\r\n-      result.style.fontSize = '16px';\r\n-      result.style.lineHeight = '1.5';\r\n-      result.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n-      result.style.whiteSpace = 'pre-line';\r\n-      const commentSection = document.querySelector('#comments');\r\n-      if (commentSection) commentSection.prepend(result);\r\n-    }\r\n-    result.textContent = message;\r\n-    if (isFinal) {\r\n-      result.style.background = '#e6ffe6';\r\n-      result.style.fontWeight = '500';\r\n-      setTimeout(() => {\r\n-        if (result && result.parentNode) {\r\n-          result.remove();\r\n-          addLog('è§£æçµæœè¡¨ç¤ºã‚’è‡ªå‹•ã§å‰Šé™¤ã—ã¾ã—ãŸ', 'info');\r\n-        }\r\n-      }, 10000); // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚10ç§’ã«å»¶é•·\r\n-    }\r\n-  }\r\n-\r\n-  // YouTubeå‹•ç”»IDã‚’URLã‹ã‚‰å–å¾—\r\n-  function getVideoId() {\r\n-    const url = new URL(location.href);\r\n-    return url.searchParams.get('v');\r\n-  }\r\n-\r\n-  // YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¨ä»¶å–å¾—ï¼ˆæœ€å¤§1000ä»¶ã¾ã§ï¼‰\r\n-  async function fetchComments(videoId) {\r\n-    if (!videoId) return { count: 0, comments: [] };\r\n-    const maxTotal = 1000;\r\n-    let comments = [];\r\n-    let pageToken = '';\r\n-    try {\r\n-      while (comments.length < maxTotal) {\r\n-        let apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=100`;\r\n-        if (pageToken) apiUrl += `&pageToken=${pageToken}`;\r\n-        const res = await fetch(apiUrl);\r\n-        const data = await res.json();\r\n-        if (data.error) {\r\n-          console.error('YouTube API Error:', data.error);\r\n-          break;\r\n-        }\r\n-        const newComments = data.items ? data.items.map(item => ({\r\n-          author: item.snippet.topLevelComment.snippet.authorDisplayName,\r\n-          authorProfileImageUrl: item.snippet.topLevelComment.snippet.authorProfileImageUrl,\r\n-          authorChannelUrl: item.snippet.topLevelComment.snippet.authorChannelUrl || '#',\r\n-          text: item.snippet.topLevelComment.snippet.textDisplay,\r\n-          publishedAt: item.snippet.topLevelComment.snippet.publishedAt,\r\n-          updatedAt: item.snippet.topLevelComment.snippet.updatedAt,\r\n-          likeCount: item.snippet.topLevelComment.snippet.likeCount || 0,\r\n-          id: item.snippet.topLevelComment.id\r\n-        })) : [];\r\n-        comments = comments.concat(newComments);\r\n-        if (!data.nextPageToken || comments.length >= maxTotal) break;\r\n-        pageToken = data.nextPageToken;\r\n-      }\r\n-      return { count: comments.length, comments: comments };\r\n-    } catch (e) {\r\n-      console.error('API fetch error:', e);\r\n-      return { count: 0, comments: [] };\r\n-    }\r\n-  }\r\n-\r\n-  // YouTubeã®ã€Œâ—‹åˆ†å‰ã€å½¢å¼\r\n-  function formatTimeAgo(publishedAt) {\r\n-    const now = new Date();\r\n-    const published = new Date(publishedAt);\r\n-    const diffMs = now - published;\r\n-    const minutes = Math.floor(diffMs / (1000 * 60));\r\n-    const hours = Math.floor(diffMs / (1000 * 60 * 60));\r\n-    const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n-    const weeks = Math.floor(days / 7);\r\n-    const months = Math.floor(days / 30);\r\n-    const years = Math.floor(days / 365);\r\n-    if (years > 0) {\r\n-      return `${years} å¹´å‰`;\r\n-    } else if (months > 0) {\r\n-      return `${months} ã‹æœˆå‰`;\r\n-    } else if (weeks > 0) {\r\n-      return `${weeks} é€±é–“å‰`;\r\n-    } else if (days > 0) {\r\n-      return `${days} æ—¥å‰`;\r\n-    } else if (hours > 0) {\r\n-      return `${hours} æ™‚é–“å‰`;\r\n-    } else if (minutes > 0) {\r\n-      return `${minutes} åˆ†å‰`;\r\n-    } else {\r\n-      return 'ä»Š';\r\n-    }\r\n-  }\r\n-\r\n-  // ç”»é¢ä¸Šã®å…¨ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’ã§ãã‚‹ã ã‘æ­£ç¢ºã«å–å¾—ã™ã‚‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç‰ˆï¼‰\r\n-  function getDisplayedCommentIds() {\r\n-    const ids = new Set();\r\n-    const debugInfo = [];\r\n-    \r\n-    // 1. é€šå¸¸ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆãƒ¡ã‚¤ãƒ³ã®æ–¹æ³•ï¼‰\r\n-    document.querySelectorAll('ytd-comment-thread-renderer').forEach((threadRenderer, index) => {\r\n-      // ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ã®ãƒªãƒ³ã‚¯ã‹ã‚‰IDã‚’å–å¾—\r\n-      const linkWithLc = threadRenderer.querySelector('a[href*=\"lc=\"]');\r\n-      if (linkWithLc) {\r\n-        const match = linkWithLc.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n-        if (match) {\r\n-          ids.add(match[1]);\r\n-          debugInfo.push(`æ–¹æ³•1-${index}: ${match[1]} (${threadRenderer.querySelector('#content-text')?.textContent?.slice(0, 30) || 'ãƒ†ã‚­ã‚¹ãƒˆä¸æ˜'}...)`);\r\n-        }\r\n-      }\r\n-      \r\n-      // dataå±æ€§ç³»ã‚‚ç¢ºèª\r\n-      const dataId = threadRenderer.getAttribute('data-id');\r\n-      if (dataId) {\r\n-        ids.add(dataId);\r\n-        debugInfo.push(`data-id-${index}: ${dataId}`);\r\n-      }\r\n-    });\r\n-\r\n-    // 2. è¿”ä¿¡ã‚³ãƒ¡ãƒ³ãƒˆ\r\n-    document.querySelectorAll('ytd-comment-renderer').forEach((commentRenderer, index) => {\r\n-      const linkWithLc = commentRenderer.querySelector('a[href*=\"lc=\"]');\r\n-      if (linkWithLc) {\r\n-        const match = linkWithLc.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n-        if (match) {\r\n-          ids.add(match[1]);\r\n-          debugInfo.push(`è¿”ä¿¡${index}: ${match[1]}`);\r\n-        }\r\n-      }\r\n-    });\r\n-\r\n-    // 3. æ—¢ã«æŒ¿å…¥ã—ãŸæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ\r\n-    document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]').forEach((hiddenComment, index) => {\r\n-      const commentId = hiddenComment.getAttribute('data-comment-id');\r\n-      if (commentId) {\r\n-        ids.add(commentId);\r\n-        debugInfo.push(`æ—¢å­˜æœªè¡¨ç¤º${index}: ${commentId}`);\r\n-      }\r\n-    });\r\n-\r\n-    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ãƒ­ã‚°ã«å‡ºåŠ›\r\n-    addLog(`=== ãƒ‡ãƒãƒƒã‚°: ç”»é¢ä¸Šã§æ¤œå‡ºã—ãŸã‚³ãƒ¡ãƒ³ãƒˆIDä¸€è¦§ ===`, 'debug');\r\n-    debugInfo.forEach(info => addLog(info, 'debug'));\r\n-    addLog(`=== åˆè¨ˆ: ${ids.size}å€‹ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ID ===`, 'debug');\r\n-    \r\n-    return ids;\r\n-  }\r\n-\r\n-  // ç”»é¢ã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã‚’ã§ãã‚‹ã ã‘å…¨ã¦ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\r\n-  async function loadAllVisibleComments(maxTry = 10) {\r\n-    addLog('ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¨ã¦èª­ã¿è¾¼ã¿ä¸­...', 'progress');\r\n-    \r\n-    // ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’è‡ªå‹•ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹\r\n-    let tries = 0;\r\n-    while (tries < maxTry) {\r\n-      let moreBtn = Array.from(document.querySelectorAll('ytd-button-renderer'))\r\n-        .find(btn => /ã•ã‚‰ã«è¡¨ç¤º|Show more/i.test(btn.textContent));\r\n-      if (moreBtn && moreBtn.offsetParent !== null) { // è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒœã‚¿ãƒ³ã®ã¿\r\n-        addLog(`ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ (${tries + 1}/${maxTry})`, 'progress');\r\n-        moreBtn.click();\r\n-        await new Promise(r => setTimeout(r, 2000)); // å°‘ã—é•·ã‚ã«å¾…æ©Ÿ\r\n-      } else {\r\n-        addLog('ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€å…¨ã¦èª­ã¿è¾¼ã¿å®Œäº†', 'info');\r\n-        break;\r\n-      }\r\n-      tries++;\r\n-    }\r\n-    \r\n-    // ç”»é¢ã‚’è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦é…å»¶ãƒ­ãƒ¼ãƒ‰ã‚‚ä¿ƒã™\r\n-    let lastCount = 0;\r\n-    for (let i = 0; i < maxTry; i++) {\r\n-      window.scrollTo(0, document.body.scrollHeight);\r\n-      await new Promise(r => setTimeout(r, 1000));\r\n-      const currCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n-      addLog(`ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« ${i + 1}/${maxTry}: ${currCount}ä»¶ã®ã‚³ãƒ¡ãƒ³ãƒˆè¦ç´ `, 'progress');\r\n-      if (currCount === lastCount && i > 2) break; // 3å›å¤‰åŒ–ãŒãªã‘ã‚Œã°çµ‚äº†\r\n-      lastCount = currCount;\r\n-    }\r\n-    \r\n-    addLog(`ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${lastCount}ä»¶`, 'success');\r\n-  }\r\n-\r\n-  // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸Šéƒ¨ã«æŒ¿å…¥\r\n-  function insertHiddenComment(comment) {\r\n-    const commentElement = document.createElement('ytd-comment-view-model');\r\n-    commentElement.className = 'style-scope ytd-comment-thread-renderer';\r\n-    commentElement.setAttribute('data-ytcmtck-hidden', 'true');\r\n-    commentElement.setAttribute('data-comment-id', comment.id);\r\n-    commentElement.style.borderRadius = '8px';\r\n-    commentElement.style.marginBottom = '16px';\r\n-    commentElement.style.backgroundColor = '#fff3cd'; // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã¯è–„é»„è‰²èƒŒæ™¯\r\n-    commentElement.style.border = '2px solid #856404'; // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šå¢ƒç•Œç·š\r\n-    commentElement.innerHTML = `\r\n-      <div style=\"background: #856404; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n-        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (ID: ${comment.id})\r\n-      </div>\r\n-      <div id=\"body\" class=\"style-scope ytd-comment-view-model\">\r\n-        <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n-          <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n-            <yt-img-shadow fit=\"\" height=\"40\" width=\"40\" class=\"style-scope ytd-comment-view-model no-transition\" style=\"background-color: transparent;\">\r\n-              <img style=\"width: 40px; height: 40px; border-radius: 50%; object-fit: cover;\" src=\"${comment.authorProfileImageUrl}\" alt=\"${comment.author}\" onerror=\"this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNFNUU3RUIiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMzQgMzJDMzQgMjYuNDc3MiAyOS41MjI4IDIyIDI0IDIySDIwSDEyQzEwLjg5NTQgMjIgMTAgMjIuODk1NCAxMCAyNFYzNEgzNFYzMloiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+'\" />\r\n-            </yt-img-shadow>\r\n-          </button>\r\n-        </div>\r\n-        <div id=\"main\" class=\"style-scope ytd-comment-view-model\">\r\n-          <div id=\"header\" class=\"style-scope ytd-comment-view-model\" style=\"display: flex; align-items: center; flex-wrap: wrap; gap: 8px;\">\r\n-            <h3 class=\"style-scope ytd-comment-view-model\" style=\"margin: 0; font-size: 13px; line-height: 18px; font-weight: 500;\">\r\n-              <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"${comment.authorChannelUrl}\" style=\"color: #0f0f0f; text-decoration: none;\">\r\n-                <span class=\"style-scope ytd-comment-view-model\">${comment.author}</span>\r\n-              </a>\r\n-            </h3>\r\n-            <span dir=\"auto\" style=\"color: #606060; font-size: 12px; line-height: 18px;\">\r\n-              <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"/watch?v=${getVideoId()}&lc=${comment.id}\" style=\"color: inherit; text-decoration: none;\">\r\n-                ${formatTimeAgo(comment.publishedAt)}\r\n-              </a>\r\n-            </span>\r\n-          </div>\r\n-          <div style=\"margin-top: 2px;\">\r\n-            <span style=\"color: #0f0f0f; font-size: 14px; line-height: 20px; white-space: pre-wrap;\">${comment.text}</span>\r\n-          </div>\r\n-          <div style=\"margin-top: 8px; display: flex; align-items: center; gap: 8px;\">\r\n-            <span style=\"font-size: 12px; color: #856404;\">ğŸ‘† ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒæ—¢ã«ä¸‹ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é‡è¤‡ã§ã™</span>\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-    `;\r\n-    const commentSection = document.querySelector('#comments #contents');\r\n-    if (commentSection) commentSection.prepend(commentElement);\r\n-  }\r\n-\r\n-  // è§£æã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒ¡ã‚¤ãƒ³å‡¦ç†\r\n-  async function onAnalyzeClick() {\r\n-    addLog('ğŸ” ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n-    showResult('è§£æä¸­...', false);\r\n-\r\n-    addLog('ã¾ãšç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã§ãã‚‹ã ã‘å…¨ã¦èª­ã¿è¾¼ã¿ã¾ã™', 'progress');\r\n-    await loadAllVisibleComments(5); // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—æ¸›ã‚‰ã™\r\n-\r\n-    addLog('ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’å–å¾—...', 'progress');\r\n-    displayedCommentIds = getDisplayedCommentIds();\r\n-    addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'success');\r\n-\r\n-    addLog('å‹•ç”»IDã‚’å–å¾—ä¸­...', 'progress');\r\n-    const videoId = getVideoId();\r\n-    if (!videoId) {\r\n-      addLog('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', 'error');\r\n-      showResult('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n-      return;\r\n-    }\r\n-    addLog(`å‹•ç”»ID: ${videoId}`, 'success');\r\n-\r\n-    await new Promise(r => setTimeout(r, 500));\r\n-    addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ä¸­...', 'api');\r\n-    const apiData = await fetchComments(videoId);\r\n-    const apiCount = apiData.count;\r\n-    if (apiData.count === 0 && apiData.comments.length === 0) {\r\n-      addLog('è­¦å‘Š: APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ (APIã‚­ãƒ¼ã¾ãŸã¯æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„)', 'error');\r\n-      showResult('APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n-      return;\r\n-    }\r\n-    addLog(`APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ: ${apiCount}ä»¶`, 'success');\r\n-\r\n-    // ãƒ‡ãƒãƒƒã‚°ï¼šAPIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆã®æœ€åˆã®5ä»¶ã‚’ãƒ­ã‚°å‡ºåŠ›\r\n-    addLog('=== ãƒ‡ãƒãƒƒã‚°: APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆã®æœ€åˆã®5ä»¶ ===', 'debug');\r\n-    apiData.comments.slice(0, 5).forEach((comment, index) => {\r\n-      addLog(`API${index + 1}: ${comment.id} - ${comment.author}: ${comment.text.slice(0, 30)}...`, 'debug');\r\n-    });\r\n-\r\n-    showResult('è§£æãŒå®Œäº†ã—ã¾ã—ãŸã€‚', false);\r\n-    addLog('è§£æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');\r\n-    await new Promise(r => setTimeout(r, 500));\r\n-\r\n-    // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®š\r\n-    const newHiddenComments = apiData.comments.filter(comment => !displayedCommentIds.has(comment.id));\r\n-    \r\n-    addLog('=== ãƒ‡ãƒãƒƒã‚°: æœªè¡¨ç¤ºã¨åˆ¤å®šã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆ ===', 'debug');\r\n-    newHiddenComments.slice(0, 10).forEach((comment, index) => {\r\n-      addLog(`æœªè¡¨ç¤º${index + 1}: ${comment.id} - ${comment.author}: ${comment.text.slice(0, 30)}...`, 'debug');\r\n-    });\r\n-\r\n-    let resultMsg = 'è§£æçµæœï¼š\\n';\r\n-    if (newHiddenComments.length === 0) {\r\n-      resultMsg += 'å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚';\r\n-      addLog('çµæœ: å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™', 'success');\r\n-    } else {\r\n-      resultMsg += `æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã€ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚\\n\\nâš ï¸ ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰: é»„è‰²èƒŒæ™¯ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒæ—¢ã«ä¸‹ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é‡è¤‡ã§ã™ã€‚`;\r\n-      addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’æ¤œå‡º`, 'progress');\r\n-      newHiddenComments.forEach(comment => {\r\n-        insertHiddenComment(comment);\r\n-        displayedCommentIds.add(comment.id);\r\n-      });\r\n-      addLog(`${newHiddenComments.length}ä»¶ã®æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n-    }\r\n-    showResult(resultMsg, true);\r\n-    addLog('ğŸ‰ ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n-\r\n-    setTimeout(() => {\r\n-      addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™ (æ‰‹å‹•ã§é–‰ã˜ã‚‹ã“ã¨ã‚‚å¯èƒ½)', 'info');\r\n-      setTimeout(closeLogPopup, 2000);\r\n-    }, 5000);\r\n-  }\r\n-\r\n-  // MutationObserverã§DOMå¤‰åŒ–ç›£è¦–\r\n+  // MutationObserverã§DOMå¤‰æ›´ã‚’ç›£è¦–\r\n   function startObserver() {\r\n     const observer = new MutationObserver((mutations) => {\r\n       let shouldCheck = false;\r\n       mutations.forEach((mutation) => {\r\n         if (mutation.type === 'childList') {\r\n           mutation.addedNodes.forEach((node) => {\r\n-            if (node.nodeType === 1) {\r\n+            if (node.nodeType === 1) { // Element node\r\n               if (node.matches && (\r\n                 node.matches('ytd-comments-header-renderer') ||\r\n                 node.querySelector && node.querySelector('ytd-comments-header-renderer')\r\n               )) {\r\n@@ -381,187 +57,21 @@\n             }\r\n           });\r\n         }\r\n       });\r\n+      \r\n       if (shouldCheck) {\r\n         setTimeout(insertAnalyzeButton, 500);\r\n       }\r\n     });\r\n-    observer.observe(document.body, { childList: true, subtree: true });\r\n+\r\n+    observer.observe(document.body, {\r\n+      childList: true,\r\n+      subtree: true\r\n+    });\r\n+    \r\n     return observer;\r\n-  }\r\n-\r\n-  // å‹•çš„ãƒšãƒ¼ã‚¸å¯¾å¿œï¼‹ãƒœã‚¿ãƒ³ç›£è¦–\r\n-  let lastUrl = location.href;\r\n-  let checkInterval;\r\n-  let observer;\r\n-  function startMonitoring() {\r\n-    observer = startObserver();\r\n-    checkInterval = setInterval(() => {\r\n-      if (location.href !== lastUrl) {\r\n-        lastUrl = location.href;\r\n-        console.log('ytcmtck: ãƒšãƒ¼ã‚¸é·ç§»ã‚’æ¤œå‡ºã€ãƒœã‚¿ãƒ³å†æŒ¿å…¥ã‚’è©¦è¡Œ');\r\n-        setTimeout(insertAnalyzeButton, 1000);\r\n-        setTimeout(insertAnalyzeButton, 3000);\r\n-      }\r\n-      if (!document.getElementById('ytcmtck-analyze-btn') && findInsertTarget()) {\r\n-        console.log('ytcmtck: ãƒœã‚¿ãƒ³ãŒæ¶ˆå¤±ã€å†æŒ¿å…¥');\r\n-        insertAnalyzeButton();\r\n-      }\r\n-    }, 2000);\r\n-  }\r\n-\r\n-  // åˆæœŸåŒ–\r\n-  function init() {\r\n-    setTimeout(insertAnalyzeButton, 1000);\r\n-    setTimeout(insertAnalyzeButton, 3000);\r\n-    setTimeout(insertAnalyzeButton, 5000);\r\n-    startMonitoring();\r\n-  }\r\n-  if (document.readyState === 'loading') {\r\n-    document.addEventListener('DOMContentLoaded', init);\r\n-  } else {\r\n-    init();\r\n-  }\r\n-\r\n-  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ä½œæˆãƒ»è¡¨ç¤º\r\n-  function showLogPopup() {\r\n-    let popup = document.getElementById('ytcmtck-log-popup');\r\n-    if (!popup) {\r\n-      popup = document.createElement('div');\r\n-      popup.id = 'ytcmtck-log-popup';\r\n-      popup.style.position = 'fixed';\r\n-      popup.style.top = '20px';\r\n-      popup.style.right = '20px';\r\n-      popup.style.width = '450px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—å¹…ã‚’åºƒã’ã‚‹\r\n-      popup.style.maxHeight = '600px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚é«˜ãã™ã‚‹\r\n-      popup.style.backgroundColor = '#fff';\r\n-      popup.style.border = '2px solid #cc0000';\r\n-      popup.style.borderRadius = '8px';\r\n-      popup.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';\r\n-      popup.style.zIndex = '10000';\r\n-      popup.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n-      popup.style.fontSize = '13px'; // ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚å°‘ã—å°ã•ã\r\n-      popup.style.overflow = 'hidden';\r\n-      const header = document.createElement('div');\r\n-      header.style.backgroundColor = '#cc0000';\r\n-      header.style.color = '#fff';\r\n-      header.style.padding = '12px';\r\n-      header.style.fontWeight = 'bold';\r\n-      header.style.display = 'flex';\r\n-      header.style.justifyContent = 'space-between';\r\n-      header.style.alignItems = 'center';\r\n-      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚° (ãƒ‡ãƒãƒƒã‚°ç‰ˆ)';\r\n-      const closeBtn = document.createElement('button');\r\n-      closeBtn.innerHTML = 'Ã—';\r\n-      closeBtn.style.backgroundColor = 'transparent';\r\n-      closeBtn.style.border = 'none';\r\n-      closeBtn.style.color = '#fff';\r\n-      closeBtn.style.fontSize = '18px';\r\n-      closeBtn.style.cursor = 'pointer';\r\n-      closeBtn.style.padding = '0';\r\n-      closeBtn.style.width = '24px';\r\n-      closeBtn.style.height = '24px';\r\n-      closeBtn.onclick = () => popup.remove();\r\n-      header.appendChild(closeBtn);\r\n-      const content = document.createElement('div');\r\n-      content.id = 'ytcmtck-log-content';\r\n-      content.style.padding = '16px';\r\n-      content.style.maxHeight = '500px';\r\n-      content.style.overflowY = 'auto';\r\n-      content.style.lineHeight = '1.3';\r\n-      popup.appendChild(header);\r\n-      popup.appendChild(content);\r\n-      document.body.appendChild(popup);\r\n-    }\r\n-    return popup;\r\n-  }\r\n-\r\n-  // ãƒ­ã‚°è¿½åŠ \r\n-  function addLog(message, type = 'info') {\r\n-    const popup = showLogPopup();\r\n-    const content = document.getElementById('ytcmtck-log-content');\r\n-    const logEntry = document.createElement('div');\r\n-    logEntry.style.marginBottom = '6px';\r\n-    logEntry.style.padding = '6px';\r\n-    logEntry.style.borderRadius = '4px';\r\n-    logEntry.style.fontSize = '12px';\r\n-    const timestamp = new Date().toLocaleTimeString('ja-JP');\r\n-    let icon = '';\r\n-    let bgColor = '';\r\n-    switch(type) {\r\n-      case 'start': icon = 'ğŸš€'; bgColor = '#e3f2fd'; break;\r\n-      case 'progress': icon = 'â³'; bgColor = '#fff3e0'; break;\r\n-      case 'success': icon = 'âœ…'; bgColor = '#e8f5e8'; break;\r\n-      case 'error': icon = 'âŒ'; bgColor = '#ffebee'; break;\r\n-      case 'api': icon = 'ğŸ”—'; bgColor = '#f3e5f5'; break;\r\n-      case 'debug': icon = 'ğŸ›'; bgColor = '#fff9c4'; break;\r\n-      default: icon = 'â„¹ï¸'; bgColor = '#f5f5f5';\r\n-    }\r\n-    logEntry.style.backgroundColor = bgColor;\r\n-    logEntry.innerHTML = `<span style=\"color: #666; font-size: 11px;\">${timestamp}</span> ${icon} ${message}`;\r\n-    content.appendChild(logEntry);\r\n-    content.scrollTop = content.scrollHeight;\r\n-  }\r\n-\r\n-  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹\r\n-  function closeLogPopup() {\r\n-    const popup = document.getElementById('ytcmtck-log-popup');\r\n-    if (popup) popup.remove();\r\n-  }\r\n-})();\n-// ==UserScript==\r\n-// @name         YouTube ã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ»æœªè¡¨ç¤ºæ¤œå‡ºãƒ„ãƒ¼ãƒ« (å°è¦æ¨¡å‹•ç”»å°‚ç”¨)\r\n-// @namespace    https://github.com/yourname/\r\n-// @version      2.1.0\r\n-// @description  ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®å‹•ç”»ã®ã¿ã§æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œå‡ºãƒ»è¡¨ç¤º\r\n-// @author       Himarry\r\n-// @match        https://www.youtube.com/watch*\r\n-// @grant        none\r\n-// ==/UserScript==\r\n-\r\n-(function() {\r\n-  'use strict';\r\n-\r\n-  const YOUTUBE_API_KEY = 'AIzaSyCB9iLVqz1AsLrYk83tILnILa7n6OzfEkg';\r\n-  let displayedCommentIds = new Set();\r\n-\r\n-  function findInsertTarget() {\r\n-    const commentsHeader = document.querySelector('ytd-comments-header-renderer');\r\n-    if (!commentsHeader) return null;\r\n-    const additional = commentsHeader.querySelector('#additional-section');\r\n-    return additional;\r\n-  }\r\n-\r\n-  function insertAnalyzeButton() {\r\n-    if (document.getElementById('ytcmtck-analyze-btn')) return;\r\n-    const additional = findInsertTarget();\r\n-    if (!additional) {\r\n-      console.log('ytcmtck: #additional-section not found, retrying...');\r\n-      return;\r\n-    }\r\n-    const btn = document.createElement('button');\r\n-    btn.id = 'ytcmtck-analyze-btn';\r\n-    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ (100ä»¶ä»¥ä¸‹å°‚ç”¨)';\r\n-    btn.style.marginLeft = '16px';\r\n-    btn.style.marginTop = '2px';\r\n-    btn.style.background = 'transparent';\r\n-    btn.style.color = '#0f0f0f';\r\n-    btn.style.border = '0px';\r\n-    btn.style.cursor = 'pointer';\r\n-    btn.style.fontSize = '1.4rem';\r\n-    btn.style.fontWeight = '500';\r\n-    btn.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n-    btn.style.height = '36px';\r\n-    btn.style.display = 'flex';\r\n-    btn.style.alignItems = 'top';\r\n-    btn.style.transition = 'background-color 0.1s ease';\r\n-    additional.appendChild(btn);\r\n-    btn.addEventListener('click', onAnalyzeClick);\r\n-    console.log('ytcmtck: è§£æãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥ã—ã¾ã—ãŸ');\r\n-  }\r\n-\r\n-  function showResult(message, isFinal) {\r\n+  }  function showResult(message, isFinal) {\r\n     let result = document.getElementById('ytcmtck-analyze-result');\r\n     if (!result) {\r\n       result = document.createElement('div');\r\n       result.id = 'ytcmtck-analyze-result';\r\n@@ -580,76 +90,65 @@\n     result.textContent = message;\r\n     if (isFinal) {\r\n       result.style.background = '#e6ffe6';\r\n       result.style.fontWeight = '500';\r\n+      // 5ç§’å¾Œã«è‡ªå‹•ã§å‰Šé™¤\r\n       setTimeout(() => {\r\n         if (result && result.parentNode) {\r\n           result.remove();\r\n+          addLog('è§£æçµæœè¡¨ç¤ºã‚’è‡ªå‹•ã§å‰Šé™¤ã—ã¾ã—ãŸ', 'info');\r\n         }\r\n-      }, 8000);\r\n+      }, 5000);\r\n     }\r\n   }\r\n \r\n+  // â˜…APIã‚­ãƒ¼ã‚’ã“ã“ã«è¨­å®šï¼ˆã”è‡ªèº«ã®YouTube Data APIã‚­ãƒ¼ã«å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼‰\r\n+  const YOUTUBE_API_KEY = 'AIzaSyCB9iLVqz1AsLrYk83tILnILa7n6OzfEkg';\r\n+\r\n+  // å‹•ç”»IDã‚’URLã‹ã‚‰å–å¾—\r\n   function getVideoId() {\r\n     const url = new URL(location.href);\r\n     return url.searchParams.get('v');\r\n-  }\r\n-\r\n-  // å°è¦æ¨¡å‹•ç”»å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n-  async function fetchAllComments(videoId) {\r\n+  }  // YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n+  async function fetchComments(videoId) {\r\n     if (!videoId) return { count: 0, comments: [] };\r\n-    const maxTotal = 50; // 100ä»¶åˆ¶é™ã«å°‘ã—ä½™è£•ã‚’æŒãŸã›ã‚‹\r\n-    let comments = [];\r\n-    let pageToken = '';\r\n+    const apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=100`;\r\n     try {\r\n-      while (comments.length < maxTotal) {\r\n-        let apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=100&order=time`;\r\n-        if (pageToken) apiUrl += `&pageToken=${pageToken}`;\r\n-        const res = await fetch(apiUrl);\r\n-        const data = await res.json();\r\n-        if (data.error) {\r\n-          console.error('YouTube API Error:', data.error);\r\n-          break;\r\n-        }\r\n-        const newComments = data.items ? data.items.map(item => ({\r\n-          author: item.snippet.topLevelComment.snippet.authorDisplayName,\r\n-          authorProfileImageUrl: item.snippet.topLevelComment.snippet.authorProfileImageUrl,\r\n-          authorChannelUrl: item.snippet.topLevelComment.snippet.authorChannelUrl || '#',\r\n-          text: item.snippet.topLevelComment.snippet.textDisplay,\r\n-          publishedAt: item.snippet.topLevelComment.snippet.publishedAt,\r\n-          updatedAt: item.snippet.topLevelComment.snippet.updatedAt,\r\n-          likeCount: item.snippet.topLevelComment.snippet.likeCount || 0,\r\n-          id: item.snippet.topLevelComment.id\r\n-        })) : [];\r\n-        \r\n-        comments = comments.concat(newComments);\r\n-        \r\n-        // 100ä»¶ã‚’è¶…ãˆãŸå ´åˆã¯å‡¦ç†åœæ­¢\r\n-        if (comments.length > 40) {\r\n-          addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ0ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${comments.length}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n-          return { count: -1, comments: [] }; // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦-1ã‚’è¿”ã™\r\n-        }\r\n-        \r\n-        if (!data.nextPageToken) break;\r\n-        pageToken = data.nextPageToken;\r\n+      const res = await fetch(apiUrl);\r\n+      const data = await res.json();\r\n+      if (data.error) {\r\n+        console.error('YouTube API Error:', data.error);\r\n+        return { count: 0, comments: [] };\r\n       }\r\n+      const comments = data.items ? data.items.map(item => ({\r\n+        author: item.snippet.topLevelComment.snippet.authorDisplayName,\r\n+        authorProfileImageUrl: item.snippet.topLevelComment.snippet.authorProfileImageUrl,\r\n+        authorChannelUrl: item.snippet.topLevelComment.snippet.authorChannelUrl || '#',\r\n+        text: item.snippet.topLevelComment.snippet.textDisplay,\r\n+        publishedAt: item.snippet.topLevelComment.snippet.publishedAt,\r\n+        updatedAt: item.snippet.topLevelComment.snippet.updatedAt,\r\n+        likeCount: item.snippet.topLevelComment.snippet.likeCount || 0,\r\n+        id: item.snippet.topLevelComment.id\r\n+      })) : [];\r\n       return { count: comments.length, comments: comments };\r\n     } catch (e) {\r\n       console.error('API fetch error:', e);\r\n       return { count: 0, comments: [] };\r\n     }\r\n   }\r\n-\r\n+  // YouTubeã®æ™‚é–“è¡¨ç¤ºå½¢å¼ã«å¤‰æ›\r\n   function formatTimeAgo(publishedAt) {\r\n     const now = new Date();\r\n     const published = new Date(publishedAt);\r\n     const diffMs = now - published;\r\n+    \r\n     const minutes = Math.floor(diffMs / (1000 * 60));\r\n     const hours = Math.floor(diffMs / (1000 * 60 * 60));\r\n     const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n     const weeks = Math.floor(days / 7);\r\n     const months = Math.floor(days / 30);\r\n     const years = Math.floor(days / 365);\r\n+\r\n     if (years > 0) {\r\n       return `${years} å¹´å‰`;\r\n     } else if (months > 0) {\r\n       return `${months} ã‹æœˆå‰`;\r\n@@ -663,276 +162,181 @@\n       return `${minutes} åˆ†å‰`;\r\n     } else {\r\n       return 'ä»Š';\r\n     }\r\n-  }\r\n+  }  async function onAnalyzeClick() {\r\n+    // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã—ã¦è§£æé–‹å§‹\r\n+    addLog('ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n+    showResult('è§£æä¸­...', false);\r\n \r\n-  function getDisplayedCommentIds() {\r\n-    const ids = new Set();\r\n-    // é€šå¸¸ã‚³ãƒ¡ãƒ³ãƒˆ\r\n-    document.querySelectorAll('ytd-comment-thread-renderer a[href*=\"lc=\"]').forEach(anchor => {\r\n-      const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n-      if (match) ids.add(match[1]);\r\n-    });\r\n-    // è¿”ä¿¡ã‚³ãƒ¡ãƒ³ãƒˆ\r\n-    document.querySelectorAll('ytd-comment-renderer a[href*=\"lc=\"]').forEach(anchor => {\r\n-      const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n-      if (match) ids.add(match[1]);\r\n-    });\r\n-    // æ—¢å­˜ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ\r\n-    document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]').forEach(node => {\r\n-      const id = node.getAttribute('data-comment-id');\r\n-      if (id) ids.add(id);\r\n-    });\r\n-    return ids;\r\n-  }\r\n-\r\n-  // å°è¦æ¨¡å‹•ç”»å°‚ç”¨ï¼šå…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºå®Ÿã«èª­ã¿è¾¼ã‚€\r\n-  async function loadAllCommentsForSmallVideo() {\r\n-    addLog('ğŸ“„ å°è¦æ¨¡å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­...', 'progress');\r\n+    // ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’æœ€æ–°å–å¾—\r\n+    displayedCommentIds = getDisplayedCommentIds();\r\n+    addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'info');\r\n     \r\n-    let previousCount = 0;\r\n-    let stableCount = 0;\r\n-    let maxAttempts = 20; // å°è¦æ¨¡ãªã®ã§å›æ•°ã‚’æ¸›ã‚‰ã™\r\n-    let attempts = 0;\r\n-    \r\n-    while (attempts < maxAttempts) {\r\n-      const currentCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n-      addLog(`ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿ä¸­: ${currentCount}ä»¶ (è©¦è¡Œ ${attempts + 1}/${maxAttempts})`, 'progress');\r\n-      \r\n-      // 100ä»¶ã‚’è¶…ãˆãã†ãªå ´åˆã¯åœæ­¢\r\n-      if (currentCount > 120) {\r\n-        addLog(`âŒ ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒå¤šã™ãã¾ã™ (${currentCount}ä»¶)ã€‚ã“ã®å‹•ç”»ã¯å¯¾è±¡å¤–ã§ã™ã€‚`, 'error');\r\n-        return -1; // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰\r\n-      }\r\n-      \r\n-      // ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦ã‚¯ãƒªãƒƒã‚¯\r\n-      const moreButtons = Array.from(document.querySelectorAll('ytd-button-renderer'))\r\n-        .filter(btn => /ã•ã‚‰ã«è¡¨ç¤º|Show more|ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã™ã¹ã¦è¡¨ç¤º/i.test(btn.textContent))\r\n-        .filter(btn => btn.offsetParent !== null);\r\n-      \r\n-      if (moreButtons.length > 0) {\r\n-        addLog(`ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯`, 'progress');\r\n-        moreButtons[0].click();\r\n-        await new Promise(r => setTimeout(r, 1500));\r\n-      } else {\r\n-        // ãƒœã‚¿ãƒ³ãŒãªã„å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«\r\n-        window.scrollTo(0, document.body.scrollHeight);\r\n-        await new Promise(r => setTimeout(r, 1000));\r\n-      }\r\n-      \r\n-      // å¤‰åŒ–ãŒãªã„å ´åˆã®ã‚«ã‚¦ãƒ³ãƒˆ\r\n-      if (currentCount === previousCount) {\r\n-        stableCount++;\r\n-        if (stableCount >= 3) { // å°è¦æ¨¡å‹•ç”»ãªã®ã§3å›ã§ååˆ†\r\n-          addLog(`ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ ${stableCount} å›é€£ç¶šã§å¤‰åŒ–ãªã—ã€‚èª­ã¿è¾¼ã¿å®Œäº†`, 'success');\r\n-          break;\r\n-        }\r\n-      } else {\r\n-        stableCount = 0;\r\n-      }\r\n-      \r\n-      previousCount = currentCount;\r\n-      attempts++;\r\n-    }\r\n-    \r\n-    const finalCount = document.querySelectorAll('ytd-comment-thread-renderer').length;\r\n-    \r\n-    // æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼š100ä»¶ã‚’è¶…ãˆã¦ã„ãªã„ã‹\r\n-    if (finalCount > 100) {\r\n-      addLog(`âŒ æœ€çµ‚ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™ (${finalCount}ä»¶)`, 'error');\r\n-      return -1;\r\n-    }\r\n-    \r\n-    addLog(`âœ… å…¨ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†: ${finalCount}ä»¶`, 'success');\r\n-    return finalCount;\r\n-  }\r\n-\r\n-  function insertHiddenComment(comment) {\r\n-    const commentElement = document.createElement('ytd-comment-view-model');\r\n-    commentElement.className = 'style-scope ytd-comment-thread-renderer';\r\n-    commentElement.setAttribute('data-ytcmtck-hidden', 'true');\r\n-    commentElement.setAttribute('data-comment-id', comment.id);\r\n-    commentElement.style.borderRadius = '8px';\r\n-    commentElement.style.marginBottom = '16px';\r\n-    commentElement.style.backgroundColor = '#e8f5e8';\r\n-    commentElement.style.border = '2px solid #4caf50';\r\n-    commentElement.innerHTML = `\r\n-      <div style=\"background: #4caf50; color: white; padding: 4px 8px; font-size: 12px; margin-bottom: 8px;\">\r\n-        ğŸ” æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ (å°è¦æ¨¡å‹•ç”»ã§ç™ºè¦‹)\r\n-      </div>\r\n-      <div id=\"body\" class=\"style-scope ytd-comment-view-model\">\r\n-        <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n-          <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n-            <yt-img-shadow fit=\"\" height=\"40\" width=\"40\" class=\"style-scope ytd-comment-view-model no-transition\" style=\"background-color: transparent;\">\r\n-              <img style=\"width: 40px; height: 40px; border-radius: 50%; object-fit: cover;\" src=\"${comment.authorProfileImageUrl}\" alt=\"${comment.author}\" onerror=\"this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNFNUU3RUIiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMzQgMzJDMzQgMjYuNDc3MiAyOS41MjI4IDIyIDI0IDIySDIwSDEyQzEwLjg5NTQgMjIgMTAgMjIuODk1NCAxMCAyNFYzNEgzNFYzMloiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+'\" />\r\n-            </yt-img-shadow>\r\n-          </button>\r\n-        </div>\r\n-        <div id=\"main\" class=\"style-scope ytd-comment-view-model\">\r\n-          <div id=\"header\" class=\"style-scope ytd-comment-view-model\" style=\"display: flex; align-items: center; flex-wrap: wrap; gap: 8px;\">\r\n-            <h3 class=\"style-scope ytd-comment-view-model\" style=\"margin: 0; font-size: 13px; line-height: 18px; font-weight: 500;\">\r\n-              <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"${comment.authorChannelUrl}\" style=\"color: #0f0f0f; text-decoration: none;\">\r\n-                <span class=\"style-scope ytd-comment-view-model\">${comment.author}</span>\r\n-              </a>\r\n-            </h3>\r\n-            <span dir=\"auto\" style=\"color: #606060; font-size: 12px; line-height: 18px;\">\r\n-              <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"/watch?v=${getVideoId()}&lc=${comment.id}\" style=\"color: inherit; text-decoration: none;\">\r\n-                ${formatTimeAgo(comment.publishedAt)}\r\n-              </a>\r\n-            </span>\r\n-          </div>\r\n-          <div style=\"margin-top: 2px;\">\r\n-            <span style=\"color: #0f0f0f; font-size: 14px; line-height: 20px; white-space: pre-wrap;\">${comment.text}</span>\r\n-          </div>\r\n-          <div style=\"margin-top: 8px; display: flex; align-items: center; gap: 8px;\">\r\n-            <button style=\"background: none; border: none; padding: 0px; border-radius: 18px; cursor: pointer; display: flex; align-items: center; gap: 6px;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\" title=\"é«˜è©•ä¾¡\">\r\n-              <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n-                <path d=\"M18.77 11h-4.23l1.52-4.94C16.38 5.03 15.54 4 14.38 4c-.58 0-1.14.24-1.52.65L7 11H3v10h14.43c1.06 0 1.98-.67 2.19-1.61l1.34-6c.27-1.24-.78-2.39-2.19-2.39zM7 20H4v-8h3v8zm12.98-6.83-1.34 6c-.1.48-.61.83-1.21.83H8v-8.61l5.6-6.06c.19-.21.48-.33.78-.33.26 0 .5.11.63.3.07.1.15.26.09.47l-1.52 4.94-.4 1.29h5.58c.41 0 .8.17 1.03.46.13.15.26.4.19.71z\"/>\r\n-              </svg>\r\n-              ${comment.likeCount > 0 ? `<span style=\"font-size: 12px; color: #606060;\">${comment.likeCount}</span>` : ''}\r\n-            </button>\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-    `;\r\n-    const commentSection = document.querySelector('#comments #contents');\r\n-    if (commentSection) commentSection.prepend(commentElement);\r\n-  }\r\n-\r\n-  async function onAnalyzeClick() {\r\n-    addLog('ğŸš€ å°è¦æ¨¡å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n-    showResult('è§£ææº–å‚™ä¸­...', false);\r\n-\r\n     addLog('å‹•ç”»IDã‚’å–å¾—ä¸­...', 'progress');\r\n     const videoId = getVideoId();\r\n     if (!videoId) {\r\n       addLog('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', 'error');\r\n       showResult('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n       return;\r\n     }\r\n     addLog(`å‹•ç”»ID: ${videoId}`, 'success');\r\n-\r\n-    // ã¾ãšAPIã§ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’ãƒã‚§ãƒƒã‚¯\r\n-    showResult('ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...', false);\r\n-    addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...', 'api');\r\n-    const apiData = await fetchAllComments(videoId);\r\n     \r\n-    if (apiData.count === -1) {\r\n-      // 100ä»¶è¶…éã‚¨ãƒ©ãƒ¼\r\n-      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚\\n\\nå°è¦æ¨¡å‹•ç”»ï¼ˆ100ä»¶ä»¥ä¸‹ï¼‰ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚', true);\r\n-      addLog('è§£æä¸­æ­¢: ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã¾ã™', 'error');\r\n-      return;\r\n-    }\r\n+    addLog('YouTubeä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’å–å¾—ä¸­...', 'progress');\r\n+    const ytComments = document.querySelectorAll('#contents #content-text');\r\n+    const ytCount = ytComments.length;\r\n+    addLog(`YouTubeä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${ytCount}ä»¶`, 'success');\r\n     \r\n-    if (apiData.count === 0) {\r\n-      addLog('è­¦å‘Š: APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', 'error');\r\n-      showResult('APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n-      return;\r\n-    }\r\n+    await new Promise(r => setTimeout(r, 1000));\r\n+    addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ä¸­...', 'api');\r\n     \r\n+    const apiData = await fetchComments(videoId);\r\n     const apiCount = apiData.count;\r\n-    addLog(`âœ… å°è¦æ¨¡å‹•ç”»ç¢ºèª: APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ ${apiCount}ä»¶`, 'success');\r\n-\r\n-    // å°è¦æ¨¡å‹•ç”»ãªã®ã§å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿\r\n-    showResult('å°è¦æ¨¡å‹•ç”»ã®ãŸã‚å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...', false);\r\n-    const loadedCount = await loadAllCommentsForSmallVideo();\r\n     \r\n-    if (loadedCount === -1) {\r\n-      // ç”»é¢å´ã§ã‚‚100ä»¶è¶…é\r\n-      showResult('âŒ ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆãŒ100ä»¶ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€è§£æå¯¾è±¡å¤–ã§ã™ã€‚', true);\r\n-      return;\r\n+    if (apiData.count === 0 && apiData.comments.length === 0) {\r\n+      addLog('è­¦å‘Š: APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ (APIã‚­ãƒ¼ã¾ãŸã¯æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„)', 'error');\r\n+    } else {\r\n+      addLog(`APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ: ${apiCount}ä»¶`, 'success');\r\n     }\r\n-\r\n-    showResult('ã‚³ãƒ¡ãƒ³ãƒˆIDæŠ½å‡ºä¸­...', false);\r\n-    displayedCommentIds = getDisplayedCommentIds();\r\n-    addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'success');\r\n-\r\n-    showResult('æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢ä¸­...', false);\r\n-    addLog('æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢ä¸­...', 'progress');\r\n-\r\n-    // æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ¤å®š\r\n-    const newHiddenComments = apiData.comments.filter(comment => !displayedCommentIds.has(comment.id));\r\n-\r\n-    let resultMsg = 'å°è¦æ¨¡å‹•ç”»å°‚ç”¨è§£æçµæœï¼š\\n';\r\n-    if (newHiddenComments.length === 0) {\r\n-      resultMsg += `âœ… å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n+    \r\n+    showResult('è§£æãŒå®Œäº†ã—ã¾ã—ãŸã€‚', false);\r\n+    addLog('è§£æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');\r\n+    \r\n+    await new Promise(r => setTimeout(r, 1000));\r\n+    \r\n+    let resultMsg = 'è§£æçµæœï¼š\\n';\r\n+    \r\n+    if (ytCount === apiCount) {\r\n+      resultMsg += 'å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚';\r\n       addLog('çµæœ: å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™', 'success');\r\n     } else {\r\n-      resultMsg += `âš ï¸ æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’${newHiddenComments.length}ä»¶ç™ºè¦‹ã—ã¾ã—ãŸã€‚\\n\\nç”»é¢è¡¨ç¤º: ${loadedCount}ä»¶\\nAPIå–å¾—: ${apiCount}ä»¶\\næœªè¡¨ç¤º: ${newHiddenComments.length}ä»¶\\n\\nã“ã‚Œã‚‰ã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚\\n\\nâ€» ã“ã®å‹•ç”»ã¯ã‚³ãƒ¡ãƒ³ãƒˆ100ä»¶ä»¥ä¸‹ã®ãŸã‚ã€å…¨ä»¶ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚`;\r\n-      addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’æ¤œå‡º`, 'progress');\r\n-      newHiddenComments.forEach(comment => {\r\n-        insertHiddenComment(comment);\r\n-        displayedCommentIds.add(comment.id);\r\n-      });\r\n-      addLog(`${newHiddenComments.length}ä»¶ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n+      const hiddenCount = Math.max(0, apiCount - ytCount);\r\n+      resultMsg += 'è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã‚³ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã£ãŸãŸã‚ã€ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã®ãƒˆãƒƒãƒ—ã«è¡¨ç¤ºã—ã¾ã—ãŸ';\r\n+      addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${hiddenCount}ä»¶ã‚’æ¤œå‡º`, 'progress');      // APIã§å–å¾—ã—ãŸæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸Šéƒ¨ã«è¡¨ç¤º\r\n+      const hiddenComments = apiData.comments.slice(ytCount); // è¡¨ç¤ºåˆ†ã‚’é™¤ã„ãŸæ®‹ã‚Š\r\n+      if (hiddenComments.length > 0) {\r\n+        // æ–°ã—ã„æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆé‡è¤‡é™¤å»ï¼‰\r\n+        const newHiddenComments = hiddenComments.filter(comment => !displayedCommentIds.has(comment.id));\r\n+        \r\n+        if (newHiddenComments.length > 0) {\r\n+          addLog(`æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºä¸­...`, 'progress');\r\n+          newHiddenComments.forEach((comment, index) => {\r\n+            addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${index + 1}/${newHiddenComments.length} ã‚’æŒ¿å…¥: ${comment.author}`, 'progress');\r\n+            \r\n+            // è¡¨ç¤ºæ¸ˆã¿ãƒªã‚¹ãƒˆã«è¿½åŠ \r\n+            displayedCommentIds.add(comment.id);\r\n+            \r\n+            const commentElement = document.createElement('ytd-comment-view-model');\r\n+            commentElement.className = 'style-scope ytd-comment-thread-renderer';\r\n+            commentElement.setAttribute('data-ytcmtck-hidden', 'true'); // è­˜åˆ¥ç”¨ãƒãƒ¼ã‚«ãƒ¼\r\n+            commentElement.style.borderRadius = '8px';\r\n+            commentElement.style.marginBottom = '16px';\r\n+            commentElement.innerHTML = `\r\n+            \r\n+            <div id=\"body\" class=\"style-scope ytd-comment-view-model\">              <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n+                <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n+                  <yt-img-shadow fit=\"\" height=\"40\" width=\"40\" class=\"style-scope ytd-comment-view-model no-transition\" style=\"background-color: transparent;\">\r\n+                    <img style=\"width: 40px; height: 40px; border-radius: 50%; object-fit: cover;\" src=\"${comment.authorProfileImageUrl}\" alt=\"${comment.author}\" onerror=\"this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNFNUU3RUIiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMzQgMzJDMzQgMjYuNDc3MiAyOS41MjI4IDIyIDI0IDIySDIwSDEyQzEwLjg5NTQgMjIgMTAgMjIuODk1NCAxMCAyNFYzNEgzNFYzMloiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+'\">\r\n+                  </yt-img-shadow>\r\n+                </button>\r\n+              </div>\r\n+              <div id=\"main\" class=\"style-scope ytd-comment-view-model\">\r\n+                <div id=\"header\" class=\"style-scope ytd-comment-view-model\" style=\"display: flex; align-items: center; flex-wrap: wrap; gap: 8px;\">\r\n+                  <h3 class=\"style-scope ytd-comment-view-model\" style=\"margin: 0; font-size: 13px; line-height: 18px; font-weight: 500;\"> \r\n+                    <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"${comment.authorChannelUrl}\" style=\"color: #0f0f0f; text-decoration: none;\">\r\n+                      <span class=\"style-scope ytd-comment-view-model\">${comment.author}</span>\r\n+                    </a>\r\n+                  </h3>\r\n+                  <span dir=\"auto\" style=\"color: #606060; font-size: 12px; line-height: 18px;\">\r\n+                    <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"/watch?v=${getVideoId()}&lc=${comment.id}\" style=\"color: inherit; text-decoration: none;\">\r\n+                      ${formatTimeAgo(comment.publishedAt)}\r\n+                    </a>\r\n+                  </span>\r\n+                </div>\r\n+                <div style=\"margin-top: 2px;\">\r\n+                  <span style=\"color: #0f0f0f; font-size: 14px; line-height: 20px; white-space: pre-wrap;\">${comment.text}</span>\r\n+                </div>                <div style=\"margin-top: 8px; display: flex; align-items: center; gap: 8px;\">\r\n+                  <button style=\"background: none; border: none; padding: 0px; border-radius: 18px; cursor: pointer; display: flex; align-items: center; gap: 6px;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\" title=\"é«˜è©•ä¾¡\">\r\n+                    <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n+                      <path d=\"M18.77 11h-4.23l1.52-4.94C16.38 5.03 15.54 4 14.38 4c-.58 0-1.14.24-1.52.65L7 11H3v10h14.43c1.06 0 1.98-.67 2.19-1.61l1.34-6c.27-1.24-.78-2.39-2.19-2.39zM7 20H4v-8h3v8zm12.98-6.83-1.34 6c-.1.48-.61.83-1.21.83H8v-8.61l5.6-6.06c.19-.21.48-.33.78-.33.26 0 .5.11.63.3.07.1.15.26.09.47l-1.52 4.94-.4 1.29h5.58c.41 0 .8.17 1.03.46.13.15.26.4.19.71z\"/>\r\n+                    </svg>\r\n+                    ${comment.likeCount > 0 ? `<span style=\"font-size: 12px; color: #606060;\">${comment.likeCount}</span>` : ''}\r\n+                  </button>\r\n+                  <button style=\"background: none; border: none; border-radius: 18px; padding: 0px; cursor: pointer; display: flex; align-items: center;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\">\r\n+                    <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n+                      <path d=\"M17 4H6.57c-1.07 0-1.98.67-2.19 1.61l-1.34 6C2.77 12.85 3.82 14 5.23 14h4.23l-1.52 4.94C7.62 19.97 8.46 21 9.62 21c.58 0 1.14-.24 1.52-.65L17 14h4V4h-4zm-6.6 15.67c-.19.21-.48.33-.78.33-.26 0-.5-.11-.63-.3-.07-.1-.15-.26-.09-.47l1.52-4.94.4-1.29H5.23c-.41 0-.8-.17-1.03-.46-.12-.15-.25-.4-.18-.72l1.34-6c.1-.47.61-.82 1.21-.82H16v8.61l-5.6 6.06zM20 13h-3V5h3v8z\"/>\r\n+                    </svg>\r\n+                  </button>\r\n+                  <button style=\"background: none; border: none; padding: 6px 16px; border-radius: 18px; cursor: pointer; font-size: 12px; font-weight: 500; onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\">\r\n+                    è¿”ä¿¡\r\n+                  </button>\r\n+                </div>\r\n+              </div>\r\n+            </div>\r\n+          `;            const commentSection = document.querySelector('#comments #contents');\r\n+            if (commentSection) commentSection.prepend(commentElement);\r\n+          });          addLog(`${newHiddenComments.length}ä»¶ã®æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n+          addLog(`ç´¯è¨ˆè¡¨ç¤ºæ¸ˆã¿æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${displayedCommentIds.size}ä»¶`, 'info');\r\n+        } else {\r\n+          addLog('æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼ˆæ—¢ã«è¡¨ç¤ºæ¸ˆã¿ï¼‰', 'info');\r\n+          addLog(`ç´¯è¨ˆè¡¨ç¤ºæ¸ˆã¿æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${displayedCommentIds.size}ä»¶`, 'info');\r\n+        }\r\n+      }\r\n     }\r\n     showResult(resultMsg, true);\r\n-    addLog('ğŸ‰ å°è¦æ¨¡å‹•ç”»å°‚ç”¨ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n-\r\n+    addLog('ğŸ‰ ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n+    \r\n+    // 3ç§’å¾Œã«ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è‡ªå‹•ã§é–‰ã˜ã‚‹\r\n     setTimeout(() => {\r\n-      addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™', 'info');\r\n+      addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™ (æ‰‹å‹•ã§é–‰ã˜ã‚‹ã“ã¨ã‚‚å¯èƒ½)', 'info');\r\n       setTimeout(closeLogPopup, 2000);\r\n-    }, 5000);\r\n+    }, 3000);\r\n   }\r\n-\r\n-  // ä»¥ä¸‹ã€ç›£è¦–ãƒ»åˆæœŸåŒ–ãƒ»ãƒ­ã‚°é–¢é€£ã¯åŒã˜\r\n-  function startObserver() {\r\n-    const observer = new MutationObserver((mutations) => {\r\n-      let shouldCheck = false;\r\n-      mutations.forEach((mutation) => {\r\n-        if (mutation.type === 'childList') {\r\n-          mutation.addedNodes.forEach((node) => {\r\n-            if (node.nodeType === 1) {\r\n-              if (node.matches && (\r\n-                node.matches('ytd-comments-header-renderer') ||\r\n-                node.querySelector && node.querySelector('ytd-comments-header-renderer')\r\n-              )) {\r\n-                shouldCheck = true;\r\n-              }\r\n-            }\r\n-          });\r\n-        }\r\n-      });\r\n-      if (shouldCheck) {\r\n-        setTimeout(insertAnalyzeButton, 500);\r\n-      }\r\n-    });\r\n-    observer.observe(document.body, { childList: true, subtree: true });\r\n-    return observer;\r\n-  }\r\n-\r\n+  // å‹•çš„ãƒšãƒ¼ã‚¸å¯¾å¿œã¨MutationObserver\r\n   let lastUrl = location.href;\r\n   let checkInterval;\r\n   let observer;\r\n+\r\n   function startMonitoring() {\r\n+    // MutationObserverã‚’é–‹å§‹\r\n     observer = startObserver();\r\n+    \r\n+    // URLãƒã‚§ãƒƒã‚¯ç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«\r\n     checkInterval = setInterval(() => {\r\n       if (location.href !== lastUrl) {\r\n         lastUrl = location.href;\r\n         console.log('ytcmtck: ãƒšãƒ¼ã‚¸é·ç§»ã‚’æ¤œå‡ºã€ãƒœã‚¿ãƒ³å†æŒ¿å…¥ã‚’è©¦è¡Œ');\r\n         setTimeout(insertAnalyzeButton, 1000);\r\n-        setTimeout(insertAnalyzeButton, 3000);\r\n+        setTimeout(insertAnalyzeButton, 3000); // é…å»¶èª­ã¿è¾¼ã¿å¯¾å¿œ\r\n       }\r\n+      \r\n+      // ãƒœã‚¿ãƒ³ãŒæ¶ˆãˆãŸå ´åˆã®å¾©æ—§\r\n       if (!document.getElementById('ytcmtck-analyze-btn') && findInsertTarget()) {\r\n         console.log('ytcmtck: ãƒœã‚¿ãƒ³ãŒæ¶ˆå¤±ã€å†æŒ¿å…¥');\r\n         insertAnalyzeButton();\r\n       }\r\n     }, 2000);\r\n   }\r\n \r\n+  // åˆæœŸåŒ–\r\n   function init() {\r\n+    // è¤‡æ•°å›è©¦è¡Œã§ç¢ºå®Ÿã«æŒ¿å…¥\r\n     setTimeout(insertAnalyzeButton, 1000);\r\n     setTimeout(insertAnalyzeButton, 3000);\r\n     setTimeout(insertAnalyzeButton, 5000);\r\n+    \r\n+    // ç›£è¦–é–‹å§‹\r\n     startMonitoring();\r\n   }\r\n+\r\n+  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–\r\n   if (document.readyState === 'loading') {\r\n     document.addEventListener('DOMContentLoaded', init);\r\n   } else {\r\n     init();\r\n   }\r\n \r\n+  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’ä½œæˆãƒ»è¡¨ç¤º\r\n   function showLogPopup() {\r\n     let popup = document.getElementById('ytcmtck-log-popup');\r\n     if (!popup) {\r\n       popup = document.createElement('div');\r\n@@ -942,24 +346,26 @@\n       popup.style.right = '20px';\r\n       popup.style.width = '400px';\r\n       popup.style.maxHeight = '500px';\r\n       popup.style.backgroundColor = '#fff';\r\n-      popup.style.border = '2px solid #4caf50';\r\n+      popup.style.border = '2px solid #cc0000';\r\n       popup.style.borderRadius = '8px';\r\n       popup.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';\r\n       popup.style.zIndex = '10000';\r\n       popup.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n       popup.style.fontSize = '14px';\r\n       popup.style.overflow = 'hidden';\r\n+      \r\n       const header = document.createElement('div');\r\n-      header.style.backgroundColor = '#4caf50';\r\n+      header.style.backgroundColor = '#cc0000';\r\n       header.style.color = '#fff';\r\n       header.style.padding = '12px';\r\n       header.style.fontWeight = 'bold';\r\n       header.style.display = 'flex';\r\n       header.style.justifyContent = 'space-between';\r\n       header.style.alignItems = 'center';\r\n-      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚° (100ä»¶ä»¥ä¸‹å°‚ç”¨)';\r\n+      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚°';\r\n+      \r\n       const closeBtn = document.createElement('button');\r\n       closeBtn.innerHTML = 'Ã—';\r\n       closeBtn.style.backgroundColor = 'transparent';\r\n       closeBtn.style.border = 'none';\r\n@@ -970,46 +376,95 @@\n       closeBtn.style.width = '24px';\r\n       closeBtn.style.height = '24px';\r\n       closeBtn.onclick = () => popup.remove();\r\n       header.appendChild(closeBtn);\r\n+      \r\n       const content = document.createElement('div');\r\n       content.id = 'ytcmtck-log-content';\r\n       content.style.padding = '16px';\r\n       content.style.maxHeight = '400px';\r\n       content.style.overflowY = 'auto';\r\n       content.style.lineHeight = '1.4';\r\n+      \r\n       popup.appendChild(header);\r\n       popup.appendChild(content);\r\n       document.body.appendChild(popup);\r\n     }\r\n     return popup;\r\n   }\r\n \r\n+  // ãƒ­ã‚°ã‚’è¿½åŠ \r\n   function addLog(message, type = 'info') {\r\n     const popup = showLogPopup();\r\n     const content = document.getElementById('ytcmtck-log-content');\r\n     const logEntry = document.createElement('div');\r\n     logEntry.style.marginBottom = '8px';\r\n     logEntry.style.padding = '8px';\r\n     logEntry.style.borderRadius = '4px';\r\n+    \r\n     const timestamp = new Date().toLocaleTimeString('ja-JP');\r\n     let icon = '';\r\n     let bgColor = '';\r\n+    \r\n     switch(type) {\r\n-      case 'start': icon = 'ğŸš€'; bgColor = '#e3f2fd'; break;\r\n-      case 'progress': icon = 'â³'; bgColor = '#fff3e0'; break;\r\n-      case 'success': icon = 'âœ…'; bgColor = '#e8f5e8'; break;\r\n-      case 'error': icon = 'âŒ'; bgColor = '#ffebee'; break;\r\n-      case 'api': icon = 'ğŸ”—'; bgColor = '#f3e5f5'; break;\r\n-      default: icon = 'â„¹ï¸'; bgColor = '#f5f5f5';\r\n+      case 'start':\r\n+        icon = 'ğŸš€';\r\n+        bgColor = '#e3f2fd';\r\n+        break;\r\n+      case 'progress':\r\n+        icon = 'â³';\r\n+        bgColor = '#fff3e0';\r\n\\ No newline at end of file\n+        break;\r\n+      case 'success':\r\n+        icon = 'âœ…';\r\n+        bgColor = '#e8f5e8';\r\n+        break;\r\n+      case 'error':\r\n+        icon = 'âŒ';\r\n+        bgColor = '#ffebee';\r\n+        break;\r\n+      case 'api':\r\n+        icon = 'ğŸ”—';\r\n+        bgColor = '#f3e5f5';\r\n+        break;\r\n+      default:\r\n+        icon = 'â„¹ï¸';\r\n+        bgColor = '#f5f5f5';\r\n     }\r\n+    \r\n     logEntry.style.backgroundColor = bgColor;\r\n     logEntry.innerHTML = `<span style=\"color: #666; font-size: 12px;\">${timestamp}</span> ${icon} ${message}`;\r\n     content.appendChild(logEntry);\r\n     content.scrollTop = content.scrollHeight;\r\n   }\r\n \r\n+  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹\r\n   function closeLogPopup() {\r\n     const popup = document.getElementById('ytcmtck-log-popup');\r\n     if (popup) popup.remove();\r\n   }\r\n-})();\n+\r\n+  // æ—¢ã«è¡¨ç¤ºæ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’è¨˜éŒ²ã™ã‚‹é…åˆ—\r\n+  let displayedCommentIds = new Set();\r\n+\r\n+  // æ—¢å­˜ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°\r\n+  function removeExistingHiddenComments() {\r\n+    const existingComments = document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]');\r\n+    existingComments.forEach(comment => comment.remove());\r\n+    addLog(`æ—¢å­˜ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${existingComments.length}ä»¶ã‚’å‰Šé™¤`, 'progress');\r\n+  }\r\n+\r\n+  // ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’ã™ã¹ã¦å–å¾—\r\n+  function getDisplayedCommentIds() {\r\n+    const nodes = document.querySelectorAll('ytd-comment-thread-renderer #comment #action-menu-button');\r\n+    const ids = new Set();\r\n+    nodes.forEach(node => {\r\n+      // ã‚³ãƒ¡ãƒ³ãƒˆã®permalinkã‹ã‚‰IDã‚’æŠ½å‡º\r\n+      const anchor = node.closest('ytd-comment-thread-renderer')?.querySelector('a[href*=\"lc=\"]');\r\n+      if (anchor) {\r\n+        const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n+        if (match) ids.add(match[1]);\r\n+      }\r\n+    });\r\n+    return ids;\r\n+  }\r\n+})();\r\n"
                },
                {
                    "date": 1750261231618,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -163,33 +163,20 @@\n     } else {\r\n       return 'ä»Š';\r\n     }\r\n   }  async function onAnalyzeClick() {\r\n-    // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã—ã¦è§£æé–‹å§‹\r\n-    addLog('ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n     showResult('è§£æä¸­...', false);\r\n-\r\n-    // ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’æœ€æ–°å–å¾—\r\n-    displayedCommentIds = getDisplayedCommentIds();\r\n-    addLog(`ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’${displayedCommentIds.size}ä»¶å–å¾—`, 'info');\r\n     \r\n-    addLog('å‹•ç”»IDã‚’å–å¾—ä¸­...', 'progress');\r\n     const videoId = getVideoId();\r\n     if (!videoId) {\r\n-      addLog('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', 'error');\r\n       showResult('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n       return;\r\n     }\r\n-    addLog(`å‹•ç”»ID: ${videoId}`, 'success');\r\n     \r\n-    addLog('YouTubeä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’å–å¾—ä¸­...', 'progress');\r\n     const ytComments = document.querySelectorAll('#contents #content-text');\r\n     const ytCount = ytComments.length;\r\n-    addLog(`YouTubeä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${ytCount}ä»¶`, 'success');\r\n     \r\n     await new Promise(r => setTimeout(r, 1000));\r\n-    addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ä¸­...', 'api');\r\n-    \r\n     const apiData = await fetchComments(videoId);\r\n     const apiCount = apiData.count;\r\n     \r\n     if (apiData.count === 0 && apiData.comments.length === 0) {\r\n@@ -198,41 +185,29 @@\n       addLog(`APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ: ${apiCount}ä»¶`, 'success');\r\n     }\r\n     \r\n     showResult('è§£æãŒå®Œäº†ã—ã¾ã—ãŸã€‚', false);\r\n-    addLog('è§£æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');\r\n-    \r\n     await new Promise(r => setTimeout(r, 1000));\r\n     \r\n     let resultMsg = 'è§£æçµæœï¼š\\n';\r\n     \r\n     if (ytCount === apiCount) {\r\n       resultMsg += 'å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚';\r\n-      addLog('çµæœ: å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™', 'success');\r\n     } else {\r\n       const hiddenCount = Math.max(0, apiCount - ytCount);\r\n       resultMsg += 'è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã‚³ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã£ãŸãŸã‚ã€ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã®ãƒˆãƒƒãƒ—ã«è¡¨ç¤ºã—ã¾ã—ãŸ';\r\n-      addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${hiddenCount}ä»¶ã‚’æ¤œå‡º`, 'progress');      // APIã§å–å¾—ã—ãŸæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸Šéƒ¨ã«è¡¨ç¤º\r\n-      const hiddenComments = apiData.comments.slice(ytCount); // è¡¨ç¤ºåˆ†ã‚’é™¤ã„ãŸæ®‹ã‚Š\r\n+      const hiddenComments = apiData.comments.slice(ytCount);\r\n       if (hiddenComments.length > 0) {\r\n-        // æ–°ã—ã„æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆé‡è¤‡é™¤å»ï¼‰\r\n         const newHiddenComments = hiddenComments.filter(comment => !displayedCommentIds.has(comment.id));\r\n-        \r\n         if (newHiddenComments.length > 0) {\r\n-          addLog(`æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºä¸­...`, 'progress');\r\n           newHiddenComments.forEach((comment, index) => {\r\n-            addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${index + 1}/${newHiddenComments.length} ã‚’æŒ¿å…¥: ${comment.author}`, 'progress');\r\n-            \r\n-            // è¡¨ç¤ºæ¸ˆã¿ãƒªã‚¹ãƒˆã«è¿½åŠ \r\n             displayedCommentIds.add(comment.id);\r\n-            \r\n             const commentElement = document.createElement('ytd-comment-view-model');\r\n             commentElement.className = 'style-scope ytd-comment-thread-renderer';\r\n-            commentElement.setAttribute('data-ytcmtck-hidden', 'true'); // è­˜åˆ¥ç”¨ãƒãƒ¼ã‚«ãƒ¼\r\n+            commentElement.setAttribute('data-ytcmtck-hidden', 'true');\r\n             commentElement.style.borderRadius = '8px';\r\n             commentElement.style.marginBottom = '16px';\r\n             commentElement.innerHTML = `\r\n-            \r\n             <div id=\"body\" class=\"style-scope ytd-comment-view-model\">              <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n                 <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n                   <yt-img-shadow fit=\"\" height=\"40\" width=\"40\" class=\"style-scope ytd-comment-view-model no-transition\" style=\"background-color: transparent;\">\r\n                     <img style=\"width: 40px; height: 40px; border-radius: 50%; object-fit: cover;\" src=\"${comment.authorProfileImageUrl}\" alt=\"${comment.author}\" onerror=\"this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNFNUU3RUIiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMzQgMzJDMzQgMjYuNDc3MiAyOS41MjI4IDIyIDI0IDIySDIwSDEyQzEwLjg5NTQgMjIgMTAgMjIuODk1NCAxMCAyNFYzNEgzNFYzMloiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+'\">\r\n@@ -271,26 +246,16 @@\n                   </button>\r\n                 </div>\r\n               </div>\r\n             </div>\r\n-          `;            const commentSection = document.querySelector('#comments #contents');\r\n+          `;\r\n+            const commentSection = document.querySelector('#comments #contents');\r\n             if (commentSection) commentSection.prepend(commentElement);\r\n-          });          addLog(`${newHiddenComments.length}ä»¶ã®æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n-          addLog(`ç´¯è¨ˆè¡¨ç¤ºæ¸ˆã¿æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${displayedCommentIds.size}ä»¶`, 'info');\r\n-        } else {\r\n-          addLog('æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼ˆæ—¢ã«è¡¨ç¤ºæ¸ˆã¿ï¼‰', 'info');\r\n-          addLog(`ç´¯è¨ˆè¡¨ç¤ºæ¸ˆã¿æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${displayedCommentIds.size}ä»¶`, 'info');\r\n+          });\r\n         }\r\n       }\r\n     }\r\n     showResult(resultMsg, true);\r\n-    addLog('ğŸ‰ ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n-    \r\n-    // 3ç§’å¾Œã«ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è‡ªå‹•ã§é–‰ã˜ã‚‹\r\n-    setTimeout(() => {\r\n-      addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™ (æ‰‹å‹•ã§é–‰ã˜ã‚‹ã“ã¨ã‚‚å¯èƒ½)', 'info');\r\n-      setTimeout(closeLogPopup, 2000);\r\n-    }, 3000);\r\n   }\r\n   // å‹•çš„ãƒšãƒ¼ã‚¸å¯¾å¿œã¨MutationObserver\r\n   let lastUrl = location.href;\r\n   let checkInterval;\r\n@@ -334,116 +299,8 @@\n   } else {\r\n     init();\r\n   }\r\n \r\n-  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’ä½œæˆãƒ»è¡¨ç¤º\r\n-  function showLogPopup() {\r\n-    let popup = document.getElementById('ytcmtck-log-popup');\r\n-    if (!popup) {\r\n-      popup = document.createElement('div');\r\n-      popup.id = 'ytcmtck-log-popup';\r\n-      popup.style.position = 'fixed';\r\n-      popup.style.top = '20px';\r\n-      popup.style.right = '20px';\r\n-      popup.style.width = '400px';\r\n-      popup.style.maxHeight = '500px';\r\n-      popup.style.backgroundColor = '#fff';\r\n-      popup.style.border = '2px solid #cc0000';\r\n-      popup.style.borderRadius = '8px';\r\n-      popup.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';\r\n-      popup.style.zIndex = '10000';\r\n-      popup.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n-      popup.style.fontSize = '14px';\r\n-      popup.style.overflow = 'hidden';\r\n-      \r\n-      const header = document.createElement('div');\r\n-      header.style.backgroundColor = '#cc0000';\r\n-      header.style.color = '#fff';\r\n-      header.style.padding = '12px';\r\n-      header.style.fontWeight = 'bold';\r\n-      header.style.display = 'flex';\r\n-      header.style.justifyContent = 'space-between';\r\n-      header.style.alignItems = 'center';\r\n-      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚°';\r\n-      \r\n-      const closeBtn = document.createElement('button');\r\n-      closeBtn.innerHTML = 'Ã—';\r\n-      closeBtn.style.backgroundColor = 'transparent';\r\n-      closeBtn.style.border = 'none';\r\n-      closeBtn.style.color = '#fff';\r\n-      closeBtn.style.fontSize = '18px';\r\n-      closeBtn.style.cursor = 'pointer';\r\n-      closeBtn.style.padding = '0';\r\n-      closeBtn.style.width = '24px';\r\n-      closeBtn.style.height = '24px';\r\n-      closeBtn.onclick = () => popup.remove();\r\n-      header.appendChild(closeBtn);\r\n-      \r\n-      const content = document.createElement('div');\r\n-      content.id = 'ytcmtck-log-content';\r\n-      content.style.padding = '16px';\r\n-      content.style.maxHeight = '400px';\r\n-      content.style.overflowY = 'auto';\r\n-      content.style.lineHeight = '1.4';\r\n-      \r\n-      popup.appendChild(header);\r\n-      popup.appendChild(content);\r\n-      document.body.appendChild(popup);\r\n-    }\r\n-    return popup;\r\n-  }\r\n-\r\n-  // ãƒ­ã‚°ã‚’è¿½åŠ \r\n-  function addLog(message, type = 'info') {\r\n-    const popup = showLogPopup();\r\n-    const content = document.getElementById('ytcmtck-log-content');\r\n-    const logEntry = document.createElement('div');\r\n-    logEntry.style.marginBottom = '8px';\r\n-    logEntry.style.padding = '8px';\r\n-    logEntry.style.borderRadius = '4px';\r\n-    \r\n-    const timestamp = new Date().toLocaleTimeString('ja-JP');\r\n-    let icon = '';\r\n-    let bgColor = '';\r\n-    \r\n-    switch(type) {\r\n-      case 'start':\r\n-        icon = 'ğŸš€';\r\n-        bgColor = '#e3f2fd';\r\n-        break;\r\n-      case 'progress':\r\n-        icon = 'â³';\r\n-        bgColor = '#fff3e0';\r\n-        break;\r\n-      case 'success':\r\n-        icon = 'âœ…';\r\n-        bgColor = '#e8f5e8';\r\n-        break;\r\n-      case 'error':\r\n-        icon = 'âŒ';\r\n-        bgColor = '#ffebee';\r\n-        break;\r\n-      case 'api':\r\n-        icon = 'ğŸ”—';\r\n-        bgColor = '#f3e5f5';\r\n-        break;\r\n-      default:\r\n-        icon = 'â„¹ï¸';\r\n-        bgColor = '#f5f5f5';\r\n-    }\r\n-    \r\n-    logEntry.style.backgroundColor = bgColor;\r\n-    logEntry.innerHTML = `<span style=\"color: #666; font-size: 12px;\">${timestamp}</span> ${icon} ${message}`;\r\n-    content.appendChild(logEntry);\r\n-    content.scrollTop = content.scrollHeight;\r\n-  }\r\n-\r\n-  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹\r\n-  function closeLogPopup() {\r\n-    const popup = document.getElementById('ytcmtck-log-popup');\r\n-    if (popup) popup.remove();\r\n-  }\r\n-\r\n   // æ—¢ã«è¡¨ç¤ºæ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’è¨˜éŒ²ã™ã‚‹é…åˆ—\r\n   let displayedCommentIds = new Set();\r\n \r\n   // æ—¢å­˜ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°\r\n@@ -451,20 +308,5 @@\n     const existingComments = document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]');\r\n     existingComments.forEach(comment => comment.remove());\r\n     addLog(`æ—¢å­˜ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${existingComments.length}ä»¶ã‚’å‰Šé™¤`, 'progress');\r\n   }\r\n-\r\n-  // ç”»é¢ä¸Šã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’ã™ã¹ã¦å–å¾—\r\n-  function getDisplayedCommentIds() {\r\n-    const nodes = document.querySelectorAll('ytd-comment-thread-renderer #comment #action-menu-button');\r\n-    const ids = new Set();\r\n-    nodes.forEach(node => {\r\n-      // ã‚³ãƒ¡ãƒ³ãƒˆã®permalinkã‹ã‚‰IDã‚’æŠ½å‡º\r\n-      const anchor = node.closest('ytd-comment-thread-renderer')?.querySelector('a[href*=\"lc=\"]');\r\n-      if (anchor) {\r\n-        const match = anchor.href.match(/[?&]lc=([a-zA-Z0-9_-]+)/);\r\n-        if (match) ids.add(match[1]);\r\n-      }\r\n-    });\r\n-    return ids;\r\n-  }\r\n-})();\n\\ No newline at end of file\n+})();\r\n"
                },
                {
                    "date": 1750310109517,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,8 @@\n       // 5ç§’å¾Œã«è‡ªå‹•ã§å‰Šé™¤\r\n       setTimeout(() => {\r\n         if (result && result.parentNode) {\r\n           result.remove();\r\n-          addLog('è§£æçµæœè¡¨ç¤ºã‚’è‡ªå‹•ã§å‰Šé™¤ã—ã¾ã—ãŸ', 'info');\r\n         }\r\n       }, 5000);\r\n     }\r\n   }\r\n@@ -178,14 +177,8 @@\n     await new Promise(r => setTimeout(r, 1000));\r\n     const apiData = await fetchComments(videoId);\r\n     const apiCount = apiData.count;\r\n     \r\n-    if (apiData.count === 0 && apiData.comments.length === 0) {\r\n-      addLog('è­¦å‘Š: APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ (APIã‚­ãƒ¼ã¾ãŸã¯æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„)', 'error');\r\n-    } else {\r\n-      addLog(`APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ: ${apiCount}ä»¶`, 'success');\r\n-    }\r\n-    \r\n     showResult('è§£æãŒå®Œäº†ã—ã¾ã—ãŸã€‚', false);\r\n     await new Promise(r => setTimeout(r, 1000));\r\n     \r\n     let resultMsg = 'è§£æçµæœï¼š\\n';\r\n"
                }
            ],
            "date": 1750249274186,
            "name": "Commit-0",
            "content": "// YouTubeã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ä»˜è¿‘ã«ã€Œã‚³ãƒ¡ãƒ³ãƒˆã‚’è§£æã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã—ã€ã‚¯ãƒªãƒƒã‚¯æ™‚ã«è§£æãƒ»çµæœè¡¨ç¤º\r\n(function() {\r\n  // ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã®è¦ªè¦ç´ ã‚’æ¢ã™ï¼ˆæ–°ä»•æ§˜: #additional-sectionå†…éƒ¨ï¼‰\r\n  function findInsertTarget() {\r\n    const commentsHeader = document.querySelector('ytd-comments-header-renderer');\r\n    if (!commentsHeader) return null;\r\n    const additional = commentsHeader.querySelector('#additional-section');\r\n    return additional;\r\n  }\r\n\r\n  function insertAnalyzeButton() {\r\n    // æ—¢ã«ãƒœã‚¿ãƒ³ãŒã‚ã‚‹å ´åˆã¯ä½•ã‚‚ã—ãªã„\r\n    if (document.getElementById('ytcmtck-analyze-btn')) return;\r\n    \r\n    const additional = findInsertTarget();\r\n    if (!additional) {\r\n      console.log('ytcmtck: #additional-section not found, retrying...');\r\n      return;\r\n    }\r\n      const btn = document.createElement('button');\r\n    btn.id = 'ytcmtck-analyze-btn';\r\n    btn.textContent = 'ã‚³ãƒ¡ãƒ³ãƒˆè§£æ';\r\n    btn.style.marginLeft = '16px';\r\n    btn.style.marginTop = '2px';\r\n    btn.style.background = 'transparent';\r\n    btn.style.color = '#0f0f0f';\r\n    btn.style.border = '0px';\r\n    btn.style.cursor = 'pointer';\r\n    btn.style.fontSize = '1.4rem';\r\n    btn.style.fontWeight = '500';\r\n    btn.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n    btn.style.height = '36px';\r\n    btn.style.display = 'flex';\r\n    btn.style.alignItems = 'top';\r\n    btn.style.transition = 'background-color 0.1s ease';\r\n    \r\n    // #additional-sectionå†…éƒ¨ã®æœ€å¾Œã«æŒ¿å…¥\r\n    additional.appendChild(btn);\r\n    btn.addEventListener('click', onAnalyzeClick);\r\n    console.log('ytcmtck: è§£æãƒœã‚¿ãƒ³ã‚’æŒ¿å…¥ã—ã¾ã—ãŸ');\r\n  }\r\n\r\n  // MutationObserverã§DOMå¤‰æ›´ã‚’ç›£è¦–\r\n  function startObserver() {\r\n    const observer = new MutationObserver((mutations) => {\r\n      let shouldCheck = false;\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type === 'childList') {\r\n          mutation.addedNodes.forEach((node) => {\r\n            if (node.nodeType === 1) { // Element node\r\n              if (node.matches && (\r\n                node.matches('ytd-comments-header-renderer') ||\r\n                node.querySelector && node.querySelector('ytd-comments-header-renderer')\r\n              )) {\r\n                shouldCheck = true;\r\n              }\r\n            }\r\n          });\r\n        }\r\n      });\r\n      \r\n      if (shouldCheck) {\r\n        setTimeout(insertAnalyzeButton, 500);\r\n      }\r\n    });\r\n\r\n    observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true\r\n    });\r\n    \r\n    return observer;\r\n  }  function showResult(message, isFinal) {\r\n    let result = document.getElementById('ytcmtck-analyze-result');\r\n    if (!result) {\r\n      result = document.createElement('div');\r\n      result.id = 'ytcmtck-analyze-result';\r\n      result.style.margin = '16px 0';\r\n      result.style.padding = '16px';\r\n      result.style.background = '#f9f9f9';\r\n      result.style.border = '1px solid #ddd';\r\n      result.style.borderRadius = '8px';\r\n      result.style.fontSize = '16px';\r\n      result.style.lineHeight = '1.5';\r\n      result.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n      result.style.whiteSpace = 'pre-line';\r\n      const commentSection = document.querySelector('#comments');\r\n      if (commentSection) commentSection.prepend(result);\r\n    }\r\n    result.textContent = message;\r\n    if (isFinal) {\r\n      result.style.background = '#e6ffe6';\r\n      result.style.fontWeight = '500';\r\n      // 5ç§’å¾Œã«è‡ªå‹•ã§å‰Šé™¤\r\n      setTimeout(() => {\r\n        if (result && result.parentNode) {\r\n          result.remove();\r\n          addLog('è§£æçµæœè¡¨ç¤ºã‚’è‡ªå‹•ã§å‰Šé™¤ã—ã¾ã—ãŸ', 'info');\r\n        }\r\n      }, 5000);\r\n    }\r\n  }\r\n\r\n  // â˜…APIã‚­ãƒ¼ã‚’ã“ã“ã«è¨­å®šï¼ˆã”è‡ªèº«ã®YouTube Data APIã‚­ãƒ¼ã«å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼‰\r\n  const YOUTUBE_API_KEY = 'AIzaSyCB9iLVqz1AsLrYk83tILnILa7n6OzfEkg;\r\n\r\n  // å‹•ç”»IDã‚’URLã‹ã‚‰å–å¾—\r\n  function getVideoId() {\r\n    const url = new URL(location.href);\r\n    return url.searchParams.get('v');\r\n  }  // YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—\r\n  async function fetchComments(videoId) {\r\n    if (!videoId) return { count: 0, comments: [] };\r\n    const apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}&maxResults=100`;\r\n    try {\r\n      const res = await fetch(apiUrl);\r\n      const data = await res.json();\r\n      if (data.error) {\r\n        console.error('YouTube API Error:', data.error);\r\n        return { count: 0, comments: [] };\r\n      }\r\n      const comments = data.items ? data.items.map(item => ({\r\n        author: item.snippet.topLevelComment.snippet.authorDisplayName,\r\n        authorProfileImageUrl: item.snippet.topLevelComment.snippet.authorProfileImageUrl,\r\n        authorChannelUrl: item.snippet.topLevelComment.snippet.authorChannelUrl || '#',\r\n        text: item.snippet.topLevelComment.snippet.textDisplay,\r\n        publishedAt: item.snippet.topLevelComment.snippet.publishedAt,\r\n        updatedAt: item.snippet.topLevelComment.snippet.updatedAt,\r\n        likeCount: item.snippet.topLevelComment.snippet.likeCount || 0,\r\n        id: item.snippet.topLevelComment.id\r\n      })) : [];\r\n      return { count: comments.length, comments: comments };\r\n    } catch (e) {\r\n      console.error('API fetch error:', e);\r\n      return { count: 0, comments: [] };\r\n    }\r\n  }\r\n  // YouTubeã®æ™‚é–“è¡¨ç¤ºå½¢å¼ã«å¤‰æ›\r\n  function formatTimeAgo(publishedAt) {\r\n    const now = new Date();\r\n    const published = new Date(publishedAt);\r\n    const diffMs = now - published;\r\n    \r\n    const minutes = Math.floor(diffMs / (1000 * 60));\r\n    const hours = Math.floor(diffMs / (1000 * 60 * 60));\r\n    const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n    const weeks = Math.floor(days / 7);\r\n    const months = Math.floor(days / 30);\r\n    const years = Math.floor(days / 365);\r\n\r\n    if (years > 0) {\r\n      return `${years} å¹´å‰`;\r\n    } else if (months > 0) {\r\n      return `${months} ã‹æœˆå‰`;\r\n    } else if (weeks > 0) {\r\n      return `${weeks} é€±é–“å‰`;\r\n    } else if (days > 0) {\r\n      return `${days} æ—¥å‰`;\r\n    } else if (hours > 0) {\r\n      return `${hours} æ™‚é–“å‰`;\r\n    } else if (minutes > 0) {\r\n      return `${minutes} åˆ†å‰`;\r\n    } else {\r\n      return 'ä»Š';\r\n    }\r\n  }  async function onAnalyzeClick() {\r\n    // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã—ã¦è§£æé–‹å§‹\r\n    addLog('ã‚³ãƒ¡ãƒ³ãƒˆè§£æã‚’é–‹å§‹ã—ã¾ã™', 'start');\r\n    showResult('è§£æä¸­...', false);\r\n    \r\n    addLog('å‹•ç”»IDã‚’å–å¾—ä¸­...', 'progress');\r\n    const videoId = getVideoId();\r\n    if (!videoId) {\r\n      addLog('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', 'error');\r\n      showResult('ã‚¨ãƒ©ãƒ¼: å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);\r\n      return;\r\n    }\r\n    addLog(`å‹•ç”»ID: ${videoId}`, 'success');\r\n    \r\n    addLog('YouTubeä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚’å–å¾—ä¸­...', 'progress');\r\n    const ytComments = document.querySelectorAll('#contents #content-text');\r\n    const ytCount = ytComments.length;\r\n    addLog(`YouTubeä¸Šã®è¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${ytCount}ä»¶`, 'success');\r\n    \r\n    await new Promise(r => setTimeout(r, 1000));\r\n    addLog('YouTube Data APIã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ä¸­...', 'api');\r\n    \r\n    const apiData = await fetchComments(videoId);\r\n    const apiCount = apiData.count;\r\n    \r\n    if (apiData.count === 0 && apiData.comments.length === 0) {\r\n      addLog('è­¦å‘Š: APIã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ (APIã‚­ãƒ¼ã¾ãŸã¯æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„)', 'error');\r\n    } else {\r\n      addLog(`APIå–å¾—ã‚³ãƒ¡ãƒ³ãƒˆ: ${apiCount}ä»¶`, 'success');\r\n    }\r\n    \r\n    showResult('è§£æãŒå®Œäº†ã—ã¾ã—ãŸã€‚', false);\r\n    addLog('è§£æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');\r\n    \r\n    await new Promise(r => setTimeout(r, 1000));\r\n    \r\n    let resultMsg = 'è§£æçµæœï¼š\\n';\r\n    \r\n    if (ytCount === apiCount) {\r\n      resultMsg += 'å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚';\r\n      addLog('çµæœ: å…¨ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™', 'success');\r\n    } else {\r\n      const hiddenCount = Math.max(0, apiCount - ytCount);\r\n      resultMsg += 'è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã‚³ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã£ãŸãŸã‚ã€ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã®ãƒˆãƒƒãƒ—ã«è¡¨ç¤ºã—ã¾ã—ãŸ';\r\n      addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${hiddenCount}ä»¶ã‚’æ¤œå‡º`, 'progress');      // APIã§å–å¾—ã—ãŸæœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸Šéƒ¨ã«è¡¨ç¤º\r\n      const hiddenComments = apiData.comments.slice(ytCount); // è¡¨ç¤ºåˆ†ã‚’é™¤ã„ãŸæ®‹ã‚Š\r\n      if (hiddenComments.length > 0) {\r\n        // æ–°ã—ã„æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆé‡è¤‡é™¤å»ï¼‰\r\n        const newHiddenComments = hiddenComments.filter(comment => !displayedCommentIds.has(comment.id));\r\n        \r\n        if (newHiddenComments.length > 0) {\r\n          addLog(`æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${newHiddenComments.length}ä»¶ã‚’ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«è¡¨ç¤ºä¸­...`, 'progress');\r\n          newHiddenComments.forEach((comment, index) => {\r\n            addLog(`æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${index + 1}/${newHiddenComments.length} ã‚’æŒ¿å…¥: ${comment.author}`, 'progress');\r\n            \r\n            // è¡¨ç¤ºæ¸ˆã¿ãƒªã‚¹ãƒˆã«è¿½åŠ \r\n            displayedCommentIds.add(comment.id);\r\n            \r\n            const commentElement = document.createElement('ytd-comment-view-model');\r\n            commentElement.className = 'style-scope ytd-comment-thread-renderer';\r\n            commentElement.setAttribute('data-ytcmtck-hidden', 'true'); // è­˜åˆ¥ç”¨ãƒãƒ¼ã‚«ãƒ¼\r\n            commentElement.style.borderRadius = '8px';\r\n            commentElement.style.marginBottom = '16px';\r\n            commentElement.innerHTML = `\r\n            \r\n            <div id=\"body\" class=\"style-scope ytd-comment-view-model\">              <div id=\"author-thumbnail\" class=\"style-scope ytd-comment-view-model\">\r\n                <button id=\"author-thumbnail-button\" class=\"style-scope ytd-comment-view-model\" style=\"border: none; background: none; padding: 0; cursor: pointer;\" aria-label=\"${comment.author}\">\r\n                  <yt-img-shadow fit=\"\" height=\"40\" width=\"40\" class=\"style-scope ytd-comment-view-model no-transition\" style=\"background-color: transparent;\">\r\n                    <img style=\"width: 40px; height: 40px; border-radius: 50%; object-fit: cover;\" src=\"${comment.authorProfileImageUrl}\" alt=\"${comment.author}\" onerror=\"this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNFNUU3RUIiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iNiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMzQgMzJDMzQgMjYuNDc3MiAyOS41MjI4IDIyIDI0IDIySDIwSDEyQzEwLjg5NTQgMjIgMTAgMjIuODk1NCAxMCAyNFYzNEgzNFYzMloiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+'\">\r\n                  </yt-img-shadow>\r\n                </button>\r\n              </div>\r\n              <div id=\"main\" class=\"style-scope ytd-comment-view-model\">\r\n                <div id=\"header\" class=\"style-scope ytd-comment-view-model\" style=\"display: flex; align-items: center; flex-wrap: wrap; gap: 8px;\">\r\n                  <h3 class=\"style-scope ytd-comment-view-model\" style=\"margin: 0; font-size: 13px; line-height: 18px; font-weight: 500;\"> \r\n                    <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"${comment.authorChannelUrl}\" style=\"color: #0f0f0f; text-decoration: none;\">\r\n                      <span class=\"style-scope ytd-comment-view-model\">${comment.author}</span>\r\n                    </a>\r\n                  </h3>\r\n                  <span dir=\"auto\" style=\"color: #606060; font-size: 12px; line-height: 18px;\">\r\n                    <a class=\"yt-simple-endpoint style-scope ytd-comment-view-model\" href=\"/watch?v=${getVideoId()}&lc=${comment.id}\" style=\"color: inherit; text-decoration: none;\">\r\n                      ${formatTimeAgo(comment.publishedAt)}\r\n                    </a>\r\n                  </span>\r\n                </div>\r\n                <div style=\"margin-top: 2px;\">\r\n                  <span style=\"color: #0f0f0f; font-size: 14px; line-height: 20px; white-space: pre-wrap;\">${comment.text}</span>\r\n                </div>                <div style=\"margin-top: 8px; display: flex; align-items: center; gap: 8px;\">\r\n                  <button style=\"background: none; border: none; padding: 0px; border-radius: 18px; cursor: pointer; display: flex; align-items: center; gap: 6px;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\" title=\"é«˜è©•ä¾¡\">\r\n                    <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                      <path d=\"M18.77 11h-4.23l1.52-4.94C16.38 5.03 15.54 4 14.38 4c-.58 0-1.14.24-1.52.65L7 11H3v10h14.43c1.06 0 1.98-.67 2.19-1.61l1.34-6c.27-1.24-.78-2.39-2.19-2.39zM7 20H4v-8h3v8zm12.98-6.83-1.34 6c-.1.48-.61.83-1.21.83H8v-8.61l5.6-6.06c.19-.21.48-.33.78-.33.26 0 .5.11.63.3.07.1.15.26.09.47l-1.52 4.94-.4 1.29h5.58c.41 0 .8.17 1.03.46.13.15.26.4.19.71z\"/>\r\n                    </svg>\r\n                    ${comment.likeCount > 0 ? `<span style=\"font-size: 12px; color: #606060;\">${comment.likeCount}</span>` : ''}\r\n                  </button>\r\n                  <button style=\"background: none; border: none; border-radius: 18px; padding: 0px; cursor: pointer; display: flex; align-items: center;\" onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\">\r\n                    <svg width=\"25\" height=\"25\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                      <path d=\"M17 4H6.57c-1.07 0-1.98.67-2.19 1.61l-1.34 6C2.77 12.85 3.82 14 5.23 14h4.23l-1.52 4.94C7.62 19.97 8.46 21 9.62 21c.58 0 1.14-.24 1.52-.65L17 14h4V4h-4zm-6.6 15.67c-.19.21-.48.33-.78.33-.26 0-.5-.11-.63-.3-.07-.1-.15-.26-.09-.47l1.52-4.94.4-1.29H5.23c-.41 0-.8-.17-1.03-.46-.12-.15-.25-.4-.18-.72l1.34-6c.1-.47.61-.82 1.21-.82H16v8.61l-5.6 6.06zM20 13h-3V5h3v8z\"/>\r\n                    </svg>\r\n                  </button>\r\n                  <button style=\"background: none; border: none; padding: 6px 16px; border-radius: 18px; cursor: pointer; font-size: 12px; font-weight: 500; onmouseover=\"this.style.backgroundColor='#f2f2f2'\" onmouseout=\"this.style.backgroundColor='transparent'\">\r\n                    è¿”ä¿¡\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          `;            const commentSection = document.querySelector('#comments #contents');\r\n            if (commentSection) commentSection.prepend(commentElement);\r\n          });          addLog(`${newHiddenComments.length}ä»¶ã®æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`, 'success');\r\n          addLog(`ç´¯è¨ˆè¡¨ç¤ºæ¸ˆã¿æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${displayedCommentIds.size}ä»¶`, 'info');\r\n        } else {\r\n          addLog('æ–°è¦æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼ˆæ—¢ã«è¡¨ç¤ºæ¸ˆã¿ï¼‰', 'info');\r\n          addLog(`ç´¯è¨ˆè¡¨ç¤ºæ¸ˆã¿æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ: ${displayedCommentIds.size}ä»¶`, 'info');\r\n        }\r\n      }\r\n    }\r\n    showResult(resultMsg, true);\r\n    addLog('ğŸ‰ ã‚³ãƒ¡ãƒ³ãƒˆè§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');\r\n    \r\n    // 3ç§’å¾Œã«ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è‡ªå‹•ã§é–‰ã˜ã‚‹\r\n    setTimeout(() => {\r\n      addLog('ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«é–‰ã˜ã¾ã™ (æ‰‹å‹•ã§é–‰ã˜ã‚‹ã“ã¨ã‚‚å¯èƒ½)', 'info');\r\n      setTimeout(closeLogPopup, 2000);\r\n    }, 3000);\r\n  }\r\n  // å‹•çš„ãƒšãƒ¼ã‚¸å¯¾å¿œã¨MutationObserver\r\n  let lastUrl = location.href;\r\n  let checkInterval;\r\n  let observer;\r\n\r\n  function startMonitoring() {\r\n    // MutationObserverã‚’é–‹å§‹\r\n    observer = startObserver();\r\n    \r\n    // URLãƒã‚§ãƒƒã‚¯ç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«\r\n    checkInterval = setInterval(() => {\r\n      if (location.href !== lastUrl) {\r\n        lastUrl = location.href;\r\n        console.log('ytcmtck: ãƒšãƒ¼ã‚¸é·ç§»ã‚’æ¤œå‡ºã€ãƒœã‚¿ãƒ³å†æŒ¿å…¥ã‚’è©¦è¡Œ');\r\n        setTimeout(insertAnalyzeButton, 1000);\r\n        setTimeout(insertAnalyzeButton, 3000); // é…å»¶èª­ã¿è¾¼ã¿å¯¾å¿œ\r\n      }\r\n      \r\n      // ãƒœã‚¿ãƒ³ãŒæ¶ˆãˆãŸå ´åˆã®å¾©æ—§\r\n      if (!document.getElementById('ytcmtck-analyze-btn') && findInsertTarget()) {\r\n        console.log('ytcmtck: ãƒœã‚¿ãƒ³ãŒæ¶ˆå¤±ã€å†æŒ¿å…¥');\r\n        insertAnalyzeButton();\r\n      }\r\n    }, 2000);\r\n  }\r\n\r\n  // åˆæœŸåŒ–\r\n  function init() {\r\n    // è¤‡æ•°å›è©¦è¡Œã§ç¢ºå®Ÿã«æŒ¿å…¥\r\n    setTimeout(insertAnalyzeButton, 1000);\r\n    setTimeout(insertAnalyzeButton, 3000);\r\n    setTimeout(insertAnalyzeButton, 5000);\r\n    \r\n    // ç›£è¦–é–‹å§‹\r\n    startMonitoring();\r\n  }\r\n\r\n  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', init);\r\n  } else {\r\n    init();\r\n  }\r\n\r\n  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’ä½œæˆãƒ»è¡¨ç¤º\r\n  function showLogPopup() {\r\n    let popup = document.getElementById('ytcmtck-log-popup');\r\n    if (!popup) {\r\n      popup = document.createElement('div');\r\n      popup.id = 'ytcmtck-log-popup';\r\n      popup.style.position = 'fixed';\r\n      popup.style.top = '20px';\r\n      popup.style.right = '20px';\r\n      popup.style.width = '400px';\r\n      popup.style.maxHeight = '500px';\r\n      popup.style.backgroundColor = '#fff';\r\n      popup.style.border = '2px solid #cc0000';\r\n      popup.style.borderRadius = '8px';\r\n      popup.style.boxShadow = '0 4px 20px rgba(0,0,0,0.3)';\r\n      popup.style.zIndex = '10000';\r\n      popup.style.fontFamily = 'Roboto, Arial, sans-serif';\r\n      popup.style.fontSize = '14px';\r\n      popup.style.overflow = 'hidden';\r\n      \r\n      const header = document.createElement('div');\r\n      header.style.backgroundColor = '#cc0000';\r\n      header.style.color = '#fff';\r\n      header.style.padding = '12px';\r\n      header.style.fontWeight = 'bold';\r\n      header.style.display = 'flex';\r\n      header.style.justifyContent = 'space-between';\r\n      header.style.alignItems = 'center';\r\n      header.innerHTML = 'ğŸ“Š YouTubeã‚³ãƒ¡ãƒ³ãƒˆè§£æãƒ­ã‚°';\r\n      \r\n      const closeBtn = document.createElement('button');\r\n      closeBtn.innerHTML = 'Ã—';\r\n      closeBtn.style.backgroundColor = 'transparent';\r\n      closeBtn.style.border = 'none';\r\n      closeBtn.style.color = '#fff';\r\n      closeBtn.style.fontSize = '18px';\r\n      closeBtn.style.cursor = 'pointer';\r\n      closeBtn.style.padding = '0';\r\n      closeBtn.style.width = '24px';\r\n      closeBtn.style.height = '24px';\r\n      closeBtn.onclick = () => popup.remove();\r\n      header.appendChild(closeBtn);\r\n      \r\n      const content = document.createElement('div');\r\n      content.id = 'ytcmtck-log-content';\r\n      content.style.padding = '16px';\r\n      content.style.maxHeight = '400px';\r\n      content.style.overflowY = 'auto';\r\n      content.style.lineHeight = '1.4';\r\n      \r\n      popup.appendChild(header);\r\n      popup.appendChild(content);\r\n      document.body.appendChild(popup);\r\n    }\r\n    return popup;\r\n  }\r\n\r\n  // ãƒ­ã‚°ã‚’è¿½åŠ \r\n  function addLog(message, type = 'info') {\r\n    const popup = showLogPopup();\r\n    const content = document.getElementById('ytcmtck-log-content');\r\n    const logEntry = document.createElement('div');\r\n    logEntry.style.marginBottom = '8px';\r\n    logEntry.style.padding = '8px';\r\n    logEntry.style.borderRadius = '4px';\r\n    \r\n    const timestamp = new Date().toLocaleTimeString('ja-JP');\r\n    let icon = '';\r\n    let bgColor = '';\r\n    \r\n    switch(type) {\r\n      case 'start':\r\n        icon = 'ğŸš€';\r\n        bgColor = '#e3f2fd';\r\n        break;\r\n      case 'progress':\r\n        icon = 'â³';\r\n        bgColor = '#fff3e0';\r\n        break;\r\n      case 'success':\r\n        icon = 'âœ…';\r\n        bgColor = '#e8f5e8';\r\n        break;\r\n      case 'error':\r\n        icon = 'âŒ';\r\n        bgColor = '#ffebee';\r\n        break;\r\n      case 'api':\r\n        icon = 'ğŸ”—';\r\n        bgColor = '#f3e5f5';\r\n        break;\r\n      default:\r\n        icon = 'â„¹ï¸';\r\n        bgColor = '#f5f5f5';\r\n    }\r\n    \r\n    logEntry.style.backgroundColor = bgColor;\r\n    logEntry.innerHTML = `<span style=\"color: #666; font-size: 12px;\">${timestamp}</span> ${icon} ${message}`;\r\n    content.appendChild(logEntry);\r\n    content.scrollTop = content.scrollHeight;\r\n  }\r\n\r\n  // ãƒ­ã‚°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹\r\n  function closeLogPopup() {\r\n    const popup = document.getElementById('ytcmtck-log-popup');\r\n    if (popup) popup.remove();\r\n  }\r\n\r\n  // æ—¢ã«è¡¨ç¤ºæ¸ˆã¿ã®ã‚³ãƒ¡ãƒ³ãƒˆIDã‚’è¨˜éŒ²ã™ã‚‹é…åˆ—\r\n  let displayedCommentIds = new Set();\r\n\r\n  // æ—¢å­˜ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°\r\n  function removeExistingHiddenComments() {\r\n    const existingComments = document.querySelectorAll('[data-ytcmtck-hidden=\"true\"]');\r\n    existingComments.forEach(comment => comment.remove());\r\n    addLog(`æ—¢å­˜ã®æœªè¡¨ç¤ºã‚³ãƒ¡ãƒ³ãƒˆ ${existingComments.length}ä»¶ã‚’å‰Šé™¤`, 'progress');\r\n  }\r\n})();\r\n"
        }
    ]
}